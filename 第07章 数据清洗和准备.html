<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTBMMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMzIgOTBsNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTQwIDcwSDIwVjUwbTIwIDBMMjAgNzBtNDAtNDBoMjB2MjBtLTIwIDBsMjAtMjAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwIDUwaDIwdjIwbS0yMCAwbDIwLTIwbTQwIDBINjBWMzBtMjAgMEw2MCA1MCIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS13aWR0aDo1cHh9PC9zdHlsZT48L2RlZnM+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yMCA2MGgtNWE1IDUgMCAwMS01LTVWMjBhNSA1IDAgMDE1LTVoNjBhNSA1IDAgMDE1IDV2NU0zMCA4NWg2MCIvPjxyZWN0IHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIi8+PHJlY3QgY2xhc3M9ImEiIHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNNDAgNTBoNDBNNDAgNjBoMzAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;z-index:-1;pointer-events:none;opacity:0}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;z-index:0;pointer-events:auto;opacity:1}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{-webkit-animation-name:__bespoke_marp__!important;animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{bottom:0;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{background:rgba(0,0,0,.65);border-radius:7px;bottom:50px;color:#fff;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;z-index:1;will-change:transform}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{flex:0 0 0;background:#0288d1;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:transparent}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{font-family:Helvetica,Arial,sans-serif;height:100%;left:0;position:absolute;top:0;width:100%;display:grid;grid-template-columns:2fr 1fr;grid-template-rows:minmax(140px,1fr) 2fr 3em;grid-template-areas:"current next" "current note" "info    note"}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;position:relative;overflow:hidden}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;top:20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:transparent;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;top:20px;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{margin:20px;width:calc(100% - 40px);height:calc(100% - 40px);box-sizing:border-box;font-size:1.1em;overflow:auto;padding-right:3px;white-space:pre-wrap;word-wrap:break-word;scrollbar-width:thin;scrollbar-color:hsla(0,0%,93.3%,.5) transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:hsla(0,0%,93.3%,.5);border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{display:block;box-sizing:border-box;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>@charset "UTF-8";@import url("https://fonts.googleapis.com/css?family=Lato:400,900|Roboto+Mono:400,700&display=swap");div#p>svg>foreignObject>section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center}div#p>svg>foreignObject>section:after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#p>svg>foreignObject>section:not([data-marpit-pagination]):after{display:none}/* Normalization */div#p>svg>foreignObject>section h1{font-size:2em;margin:0.67em 0}div#p>svg>foreignObject>section video::-webkit-media-controls{will-change:transform}@page{size:1280px 720px;margin:0}@media print{body,html{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#p>svg>foreignObject>section{page-break-before:always;break-before:page}div#p>svg>foreignObject>section,div#p>svg>foreignObject>section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;transition:none!important}div#p>svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{display:block;height:auto;width:100%}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{position:static}}div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{content:""}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{position:relative}}div#p>svg>foreignObject>section [data-marp-fitting-svg-content]{display:table;white-space:nowrap}div#p>svg>foreignObject>section [data-marp-fitting-svg-content-wrap]{white-space:pre}div#p>svg>foreignObject>section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}
/*!
 * Marp / Marpit Gaia theme.
 *
 * @theme gaia
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 4:3 960px 720px
 */div#p>svg>foreignObject>section .hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-comment,div#p>svg>foreignObject>section .hljs-quote{color:#aeaeae;font-style:italic}div#p>svg>foreignObject>section .hljs-keyword,div#p>svg>foreignObject>section .hljs-selector-tag,div#p>svg>foreignObject>section .hljs-type{color:#e28964}div#p>svg>foreignObject>section .hljs-string{color:#65b042}div#p>svg>foreignObject>section .hljs-subst{color:#daefa3}div#p>svg>foreignObject>section .hljs-link,div#p>svg>foreignObject>section .hljs-regexp{color:#e9c062}div#p>svg>foreignObject>section .hljs-name,div#p>svg>foreignObject>section .hljs-section,div#p>svg>foreignObject>section .hljs-tag,div#p>svg>foreignObject>section .hljs-title{color:#89bdff}div#p>svg>foreignObject>section .hljs-class .hljs-title,div#p>svg>foreignObject>section .hljs-doctag{text-decoration:underline}div#p>svg>foreignObject>section .hljs-bullet,div#p>svg>foreignObject>section .hljs-number,div#p>svg>foreignObject>section .hljs-symbol{color:#3387cc}div#p>svg>foreignObject>section .hljs-params,div#p>svg>foreignObject>section .hljs-template-variable,div#p>svg>foreignObject>section .hljs-variable{color:#3e87e3}div#p>svg>foreignObject>section .hljs-attribute{color:#cda869}div#p>svg>foreignObject>section .hljs-meta{color:#8996a8}div#p>svg>foreignObject>section .hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}div#p>svg>foreignObject>section .hljs-addition{background-color:#253b22;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-deletion{background-color:#420e09;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-selector-class{color:#9b703f}div#p>svg>foreignObject>section .hljs-selector-id{color:#8b98ab}div#p>svg>foreignObject>section .hljs-emphasis{font-style:italic}div#p>svg>foreignObject>section .hljs-strong{font-weight:700}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{max-height:580px}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2,div#p>svg>foreignObject>section h3,div#p>svg>foreignObject>section h4,div#p>svg>foreignObject>section h5,div#p>svg>foreignObject>section h6{margin:.5em 0 0}div#p>svg>foreignObject>section h1 strong,div#p>svg>foreignObject>section h2 strong,div#p>svg>foreignObject>section h3 strong,div#p>svg>foreignObject>section h4 strong,div#p>svg>foreignObject>section h5 strong,div#p>svg>foreignObject>section h6 strong{font-weight:inherit}div#p>svg>foreignObject>section h1{font-size:1.8em}div#p>svg>foreignObject>section h2{font-size:1.5em}div#p>svg>foreignObject>section h3{font-size:1.3em}div#p>svg>foreignObject>section h4{font-size:1.1em}div#p>svg>foreignObject>section h5{font-size:1em}div#p>svg>foreignObject>section h6{font-size:.9em}div#p>svg>foreignObject>section blockquote,div#p>svg>foreignObject>section p{margin:1em 0 0}div#p>svg>foreignObject>section ol>li,div#p>svg>foreignObject>section ul>li{margin:.3em 0 0}div#p>svg>foreignObject>section ol>li>p,div#p>svg>foreignObject>section ul>li>p{margin:.6em 0 0}div#p>svg>foreignObject>section code{display:inline-block;font-family:Roboto Mono,monospace;font-size:.8em;letter-spacing:0;margin:-.1em .15em;padding:.1em .2em;vertical-align:baseline}div#p>svg>foreignObject>section pre{display:block;margin:1em 0 0;min-height:1em;overflow:visible}div#p>svg>foreignObject>section pre code{box-sizing:border-box;margin:0;min-width:100%;padding:.5em;font-size:.7em}div#p>svg>foreignObject>section pre code svg[data-marp-fitting=svg]{max-height:calc(580px - 1em)}div#p>svg>foreignObject>section blockquote{margin:1em 0 0;padding:0 1em;position:relative}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before{content:"“";display:block;font-family:Times New Roman,serif;font-weight:700;position:absolute}div#p>svg>foreignObject>section blockquote:before{top:0;left:0}div#p>svg>foreignObject>section blockquote:after{right:0;bottom:0;transform:rotate(180deg)}div#p>svg>foreignObject>section blockquote>:first-child{margin-top:0}div#p>svg>foreignObject>section mark{background:transparent}div#p>svg>foreignObject>section table{border-spacing:0;border-collapse:collapse;margin:1em 0 0}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{padding:.2em .4em;border-width:1px;border-style:solid}div#p>svg>foreignObject>section{background-image:linear-gradient(135deg,hsla(0,0%,53.3%,0),hsla(0,0%,53.3%,.02) 50%,hsla(0,0%,100%,0) 0,hsla(0,0%,100%,.05));font-size:35px;font-family:Lato,Avenir Next,Avenir,Trebuchet MS,Segoe UI,sans-serif;height:720px;line-height:1.35;letter-spacing:1.25px;padding:70px;width:1280px;word-wrap:break-word;color:#455a64;background-color:#fff8e1}div#p>svg>foreignObject>section{--marpit-root-font-size:35px}div#p>svg>foreignObject>section>:first-child,div#p>svg>foreignObject>section>header:first-child+*{margin-top:0}div#p>svg>foreignObject>section a,div#p>svg>foreignObject>section mark{color:#0288d1}div#p>svg>foreignObject>section code{background:#6a7a7d;color:#fff8e1}div#p>svg>foreignObject>section h1 strong,div#p>svg>foreignObject>section h2 strong,div#p>svg>foreignObject>section h3 strong,div#p>svg>foreignObject>section h4 strong,div#p>svg>foreignObject>section h5 strong,div#p>svg>foreignObject>section h6 strong{color:#0288d1}div#p>svg>foreignObject>section pre>code{background:#455a64}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before,div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header,div#p>svg>foreignObject>section section:after{color:#6a7a7d}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{border-color:#455a64}div#p>svg>foreignObject>section table thead th{background:#455a64;color:#fff8e1}div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) th{background:rgba(69,90,100,.1)}div#p>svg>foreignObject>section.invert{color:#fff8e1;background-color:#455a64}div#p>svg>foreignObject>section.invert a,div#p>svg>foreignObject>section.invert mark{color:#81d4fa}div#p>svg>foreignObject>section.invert code{background:#dad8c8;color:#455a64}div#p>svg>foreignObject>section.invert h1 strong,div#p>svg>foreignObject>section.invert h2 strong,div#p>svg>foreignObject>section.invert h3 strong,div#p>svg>foreignObject>section.invert h4 strong,div#p>svg>foreignObject>section.invert h5 strong,div#p>svg>foreignObject>section.invert h6 strong{color:#81d4fa}div#p>svg>foreignObject>section.invert pre>code{background:#fff8e1}div#p>svg>foreignObject>section.invert blockquote:after,div#p>svg>foreignObject>section.invert blockquote:before,div#p>svg>foreignObject>section.invert footer,div#p>svg>foreignObject>section.invert header,div#p>svg>foreignObject>section.invert section:after{color:#dad8c8}div#p>svg>foreignObject>section.invert table td,div#p>svg>foreignObject>section.invert table th{border-color:#fff8e1}div#p>svg>foreignObject>section.invert table thead th{background:#fff8e1;color:#455a64}div#p>svg>foreignObject>section.invert table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section.invert table tbody>tr:nth-child(odd) th{background:rgba(255,248,225,.1)}div#p>svg>foreignObject>section.gaia{color:#fff8e1;background-color:#0288d1}div#p>svg>foreignObject>section.gaia a,div#p>svg>foreignObject>section.gaia mark{color:#81d4fa}div#p>svg>foreignObject>section.gaia code{background:#cce2de;color:#0288d1}div#p>svg>foreignObject>section.gaia h1 strong,div#p>svg>foreignObject>section.gaia h2 strong,div#p>svg>foreignObject>section.gaia h3 strong,div#p>svg>foreignObject>section.gaia h4 strong,div#p>svg>foreignObject>section.gaia h5 strong,div#p>svg>foreignObject>section.gaia h6 strong{color:#81d4fa}div#p>svg>foreignObject>section.gaia pre>code{background:#fff8e1}div#p>svg>foreignObject>section.gaia blockquote:after,div#p>svg>foreignObject>section.gaia blockquote:before,div#p>svg>foreignObject>section.gaia footer,div#p>svg>foreignObject>section.gaia header,div#p>svg>foreignObject>section.gaia section:after{color:#cce2de}div#p>svg>foreignObject>section.gaia table td,div#p>svg>foreignObject>section.gaia table th{border-color:#fff8e1}div#p>svg>foreignObject>section.gaia table thead th{background:#fff8e1;color:#0288d1}div#p>svg>foreignObject>section.gaia table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section.gaia table tbody>tr:nth-child(odd) th{background:rgba(255,248,225,.1)}div#p>svg>foreignObject>section.lead{display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:center}div#p>svg>foreignObject>section.lead h1,div#p>svg>foreignObject>section.lead h2,div#p>svg>foreignObject>section.lead h3,div#p>svg>foreignObject>section.lead h4,div#p>svg>foreignObject>section.lead h5,div#p>svg>foreignObject>section.lead h6{text-align:center}div#p>svg>foreignObject>section.lead h1 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h2 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h3 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h4 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h5 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h6 svg[data-marp-fitting=svg]{--preserve-aspect-ratio:xMidYMid meet}div#p>svg>foreignObject>section.lead p{text-align:center}div#p>svg>foreignObject>section.lead blockquote>h1,div#p>svg>foreignObject>section.lead blockquote>h2,div#p>svg>foreignObject>section.lead blockquote>h3,div#p>svg>foreignObject>section.lead blockquote>h4,div#p>svg>foreignObject>section.lead blockquote>h5,div#p>svg>foreignObject>section.lead blockquote>h6,div#p>svg>foreignObject>section.lead blockquote>p{text-align:left}div#p>svg>foreignObject>section.lead blockquote svg[data-marp-fitting=svg]:not([data-marp-fitting-math]){--preserve-aspect-ratio:xMinYMin meet}div#p>svg>foreignObject>section.lead ol>li>p,div#p>svg>foreignObject>section.lead ul>li>p{text-align:left}div#p>svg>foreignObject>section.lead table{margin-left:auto;margin-right:auto}div#p>svg>foreignObject>section:after,div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{box-sizing:border-box;font-size:66%;height:70px;line-height:50px;overflow:hidden;padding:10px 25px;position:absolute}div#p>svg>foreignObject>section:after{--marpit-root-font-size:66%}div#p>svg>foreignObject>section header{top:0}div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{left:0;right:0}div#p>svg>foreignObject>section footer{bottom:0}div#p>svg>foreignObject>section:after{right:0;bottom:0;font-size:80%}div#p>svg>foreignObject>section:after{--marpit-root-font-size:80%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]{display:block!important;padding:0!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:before,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:before{display:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction=vertical]{flex-direction:column}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split]>div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split,50%)}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split=right]>div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]>figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#p>svg>foreignObject>section[data-marpit-advanced-background=content],div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo]{background:transparent!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo],div#p>svg[data-marpit-svg]>foreignObject[data-marpit-advanced-background=pseudo]{pointer-events:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background-split]{width:100%;height:100%}</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id="p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-class="lead" data-theme="gaia" class="lead" data-marpit-pagination="1" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--class:lead;--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h1>第 7 章 数据清洗与准备</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="2" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>在数据分析和建模的过程中，相当多的时间要用在数据准备上：加载、清理、转换以及重塑。这些工作会占到分析师时间的80%或更多。有时，存储在文件和数据库中的数据的格式不适合某个特定的任务。许多研究者都选择使用通用编程语言（如Python、Perl、R或Java）或UNIX文本处理工具（如sed或awk）对数据格式进行专门处理。幸运的是，pandas和内置的Python标准库提供了一组高级的、灵活的、快速的工具，可以让你轻松地将数据规整为想要的格式。</p>
<p>如果你发现了一种本书或pandas库中没有的数据操作方式，请在邮件列表或GitHub网站上提出。实际上，pandas的许多设计和实现都是由真实应用的需求所驱动的。</p>
<p>在本章中，我会讨论处理缺失数据、重复数据、字符串操作和其它分析数据转换的工具。下一章，我会关注于用多种方法合并、重塑数据集。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="3" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>7.1 处理缺失数据</h2>
<p>在许多数据分析工作中，缺失数据是经常发生的。pandas的目标之一就是尽量轻松地处理缺失数据。例如，pandas对象的所有描述性统计默认都不包括缺失数据。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="4" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>缺失数据在pandas中呈现的方式有些不完美，但对于大多数用户可以保证功能正常。对于数值数据，pandas使用浮点值NaN（Not a Number）表示缺失数据。我们称其为哨兵值，可以方便的检测出来：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="5" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">10</span>]: string_data = pd.Series([<span class="hljs-string">&#x27;aardvark&#x27;</span>, <span class="hljs-string">&#x27;artichoke&#x27;</span>, np.nan, <span class="hljs-string">&#x27;avocado&#x27;</span>])

In [<span class="hljs-number">11</span>]: string_data
Out[<span class="hljs-number">11</span>]:
<span class="hljs-number">0</span>     aardvark
<span class="hljs-number">1</span>    artichoke
<span class="hljs-number">2</span>          NaN
<span class="hljs-number">3</span>      avocado
dtype: object

In [<span class="hljs-number">12</span>]: string_data.isnull()
Out[<span class="hljs-number">12</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">1</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">2</span>     <span class="hljs-literal">True</span>
<span class="hljs-number">3</span>    <span class="hljs-literal">False</span>
dtype: bool
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="6" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>在pandas中，我们采用了R语言中的惯用法，即将缺失值表示为NA，它表示不可用not available。在统计应用中，NA数据可能是不存在的数据或者虽然存在，但是没有观察到（例如，数据采集中发生了问题）。当进行数据清洗以进行分析时，最好直接对缺失数据进行分析，以判断数据采集的问题或缺失数据可能导致的偏差。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="7" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>Python内置的None值在对象数组中也可以作为NA：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">13</span>]: string_data[<span class="hljs-number">0</span>] = <span class="hljs-literal">None</span>

In [<span class="hljs-number">14</span>]: string_data.isnull()
Out[<span class="hljs-number">14</span>]: 
<span class="hljs-number">0</span>     <span class="hljs-literal">True</span>
<span class="hljs-number">1</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">2</span>     <span class="hljs-literal">True</span>
<span class="hljs-number">3</span>    <span class="hljs-literal">False</span>
dtype: bool
</span></span></foreignObject></svg></code></pre>
<p>pandas项目中还在不断优化内部细节以更好处理缺失数据，像用户API功能，例如pandas.isnull，去除了许多恼人的细节。表7-1列出了一些关于缺失数据处理的函数。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="8" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-1a0f73e5bb26ea21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="表7-1 NA处理方法" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="9" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.1.1 过滤缺失数据</h3>
<p>过滤掉缺失数据的办法有很多种。你可以通过pandas.isnull或布尔索引的手工方法，但dropna可能会更实用一些。对于一个Series，dropna返回一个仅含非空数据和索引值的Series：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">15</span>]: <span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> nan <span class="hljs-keyword">as</span> NA

In [<span class="hljs-number">16</span>]: data = pd.Series([<span class="hljs-number">1</span>, NA, <span class="hljs-number">3.5</span>, NA, <span class="hljs-number">7</span>])

In [<span class="hljs-number">17</span>]: data.dropna()
Out[<span class="hljs-number">17</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-number">1.0</span>
<span class="hljs-number">2</span>    <span class="hljs-number">3.5</span>
<span class="hljs-number">4</span>    <span class="hljs-number">7.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="10" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>这等价于：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">18</span>]: data[data.notnull()]
Out[<span class="hljs-number">18</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-number">1.0</span>
<span class="hljs-number">2</span>    <span class="hljs-number">3.5</span>
<span class="hljs-number">4</span>    <span class="hljs-number">7.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="11" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>而对于DataFrame对象，事情就有点复杂了。你可能希望丢弃全NA或含有NA的行或列。dropna默认丢弃任何含有缺失值的行：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="12" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">19</span>]: data = pd.DataFrame([[<span class="hljs-number">1.</span>, <span class="hljs-number">6.5</span>, <span class="hljs-number">3.</span>], [<span class="hljs-number">1.</span>, NA, NA],
   ....:                      [NA, NA, NA], [NA, <span class="hljs-number">6.5</span>, <span class="hljs-number">3.</span>]])

In [<span class="hljs-number">20</span>]: cleaned = data.dropna()

In [<span class="hljs-number">21</span>]: data
Out[<span class="hljs-number">21</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span>
<span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span>
<span class="hljs-number">1</span>  <span class="hljs-number">1.0</span>  NaN  NaN
<span class="hljs-number">2</span>  NaN  NaN  NaN
<span class="hljs-number">3</span>  NaN  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span>

In [<span class="hljs-number">22</span>]: cleaned
Out[<span class="hljs-number">22</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span>
<span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="13" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>传入how='all'将只丢弃全为NA的那些行：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">23</span>]: data.dropna(how=<span class="hljs-string">&#x27;all&#x27;</span>)
Out[<span class="hljs-number">23</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span>
<span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span>
<span class="hljs-number">1</span>  <span class="hljs-number">1.0</span>  NaN  NaN
<span class="hljs-number">3</span>  NaN  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="14" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>用这种方式丢弃列，只需传入axis=1即可：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">24</span>]: data[<span class="hljs-number">4</span>] = NA

In [<span class="hljs-number">25</span>]: data
Out[<span class="hljs-number">25</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span>   <span class="hljs-number">4</span>
<span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span> NaN
<span class="hljs-number">1</span>  <span class="hljs-number">1.0</span>  NaN  NaN NaN
<span class="hljs-number">2</span>  NaN  NaN  NaN NaN
<span class="hljs-number">3</span>  NaN  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span> NaN

In [<span class="hljs-number">26</span>]: data.dropna(axis=<span class="hljs-number">1</span>, how=<span class="hljs-string">&#x27;all&#x27;</span>)
Out[<span class="hljs-number">26</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span>
<span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span>
<span class="hljs-number">1</span>  <span class="hljs-number">1.0</span>  NaN  NaN
<span class="hljs-number">2</span>  NaN  NaN  NaN
<span class="hljs-number">3</span>  NaN  <span class="hljs-number">6.5</span>  <span class="hljs-number">3.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="15" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>另一个过滤DataFrame行的问题涉及时间序列数据。假设你只想留下一部分观测数据，可以用thresh参数实现此目的：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">27</span>]: df = pd.DataFrame(np.random.randn(<span class="hljs-number">7</span>, <span class="hljs-number">3</span>))

In [<span class="hljs-number">28</span>]: df.iloc[:<span class="hljs-number">4</span>, <span class="hljs-number">1</span>] = NA

In [<span class="hljs-number">29</span>]: df.iloc[:<span class="hljs-number">2</span>, <span class="hljs-number">2</span>] = NA

In [<span class="hljs-number">30</span>]: df
Out[<span class="hljs-number">30</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">0</span> <span class="hljs-number">-0.204708</span>       NaN       NaN
<span class="hljs-number">1</span> <span class="hljs-number">-0.555730</span>       NaN       NaN
<span class="hljs-number">2</span>  <span class="hljs-number">0.092908</span>       NaN  <span class="hljs-number">0.769023</span>
<span class="hljs-number">3</span>  <span class="hljs-number">1.246435</span>       NaN <span class="hljs-number">-1.296221</span>
<span class="hljs-number">4</span>  <span class="hljs-number">0.274992</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>
<span class="hljs-number">5</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span> <span class="hljs-number">-0.371843</span>
<span class="hljs-number">6</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>

In [<span class="hljs-number">31</span>]: df.dropna()
Out[<span class="hljs-number">31</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">4</span>  <span class="hljs-number">0.274992</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>
<span class="hljs-number">5</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span> <span class="hljs-number">-0.371843</span>
<span class="hljs-number">6</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="16" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">32</span>]: df.dropna(thresh=<span class="hljs-number">2</span>)
Out[<span class="hljs-number">32</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">2</span>  <span class="hljs-number">0.092908</span>       NaN  <span class="hljs-number">0.769023</span>
<span class="hljs-number">3</span>  <span class="hljs-number">1.246435</span>       NaN <span class="hljs-number">-1.296221</span>
<span class="hljs-number">4</span>  <span class="hljs-number">0.274992</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>
<span class="hljs-number">5</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span> <span class="hljs-number">-0.371843</span>
<span class="hljs-number">6</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="17" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.1.2 补全缺失数据</h3>
<p>你可能不想过滤缺失数据（有可能会丢弃跟它有关的其他数据），而是希望通过其他方式填补那些“空洞”。对于大多数情况而言，fillna方法是最主要的函数。通过一个常数调用fillna就会将缺失值替换为那个常数值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">33</span>]: df.fillna(<span class="hljs-number">0</span>)
Out[<span class="hljs-number">33</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">0</span> <span class="hljs-number">-0.204708</span>  <span class="hljs-number">0.000000</span>  <span class="hljs-number">0.000000</span>
<span class="hljs-number">1</span> <span class="hljs-number">-0.555730</span>  <span class="hljs-number">0.000000</span>  <span class="hljs-number">0.000000</span>
<span class="hljs-number">2</span>  <span class="hljs-number">0.092908</span>  <span class="hljs-number">0.000000</span>  <span class="hljs-number">0.769023</span>
<span class="hljs-number">3</span>  <span class="hljs-number">1.246435</span>  <span class="hljs-number">0.000000</span> <span class="hljs-number">-1.296221</span>
<span class="hljs-number">4</span>  <span class="hljs-number">0.274992</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>
<span class="hljs-number">5</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span> <span class="hljs-number">-0.371843</span>
<span class="hljs-number">6</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="18" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="18" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>若是通过一个字典调用fillna，就可以实现对不同的列填充不同的值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">34</span>]: df.fillna({<span class="hljs-number">1</span>: <span class="hljs-number">0.5</span>, <span class="hljs-number">2</span>: <span class="hljs-number">0</span>})
Out[<span class="hljs-number">34</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">0</span> <span class="hljs-number">-0.204708</span>  <span class="hljs-number">0.500000</span>  <span class="hljs-number">0.000000</span>
<span class="hljs-number">1</span> <span class="hljs-number">-0.555730</span>  <span class="hljs-number">0.500000</span>  <span class="hljs-number">0.000000</span>
<span class="hljs-number">2</span>  <span class="hljs-number">0.092908</span>  <span class="hljs-number">0.500000</span>  <span class="hljs-number">0.769023</span>
<span class="hljs-number">3</span>  <span class="hljs-number">1.246435</span>  <span class="hljs-number">0.500000</span> <span class="hljs-number">-1.296221</span>
<span class="hljs-number">4</span>  <span class="hljs-number">0.274992</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>
<span class="hljs-number">5</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span> <span class="hljs-number">-0.371843</span>
<span class="hljs-number">6</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="19" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>fillna默认会返回新对象，但也可以对现有对象进行就地修改：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">35</span>]: _ = df.fillna(<span class="hljs-number">0</span>, inplace=<span class="hljs-literal">True</span>)

In [<span class="hljs-number">36</span>]: df
Out[<span class="hljs-number">36</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">0</span> <span class="hljs-number">-0.204708</span>  <span class="hljs-number">0.000000</span>  <span class="hljs-number">0.000000</span>
<span class="hljs-number">1</span> <span class="hljs-number">-0.555730</span>  <span class="hljs-number">0.000000</span>  <span class="hljs-number">0.000000</span>
<span class="hljs-number">2</span>  <span class="hljs-number">0.092908</span>  <span class="hljs-number">0.000000</span>  <span class="hljs-number">0.769023</span>
<span class="hljs-number">3</span>  <span class="hljs-number">1.246435</span>  <span class="hljs-number">0.000000</span> <span class="hljs-number">-1.296221</span>
<span class="hljs-number">4</span>  <span class="hljs-number">0.274992</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>
<span class="hljs-number">5</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span> <span class="hljs-number">-0.371843</span>
<span class="hljs-number">6</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="20" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对重建索引(reindexing)有效的那些插值方法也可用于fillna：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">37</span>]: df = pd.DataFrame(np.random.randn(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>))

In [<span class="hljs-number">38</span>]: df.iloc[<span class="hljs-number">2</span>:, <span class="hljs-number">1</span>] = NA

In [<span class="hljs-number">39</span>]: df.iloc[<span class="hljs-number">4</span>:, <span class="hljs-number">2</span>] = NA

In [<span class="hljs-number">40</span>]: df
Out[<span class="hljs-number">40</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">0</span>  <span class="hljs-number">0.476985</span>  <span class="hljs-number">3.248944</span> <span class="hljs-number">-1.021228</span>
<span class="hljs-number">1</span> <span class="hljs-number">-0.577087</span>  <span class="hljs-number">0.124121</span>  <span class="hljs-number">0.302614</span>
<span class="hljs-number">2</span>  <span class="hljs-number">0.523772</span>       NaN  <span class="hljs-number">1.343810</span>
<span class="hljs-number">3</span> <span class="hljs-number">-0.713544</span>       NaN <span class="hljs-number">-2.370232</span>
<span class="hljs-number">4</span> <span class="hljs-number">-1.860761</span>       NaN       NaN
<span class="hljs-number">5</span> <span class="hljs-number">-1.265934</span>       NaN       NaN

In [<span class="hljs-number">41</span>]: df.fillna(method=<span class="hljs-string">&#x27;ffill&#x27;</span>)
Out[<span class="hljs-number">41</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">0</span>  <span class="hljs-number">0.476985</span>  <span class="hljs-number">3.248944</span> <span class="hljs-number">-1.021228</span>
<span class="hljs-number">1</span> <span class="hljs-number">-0.577087</span>  <span class="hljs-number">0.124121</span>  <span class="hljs-number">0.302614</span>
<span class="hljs-number">2</span>  <span class="hljs-number">0.523772</span>  <span class="hljs-number">0.124121</span>  <span class="hljs-number">1.343810</span>
<span class="hljs-number">3</span> <span class="hljs-number">-0.713544</span>  <span class="hljs-number">0.124121</span> <span class="hljs-number">-2.370232</span>
<span class="hljs-number">4</span> <span class="hljs-number">-1.860761</span>  <span class="hljs-number">0.124121</span> <span class="hljs-number">-2.370232</span>
<span class="hljs-number">5</span> <span class="hljs-number">-1.265934</span>  <span class="hljs-number">0.124121</span> <span class="hljs-number">-2.370232</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="21" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">42</span>]: df.fillna(method=<span class="hljs-string">&#x27;ffill&#x27;</span>, limit=<span class="hljs-number">2</span>)
Out[<span class="hljs-number">42</span>]: 
          <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>
<span class="hljs-number">0</span>  <span class="hljs-number">0.476985</span>  <span class="hljs-number">3.248944</span> <span class="hljs-number">-1.021228</span>
<span class="hljs-number">1</span> <span class="hljs-number">-0.577087</span>  <span class="hljs-number">0.124121</span>  <span class="hljs-number">0.302614</span>
<span class="hljs-number">2</span>  <span class="hljs-number">0.523772</span>  <span class="hljs-number">0.124121</span>  <span class="hljs-number">1.343810</span>
<span class="hljs-number">3</span> <span class="hljs-number">-0.713544</span>  <span class="hljs-number">0.124121</span> <span class="hljs-number">-2.370232</span>
<span class="hljs-number">4</span> <span class="hljs-number">-1.860761</span>       NaN <span class="hljs-number">-2.370232</span>
<span class="hljs-number">5</span> <span class="hljs-number">-1.265934</span>       NaN <span class="hljs-number">-2.370232</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="22" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>只要有些创新，你就可以利用fillna实现许多别的功能。比如说，你可以传入Series的平均值或中位数：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">43</span>]: data = pd.Series([<span class="hljs-number">1.</span>, NA, <span class="hljs-number">3.5</span>, NA, <span class="hljs-number">7</span>])

In [<span class="hljs-number">44</span>]: data.fillna(data.mean())
Out[<span class="hljs-number">44</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-number">1.000000</span>
<span class="hljs-number">1</span>    <span class="hljs-number">3.833333</span>
<span class="hljs-number">2</span>    <span class="hljs-number">3.500000</span>
<span class="hljs-number">3</span>    <span class="hljs-number">3.833333</span>
<span class="hljs-number">4</span>    <span class="hljs-number">7.000000</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="23" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>表7-2列出了fillna的参考。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-0bf235386a64c3b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-4edd39e68f4dc530.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="fillna函数参数" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="24" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>7.2 数据转换</h2>
<p>本章到目前为止介绍的都是数据的重排。另一类重要操作则是过滤、清理以及其他的转换工作。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="25" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.1 删除重复数据</h3>
<p>DataFrame中出现重复行有多种原因。下面就是一个例子：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">45</span>]: data = pd.DataFrame({<span class="hljs-string">&#x27;k1&#x27;</span>: [<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>] * <span class="hljs-number">3</span> + [<span class="hljs-string">&#x27;two&#x27;</span>],
   ....:                      <span class="hljs-string">&#x27;k2&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>]})

In [<span class="hljs-number">46</span>]: data
Out[<span class="hljs-number">46</span>]: 
    k1  k2
<span class="hljs-number">0</span>  one   <span class="hljs-number">1</span>
<span class="hljs-number">1</span>  two   <span class="hljs-number">1</span>
<span class="hljs-number">2</span>  one   <span class="hljs-number">2</span>
<span class="hljs-number">3</span>  two   <span class="hljs-number">3</span>
<span class="hljs-number">4</span>  one   <span class="hljs-number">3</span>
<span class="hljs-number">5</span>  two   <span class="hljs-number">4</span>
<span class="hljs-number">6</span>  two   <span class="hljs-number">4</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="26" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>DataFrame的duplicated方法返回一个布尔型Series，表示各行是否是重复行（前面出现过的行）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">47</span>]: data.duplicated()
Out[<span class="hljs-number">47</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">1</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">2</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">3</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">4</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">5</span>    <span class="hljs-literal">False</span>
<span class="hljs-number">6</span>     <span class="hljs-literal">True</span>
dtype: bool
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="27" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>还有一个与此相关的drop_duplicates方法，它会返回一个DataFrame，重复的数组会标为False：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">48</span>]: data.drop_duplicates()
Out[<span class="hljs-number">48</span>]: 
    k1  k2
<span class="hljs-number">0</span>  one   <span class="hljs-number">1</span>
<span class="hljs-number">1</span>  two   <span class="hljs-number">1</span>
<span class="hljs-number">2</span>  one   <span class="hljs-number">2</span>
<span class="hljs-number">3</span>  two   <span class="hljs-number">3</span>
<span class="hljs-number">4</span>  one   <span class="hljs-number">3</span>
<span class="hljs-number">5</span>  two   <span class="hljs-number">4</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="28" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>这两个方法默认会判断全部列，你也可以指定部分列进行重复项判断。假设我们还有一列值，且只希望根据k1列过滤重复项：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">49</span>]: data[<span class="hljs-string">&#x27;v1&#x27;</span>] = range(<span class="hljs-number">7</span>)

In [<span class="hljs-number">50</span>]: data.drop_duplicates([<span class="hljs-string">&#x27;k1&#x27;</span>])
Out[<span class="hljs-number">50</span>]: 
    k1  k2  v1
<span class="hljs-number">0</span>  one   <span class="hljs-number">1</span>   <span class="hljs-number">0</span>
<span class="hljs-number">1</span>  two   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="29" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>duplicated和drop_duplicates默认保留的是第一个出现的值组合。传入keep='last'则保留最后一个：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">51</span>]: data.drop_duplicates([<span class="hljs-string">&#x27;k1&#x27;</span>, <span class="hljs-string">&#x27;k2&#x27;</span>], keep=<span class="hljs-string">&#x27;last&#x27;</span>)
Out[<span class="hljs-number">51</span>]: 
    k1  k2  v1
<span class="hljs-number">0</span>  one   <span class="hljs-number">1</span>   <span class="hljs-number">0</span>
<span class="hljs-number">1</span>  two   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>
<span class="hljs-number">2</span>  one   <span class="hljs-number">2</span>   <span class="hljs-number">2</span>
<span class="hljs-number">3</span>  two   <span class="hljs-number">3</span>   <span class="hljs-number">3</span>
<span class="hljs-number">4</span>  one   <span class="hljs-number">3</span>   <span class="hljs-number">4</span>
<span class="hljs-number">6</span>  two   <span class="hljs-number">4</span>   <span class="hljs-number">6</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="30" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.2 利用函数或映射进行数据转换</h3>
<p>对于许多数据集，你可能希望根据数组、Series或DataFrame列中的值来实现转换工作。我们来看看下面这组有关肉类的数据：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="31" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">52</span>]: data = pd.DataFrame({<span class="hljs-string">&#x27;food&#x27;</span>: [<span class="hljs-string">&#x27;bacon&#x27;</span>, <span class="hljs-string">&#x27;pulled pork&#x27;</span>, <span class="hljs-string">&#x27;bacon&#x27;</span>,
   ....:                               <span class="hljs-string">&#x27;Pastrami&#x27;</span>, <span class="hljs-string">&#x27;corned beef&#x27;</span>, <span class="hljs-string">&#x27;Bacon&#x27;</span>,
   ....:                               <span class="hljs-string">&#x27;pastrami&#x27;</span>, <span class="hljs-string">&#x27;honey ham&#x27;</span>, <span class="hljs-string">&#x27;nova lox&#x27;</span>],
   ....:                      <span class="hljs-string">&#x27;ounces&#x27;</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">12</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7.5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]})

In [<span class="hljs-number">53</span>]: data
Out[<span class="hljs-number">53</span>]: 
          food  ounces
<span class="hljs-number">0</span>        bacon     <span class="hljs-number">4.0</span>
<span class="hljs-number">1</span>  pulled pork     <span class="hljs-number">3.0</span>
<span class="hljs-number">2</span>        bacon    <span class="hljs-number">12.0</span>
<span class="hljs-number">3</span>     Pastrami     <span class="hljs-number">6.0</span>
<span class="hljs-number">4</span>  corned beef     <span class="hljs-number">7.5</span>
<span class="hljs-number">5</span>        Bacon     <span class="hljs-number">8.0</span>
<span class="hljs-number">6</span>     pastrami     <span class="hljs-number">3.0</span>
<span class="hljs-number">7</span>    honey ham     <span class="hljs-number">5.0</span>
<span class="hljs-number">8</span>     nova lox     <span class="hljs-number">6.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="32" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>假设你想要添加一列表示该肉类食物来源的动物类型。我们先编写一个不同肉类到动物的映射：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>meat_to_animal = {
  <span class="hljs-string">&#x27;bacon&#x27;</span>: <span class="hljs-string">&#x27;pig&#x27;</span>,
  <span class="hljs-string">&#x27;pulled pork&#x27;</span>: <span class="hljs-string">&#x27;pig&#x27;</span>,
  <span class="hljs-string">&#x27;pastrami&#x27;</span>: <span class="hljs-string">&#x27;cow&#x27;</span>,
  <span class="hljs-string">&#x27;corned beef&#x27;</span>: <span class="hljs-string">&#x27;cow&#x27;</span>,
  <span class="hljs-string">&#x27;honey ham&#x27;</span>: <span class="hljs-string">&#x27;pig&#x27;</span>,
  <span class="hljs-string">&#x27;nova lox&#x27;</span>: <span class="hljs-string">&#x27;salmon&#x27;</span>
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="33" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="33" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>Series的map方法可以接受一个函数或含有映射关系的字典型对象，但是这里有一个小问题，即有些肉类的首字母大写了，而另一些则没有。因此，我们还需要使用Series的str.lower方法，将各个值转换为小写：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">55</span>]: lowercased = data[<span class="hljs-string">&#x27;food&#x27;</span>].str.lower()

In [<span class="hljs-number">56</span>]: lowercased
Out[<span class="hljs-number">56</span>]: 
<span class="hljs-number">0</span>          bacon
<span class="hljs-number">1</span>    pulled pork
<span class="hljs-number">2</span>          bacon
<span class="hljs-number">3</span>       pastrami
<span class="hljs-number">4</span>    corned beef
<span class="hljs-number">5</span>          bacon
<span class="hljs-number">6</span>       pastrami
<span class="hljs-number">7</span>      honey ham
<span class="hljs-number">8</span>       nova lox
Name: food, dtype: object
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="34" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="34" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">57</span>]: data[<span class="hljs-string">&#x27;animal&#x27;</span>] = lowercased.map(meat_to_animal)

In [<span class="hljs-number">58</span>]: data
Out[<span class="hljs-number">58</span>]: 
          food  ounces  animal
<span class="hljs-number">0</span>        bacon     <span class="hljs-number">4.0</span>     pig
<span class="hljs-number">1</span>  pulled pork     <span class="hljs-number">3.0</span>     pig
<span class="hljs-number">2</span>        bacon    <span class="hljs-number">12.0</span>     pig
<span class="hljs-number">3</span>     Pastrami     <span class="hljs-number">6.0</span>     cow
<span class="hljs-number">4</span>  corned beef     <span class="hljs-number">7.5</span>     cow
<span class="hljs-number">5</span>        Bacon     <span class="hljs-number">8.0</span>     pig
<span class="hljs-number">6</span>     pastrami     <span class="hljs-number">3.0</span>     cow
<span class="hljs-number">7</span>    honey ham     <span class="hljs-number">5.0</span>     pig
<span class="hljs-number">8</span>     nova lox     <span class="hljs-number">6.0</span>  salmon
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="35" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>我们也可以传入一个能够完成全部这些工作的函数：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">59</span>]: data[<span class="hljs-string">&#x27;food&#x27;</span>].map(<span class="hljs-keyword">lambda</span> x: meat_to_animal[x.lower()])
Out[<span class="hljs-number">59</span>]: 
<span class="hljs-number">0</span>       pig
<span class="hljs-number">1</span>       pig
<span class="hljs-number">2</span>       pig
<span class="hljs-number">3</span>       cow
<span class="hljs-number">4</span>       cow
<span class="hljs-number">5</span>       pig
<span class="hljs-number">6</span>       cow
<span class="hljs-number">7</span>       pig
<span class="hljs-number">8</span>    salmon
Name: food, dtype: object
</span></span></foreignObject></svg></code></pre>
<p>使用map是一种实现元素级转换以及其他数据清理工作的便捷方式。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="36" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.3 替代值</h3>
<p>利用fillna方法填充缺失数据可以看做值替换的一种特殊情况。前面已经看到，map可用于修改对象的数据子集，而replace则提供了一种实现该功能的更简单、更灵活的方式。我们来看看下面这个Series：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">60</span>]: data = pd.Series([<span class="hljs-number">1.</span>, <span class="hljs-number">-999.</span>, <span class="hljs-number">2.</span>, <span class="hljs-number">-999.</span>, <span class="hljs-number">-1000.</span>, <span class="hljs-number">3.</span>])

In [<span class="hljs-number">61</span>]: data
Out[<span class="hljs-number">61</span>]: 
<span class="hljs-number">0</span>       <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>    <span class="hljs-number">-999.0</span>
<span class="hljs-number">2</span>       <span class="hljs-number">2.0</span>
<span class="hljs-number">3</span>    <span class="hljs-number">-999.0</span>
<span class="hljs-number">4</span>   <span class="hljs-number">-1000.0</span>
<span class="hljs-number">5</span>       <span class="hljs-number">3.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="37" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="37" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>-999这个值可能是一个表示缺失数据的标记值。要将其替换为pandas能够理解的NA值，我们可以利用replace来产生一个新的Series（除非传入inplace=True）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">62</span>]: data.replace(<span class="hljs-number">-999</span>, np.nan)
Out[<span class="hljs-number">62</span>]: 
<span class="hljs-number">0</span>       <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>       NaN
<span class="hljs-number">2</span>       <span class="hljs-number">2.0</span>
<span class="hljs-number">3</span>       NaN
<span class="hljs-number">4</span>   <span class="hljs-number">-1000.0</span>
<span class="hljs-number">5</span>       <span class="hljs-number">3.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="38" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="38" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果你希望一次性替换多个值，可以传入一个由待替换值组成的列表以及一个替换值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">63</span>]: data.replace([<span class="hljs-number">-999</span>, <span class="hljs-number">-1000</span>], np.nan)
Out[<span class="hljs-number">63</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>    NaN
<span class="hljs-number">2</span>    <span class="hljs-number">2.0</span>
<span class="hljs-number">3</span>    NaN
<span class="hljs-number">4</span>    NaN
<span class="hljs-number">5</span>    <span class="hljs-number">3.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="39" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="39" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>要让每个值有不同的替换值，可以传递一个替换列表：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">64</span>]: data.replace([<span class="hljs-number">-999</span>, <span class="hljs-number">-1000</span>], [np.nan, <span class="hljs-number">0</span>])
Out[<span class="hljs-number">64</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>    NaN
<span class="hljs-number">2</span>    <span class="hljs-number">2.0</span>
<span class="hljs-number">3</span>    NaN
<span class="hljs-number">4</span>    <span class="hljs-number">0.0</span>
<span class="hljs-number">5</span>    <span class="hljs-number">3.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="40" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="40" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>传入的参数也可以是字典：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">65</span>]: data.replace({<span class="hljs-number">-999</span>: np.nan, <span class="hljs-number">-1000</span>: <span class="hljs-number">0</span>})
Out[<span class="hljs-number">65</span>]: 
<span class="hljs-number">0</span>    <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>    NaN
<span class="hljs-number">2</span>    <span class="hljs-number">2.0</span>
<span class="hljs-number">3</span>    NaN
<span class="hljs-number">4</span>    <span class="hljs-number">0.0</span>
<span class="hljs-number">5</span>    <span class="hljs-number">3.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
<blockquote>
<p>笔记：data.replace方法与data.str.replace不同，后者做的是字符串的元素级替换。我们会在后面学习Series的字符串方法。</p>
</blockquote>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="41" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="41" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.4 重命名轴索引</h3>
<p>跟Series中的值一样，轴标签也可以通过函数或映射进行转换，从而得到一个新的不同标签的对象。轴还可以被就地修改，而无需新建一个数据结构。接下来看看下面这个简单的例子：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">66</span>]: data = pd.DataFrame(np.arange(<span class="hljs-number">12</span>).reshape((<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)),
   ....:                     index=[<span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Colorado&#x27;</span>, <span class="hljs-string">&#x27;New York&#x27;</span>],
   ....:                     columns=[<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>, <span class="hljs-string">&#x27;four&#x27;</span>])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="42" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="42" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>跟Series一样，轴索引也有一个map方法：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">67</span>]: transform = <span class="hljs-keyword">lambda</span> x: x[:<span class="hljs-number">4</span>].upper()

In [<span class="hljs-number">68</span>]: data.index.map(transform)
Out[<span class="hljs-number">68</span>]: Index([<span class="hljs-string">&#x27;OHIO&#x27;</span>, <span class="hljs-string">&#x27;COLO&#x27;</span>, <span class="hljs-string">&#x27;NEW &#x27;</span>], dtype=<span class="hljs-string">&#x27;object&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="43" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="43" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>你可以将其赋值给index，这样就可以对DataFrame进行就地修改：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">69</span>]: data.index = data.index.map(transform)

In [<span class="hljs-number">70</span>]: data
Out[<span class="hljs-number">70</span>]:
one  two  three  four
OHIO    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>      <span class="hljs-number">2</span>     <span class="hljs-number">3</span>
COLO    <span class="hljs-number">4</span>    <span class="hljs-number">5</span>      <span class="hljs-number">6</span>     <span class="hljs-number">7</span>
NEW     <span class="hljs-number">8</span>    <span class="hljs-number">9</span>     <span class="hljs-number">10</span>    <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="44" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="44" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果想要创建数据集的转换版（而不是修改原始数据），比较实用的方法是rename：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">71</span>]: data.rename(index=str.title, columns=str.upper)
Out[<span class="hljs-number">71</span>]: 
      ONE  TWO  THREE  FOUR
Ohio    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>      <span class="hljs-number">2</span>     <span class="hljs-number">3</span>
Colo    <span class="hljs-number">4</span>    <span class="hljs-number">5</span>      <span class="hljs-number">6</span>     <span class="hljs-number">7</span>
New     <span class="hljs-number">8</span>    <span class="hljs-number">9</span>     <span class="hljs-number">10</span>    <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="45" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="45" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>特别说明一下，rename可以结合字典型对象实现对部分轴标签的更新：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">72</span>]: data.rename(index={<span class="hljs-string">&#x27;OHIO&#x27;</span>: <span class="hljs-string">&#x27;INDIANA&#x27;</span>},
   ....:             columns={<span class="hljs-string">&#x27;three&#x27;</span>: <span class="hljs-string">&#x27;peekaboo&#x27;</span>})
Out[<span class="hljs-number">72</span>]:
one  two  peekaboo  four
INDIANA    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>         <span class="hljs-number">2</span>     <span class="hljs-number">3</span>
COLO       <span class="hljs-number">4</span>    <span class="hljs-number">5</span>         <span class="hljs-number">6</span>     <span class="hljs-number">7</span>
NEW        <span class="hljs-number">8</span>    <span class="hljs-number">9</span>        <span class="hljs-number">10</span>    <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="46" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="46" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>rename可以实现复制DataFrame并对其索引和列标签进行赋值。如果希望就地修改某个数据集，传入inplace=True即可：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">73</span>]: data.rename(index={<span class="hljs-string">&#x27;OHIO&#x27;</span>: <span class="hljs-string">&#x27;INDIANA&#x27;</span>}, inplace=<span class="hljs-literal">True</span>)

In [<span class="hljs-number">74</span>]: data
Out[<span class="hljs-number">74</span>]: 
         one  two  three  four
INDIANA    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>      <span class="hljs-number">2</span>     <span class="hljs-number">3</span>
COLO       <span class="hljs-number">4</span>    <span class="hljs-number">5</span>      <span class="hljs-number">6</span>     <span class="hljs-number">7</span>
NEW        <span class="hljs-number">8</span>    <span class="hljs-number">9</span>     <span class="hljs-number">10</span>    <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="47" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="47" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.5 离散化和分箱</h3>
<p>为了便于分析，连续数据常常被离散化或拆分为“箱子”（bin）。假设有一组人员数据，而你希望将它们划分为不同的年龄组：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">75</span>]: ages = [<span class="hljs-number">20</span>, <span class="hljs-number">22</span>, <span class="hljs-number">25</span>, <span class="hljs-number">27</span>, <span class="hljs-number">21</span>, <span class="hljs-number">23</span>, <span class="hljs-number">37</span>, <span class="hljs-number">31</span>, <span class="hljs-number">61</span>, <span class="hljs-number">45</span>, <span class="hljs-number">41</span>, <span class="hljs-number">32</span>]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="48" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="48" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>接下来将这些数据划分为“18到25”、“26到35”、“35到60”以及“60以上”几个面元。要实现该功能，你需要使用pandas的cut函数：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">76</span>]: bins = [<span class="hljs-number">18</span>, <span class="hljs-number">25</span>, <span class="hljs-number">35</span>, <span class="hljs-number">60</span>, <span class="hljs-number">100</span>]

In [<span class="hljs-number">77</span>]: cats = pd.cut(ages, bins)

In [<span class="hljs-number">78</span>]: cats
Out[<span class="hljs-number">78</span>]: 
[(<span class="hljs-number">18</span>, <span class="hljs-number">25</span>], (<span class="hljs-number">18</span>, <span class="hljs-number">25</span>], (<span class="hljs-number">18</span>, <span class="hljs-number">25</span>], (<span class="hljs-number">25</span>, <span class="hljs-number">35</span>], (<span class="hljs-number">18</span>, <span class="hljs-number">25</span>], ..., (<span class="hljs-number">25</span>, <span class="hljs-number">35</span>], (<span class="hljs-number">60</span>, <span class="hljs-number">100</span>], (<span class="hljs-number">35</span>,<span class="hljs-number">60</span>], (<span class="hljs-number">35</span>, <span class="hljs-number">60</span>], (<span class="hljs-number">25</span>, <span class="hljs-number">35</span>]]
Length: <span class="hljs-number">12</span>
Categories (<span class="hljs-number">4</span>, interval[int64]): [(<span class="hljs-number">18</span>, <span class="hljs-number">25</span>] &lt; (<span class="hljs-number">25</span>, <span class="hljs-number">35</span>] &lt; (<span class="hljs-number">35</span>, <span class="hljs-number">60</span>] &lt; (<span class="hljs-number">60</span>, <span class="hljs-number">100</span>]]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="49" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="49" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>pandas返回的是一个特殊的Categorical对象。结果展示了pandas.cut划分的面元。你可以将其看做一组表示面元名称的字符串。它的底层含有一个表示不同分类名称的类型数组，以及一个codes属性中的年龄数据的标签：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="50" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="50" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">79</span>]: cats.codes
Out[<span class="hljs-number">79</span>]: array([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], dtype=int8)

In [<span class="hljs-number">80</span>]: cats.categories
Out[<span class="hljs-number">80</span>]: 
IntervalIndex([(<span class="hljs-number">18</span>, <span class="hljs-number">25</span>], (<span class="hljs-number">25</span>, <span class="hljs-number">35</span>], (<span class="hljs-number">35</span>, <span class="hljs-number">60</span>], (<span class="hljs-number">60</span>, <span class="hljs-number">100</span>]]
              closed=<span class="hljs-string">&#x27;right&#x27;</span>,
              dtype=<span class="hljs-string">&#x27;interval[int64]&#x27;</span>)

In [<span class="hljs-number">81</span>]: pd.value_counts(cats)
Out[<span class="hljs-number">81</span>]: 
(<span class="hljs-number">18</span>, <span class="hljs-number">25</span>]     <span class="hljs-number">5</span>
(<span class="hljs-number">35</span>, <span class="hljs-number">60</span>]     <span class="hljs-number">3</span>
(<span class="hljs-number">25</span>, <span class="hljs-number">35</span>]     <span class="hljs-number">3</span>
(<span class="hljs-number">60</span>, <span class="hljs-number">100</span>]    <span class="hljs-number">1</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
<p>pd.value_counts(cats)是pandas.cut结果的箱数量的计数。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="51" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="51" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>跟“区间”的数学符号一样，圆括号表示开端，而方括号则表示闭端（包括）。哪边是闭端可以通过right=False进行修改：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">82</span>]: pd.cut(ages, [<span class="hljs-number">18</span>, <span class="hljs-number">26</span>, <span class="hljs-number">36</span>, <span class="hljs-number">61</span>, <span class="hljs-number">100</span>], right=<span class="hljs-literal">False</span>)
Out[<span class="hljs-number">82</span>]: 
[[<span class="hljs-number">18</span>, <span class="hljs-number">26</span>), [<span class="hljs-number">18</span>, <span class="hljs-number">26</span>), [<span class="hljs-number">18</span>, <span class="hljs-number">26</span>), [<span class="hljs-number">26</span>, <span class="hljs-number">36</span>), [<span class="hljs-number">18</span>, <span class="hljs-number">26</span>), ..., [<span class="hljs-number">26</span>, <span class="hljs-number">36</span>), [<span class="hljs-number">61</span>, <span class="hljs-number">100</span>), [<span class="hljs-number">36</span>,
 <span class="hljs-number">61</span>), [<span class="hljs-number">36</span>, <span class="hljs-number">61</span>), [<span class="hljs-number">26</span>, <span class="hljs-number">36</span>)]
Length: <span class="hljs-number">12</span>
Categories (<span class="hljs-number">4</span>, interval[int64]): [[<span class="hljs-number">18</span>, <span class="hljs-number">26</span>) &lt; [<span class="hljs-number">26</span>, <span class="hljs-number">36</span>) &lt; [<span class="hljs-number">36</span>, <span class="hljs-number">61</span>) &lt; [<span class="hljs-number">61</span>, <span class="hljs-number">100</span>)]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="52" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="52" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>你可以通过传递一个列表或数组到labels，设置自定义的箱名称：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">83</span>]: group_names = [<span class="hljs-string">&#x27;Youth&#x27;</span>, <span class="hljs-string">&#x27;YoungAdult&#x27;</span>, <span class="hljs-string">&#x27;MiddleAged&#x27;</span>, <span class="hljs-string">&#x27;Senior&#x27;</span>]

In [<span class="hljs-number">84</span>]: pd.cut(ages, bins, labels=group_names)
Out[<span class="hljs-number">84</span>]: 
[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, Mid
dleAged, YoungAdult]
Length: <span class="hljs-number">12</span>
Categories (<span class="hljs-number">4</span>, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="53" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="53" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果传cut整数个的箱来代替显式的箱边，则它会根据数据的最小值和最大值计算等长的箱。下面这个例子中，我们将一些均匀分布的数据分成四组：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">85</span>]: data = np.random.rand(<span class="hljs-number">20</span>)

In [<span class="hljs-number">86</span>]: pd.cut(data, <span class="hljs-number">4</span>, precision=<span class="hljs-number">2</span>)
Out[<span class="hljs-number">86</span>]: 
[(<span class="hljs-number">0.34</span>, <span class="hljs-number">0.55</span>], (<span class="hljs-number">0.34</span>, <span class="hljs-number">0.55</span>], (<span class="hljs-number">0.76</span>, <span class="hljs-number">0.97</span>], (<span class="hljs-number">0.76</span>, <span class="hljs-number">0.97</span>], (<span class="hljs-number">0.34</span>, <span class="hljs-number">0.55</span>], ..., (<span class="hljs-number">0.34</span>
, <span class="hljs-number">0.55</span>], (<span class="hljs-number">0.34</span>, <span class="hljs-number">0.55</span>], (<span class="hljs-number">0.55</span>, <span class="hljs-number">0.76</span>], (<span class="hljs-number">0.34</span>, <span class="hljs-number">0.55</span>], (<span class="hljs-number">0.12</span>, <span class="hljs-number">0.34</span>]]
Length: <span class="hljs-number">20</span>
Categories (<span class="hljs-number">4</span>, interval[float64]): [(<span class="hljs-number">0.12</span>, <span class="hljs-number">0.34</span>] &lt; (<span class="hljs-number">0.34</span>, <span class="hljs-number">0.55</span>] &lt; (<span class="hljs-number">0.55</span>, <span class="hljs-number">0.76</span>] &lt; 
(<span class="hljs-number">0.76</span>, <span class="hljs-number">0.97</span>]]
</span></span></foreignObject></svg></code></pre>
<p>选项 precision=2，限定小数只有两位。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="54" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="54" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>qcut是一个非常类似于cut的函数，它可以根据样本分位数对数据进行面元划分。根据数据的分布情况，cut可能无法使各个面元中含有相同数量的数据点。而qcut由于使用的是样本分位数，因此可以得到大小基本相等的箱：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="55" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="55" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">87</span>]: data = np.random.randn(<span class="hljs-number">1000</span>)  <span class="hljs-comment"># Normally distributed</span>

In [<span class="hljs-number">88</span>]: cats = pd.qcut(data, <span class="hljs-number">4</span>)  <span class="hljs-comment"># Cut into quartiles</span>

In [<span class="hljs-number">89</span>]: cats
Out[<span class="hljs-number">89</span>]: 
[(<span class="hljs-number">-0.0265</span>, <span class="hljs-number">0.62</span>], (<span class="hljs-number">0.62</span>, <span class="hljs-number">3.928</span>], (<span class="hljs-number">-0.68</span>, <span class="hljs-number">-0.0265</span>], (<span class="hljs-number">0.62</span>, <span class="hljs-number">3.928</span>], (<span class="hljs-number">-0.0265</span>, <span class="hljs-number">0.62</span>]
, ..., (<span class="hljs-number">-0.68</span>, <span class="hljs-number">-0.0265</span>], (<span class="hljs-number">-0.68</span>, <span class="hljs-number">-0.0265</span>], (<span class="hljs-number">-2.95</span>, <span class="hljs-number">-0.68</span>], (<span class="hljs-number">0.62</span>, <span class="hljs-number">3.928</span>], (<span class="hljs-number">-0.68</span>,
 <span class="hljs-number">-0.0265</span>]]
Length: <span class="hljs-number">1000</span>
Categories (<span class="hljs-number">4</span>, interval[float64]): [(<span class="hljs-number">-2.95</span>, <span class="hljs-number">-0.68</span>] &lt; (<span class="hljs-number">-0.68</span>, <span class="hljs-number">-0.0265</span>] &lt; (<span class="hljs-number">-0.0265</span>,
 <span class="hljs-number">0.62</span>] &lt;
                                    (<span class="hljs-number">0.62</span>, <span class="hljs-number">3.928</span>]]

In [<span class="hljs-number">90</span>]: pd.value_counts(cats)
Out[<span class="hljs-number">90</span>]:
(<span class="hljs-number">0.62</span>, <span class="hljs-number">3.928</span>]       <span class="hljs-number">250</span>
(<span class="hljs-number">-0.0265</span>, <span class="hljs-number">0.62</span>]     <span class="hljs-number">250</span>
(<span class="hljs-number">-0.68</span>, <span class="hljs-number">-0.0265</span>]    <span class="hljs-number">250</span>
(<span class="hljs-number">-2.95</span>, <span class="hljs-number">-0.68</span>]      <span class="hljs-number">250</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="56" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="56" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>与cut类似，你也可以传递自定义的分位数（0到1之间的数值，包含端点）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">91</span>]: pd.qcut(data, [<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.9</span>, <span class="hljs-number">1.</span>])
Out[<span class="hljs-number">91</span>]: 
[(<span class="hljs-number">-0.0265</span>, <span class="hljs-number">1.286</span>], (<span class="hljs-number">-0.0265</span>, <span class="hljs-number">1.286</span>], (<span class="hljs-number">-1.187</span>, <span class="hljs-number">-0.0265</span>], (<span class="hljs-number">-0.0265</span>, <span class="hljs-number">1.286</span>], (<span class="hljs-number">-0.026</span>
<span class="hljs-number">5</span>, <span class="hljs-number">1.286</span>], ..., (<span class="hljs-number">-1.187</span>, <span class="hljs-number">-0.0265</span>], (<span class="hljs-number">-1.187</span>, <span class="hljs-number">-0.0265</span>], (<span class="hljs-number">-2.95</span>, <span class="hljs-number">-1.187</span>], (<span class="hljs-number">-0.0265</span>, 
<span class="hljs-number">1.286</span>], (<span class="hljs-number">-1.187</span>, <span class="hljs-number">-0.0265</span>]]
Length: <span class="hljs-number">1000</span>
Categories (<span class="hljs-number">4</span>, interval[float64]): [(<span class="hljs-number">-2.95</span>, <span class="hljs-number">-1.187</span>] &lt; (<span class="hljs-number">-1.187</span>, <span class="hljs-number">-0.0265</span>] &lt; (<span class="hljs-number">-0.026</span>
<span class="hljs-number">5</span>, <span class="hljs-number">1.286</span>] &lt;
                                    (<span class="hljs-number">1.286</span>, <span class="hljs-number">3.928</span>]]
</span></span></foreignObject></svg></code></pre>
<p>本章稍后在讲解聚合和分组运算时会再次用到cut和qcut，因为这两个离散化函数对分位和分组分析非常重要。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="57" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="57" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.6 检测和过滤异常值</h3>
<p>过滤或变换异常值（outlier）在很大程度上就是运用数组运算。来看一个含有正态分布数据的DataFrame：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="58" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="58" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">92</span>]: data = pd.DataFrame(np.random.randn(<span class="hljs-number">1000</span>, <span class="hljs-number">4</span>))

In [<span class="hljs-number">93</span>]: data.describe()
Out[<span class="hljs-number">93</span>]: 
                 <span class="hljs-number">0</span>            <span class="hljs-number">1</span>            <span class="hljs-number">2</span>            <span class="hljs-number">3</span>
count  <span class="hljs-number">1000.000000</span>  <span class="hljs-number">1000.000000</span>  <span class="hljs-number">1000.000000</span>  <span class="hljs-number">1000.000000</span>
mean      <span class="hljs-number">0.049091</span>     <span class="hljs-number">0.026112</span>    <span class="hljs-number">-0.002544</span>    <span class="hljs-number">-0.051827</span>
std       <span class="hljs-number">0.996947</span>     <span class="hljs-number">1.007458</span>     <span class="hljs-number">0.995232</span>     <span class="hljs-number">0.998311</span>
min      <span class="hljs-number">-3.645860</span>    <span class="hljs-number">-3.184377</span>    <span class="hljs-number">-3.745356</span>    <span class="hljs-number">-3.428254</span>
<span class="hljs-number">25</span>%      <span class="hljs-number">-0.599807</span>    <span class="hljs-number">-0.612162</span>    <span class="hljs-number">-0.687373</span>    <span class="hljs-number">-0.747478</span>
<span class="hljs-number">50</span>%       <span class="hljs-number">0.047101</span>    <span class="hljs-number">-0.013609</span>    <span class="hljs-number">-0.022158</span>    <span class="hljs-number">-0.088274</span>
<span class="hljs-number">75</span>%       <span class="hljs-number">0.756646</span>     <span class="hljs-number">0.695298</span>     <span class="hljs-number">0.699046</span>     <span class="hljs-number">0.623331</span>
max       <span class="hljs-number">2.653656</span>     <span class="hljs-number">3.525865</span>     <span class="hljs-number">2.735527</span>     <span class="hljs-number">3.366626</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="59" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="59" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>假设你想要找出某列中绝对值大小超过3的值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">94</span>]: col = data[<span class="hljs-number">2</span>]

In [<span class="hljs-number">95</span>]: col[np.abs(col) &gt; <span class="hljs-number">3</span>]
Out[<span class="hljs-number">95</span>]: 
<span class="hljs-number">41</span>    <span class="hljs-number">-3.399312</span>
<span class="hljs-number">136</span>   <span class="hljs-number">-3.745356</span>
Name: <span class="hljs-number">2</span>, dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="60" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="60" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>要选出全部含有“超过3或－3的值”的行，你可以在布尔型DataFrame中使用any方法：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">96</span>]: data[(np.abs(data) &gt; <span class="hljs-number">3</span>).any(<span class="hljs-number">1</span>)]
Out[<span class="hljs-number">96</span>]: 
            <span class="hljs-number">0</span>         <span class="hljs-number">1</span>         <span class="hljs-number">2</span>         <span class="hljs-number">3</span>
<span class="hljs-number">41</span>   <span class="hljs-number">0.457246</span> <span class="hljs-number">-0.025907</span> <span class="hljs-number">-3.399312</span> <span class="hljs-number">-0.974657</span>
<span class="hljs-number">60</span>   <span class="hljs-number">1.951312</span>  <span class="hljs-number">3.260383</span>  <span class="hljs-number">0.963301</span>  <span class="hljs-number">1.201206</span>
<span class="hljs-number">136</span>  <span class="hljs-number">0.508391</span> <span class="hljs-number">-0.196713</span> <span class="hljs-number">-3.745356</span> <span class="hljs-number">-1.520113</span>
<span class="hljs-number">235</span> <span class="hljs-number">-0.242459</span> <span class="hljs-number">-3.056990</span>  <span class="hljs-number">1.918403</span> <span class="hljs-number">-0.578828</span>
<span class="hljs-number">258</span>  <span class="hljs-number">0.682841</span>  <span class="hljs-number">0.326045</span>  <span class="hljs-number">0.425384</span> <span class="hljs-number">-3.428254</span>
<span class="hljs-number">322</span>  <span class="hljs-number">1.179227</span> <span class="hljs-number">-3.184377</span>  <span class="hljs-number">1.369891</span> <span class="hljs-number">-1.074833</span>
<span class="hljs-number">544</span> <span class="hljs-number">-3.548824</span>  <span class="hljs-number">1.553205</span> <span class="hljs-number">-2.186301</span>  <span class="hljs-number">1.277104</span>
<span class="hljs-number">635</span> <span class="hljs-number">-0.578093</span>  <span class="hljs-number">0.193299</span>  <span class="hljs-number">1.397822</span>  <span class="hljs-number">3.366626</span>
<span class="hljs-number">782</span> <span class="hljs-number">-0.207434</span>  <span class="hljs-number">3.525865</span>  <span class="hljs-number">0.283070</span>  <span class="hljs-number">0.544635</span>
<span class="hljs-number">803</span> <span class="hljs-number">-3.645860</span>  <span class="hljs-number">0.255475</span> <span class="hljs-number">-0.549574</span> <span class="hljs-number">-1.907459</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="61" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="61" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>根据这些条件，就可以对值进行设置。下面的代码可以将值限制在区间－3到3以内：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">97</span>]: data[np.abs(data) &gt; <span class="hljs-number">3</span>] = np.sign(data) * <span class="hljs-number">3</span>

In [<span class="hljs-number">98</span>]: data.describe()
Out[<span class="hljs-number">98</span>]: 
                 <span class="hljs-number">0</span>            <span class="hljs-number">1</span>            <span class="hljs-number">2</span>            <span class="hljs-number">3</span>
count  <span class="hljs-number">1000.000000</span>  <span class="hljs-number">1000.000000</span>  <span class="hljs-number">1000.000000</span>  <span class="hljs-number">1000.000000</span>
mean      <span class="hljs-number">0.050286</span>     <span class="hljs-number">0.025567</span>    <span class="hljs-number">-0.001399</span>    <span class="hljs-number">-0.051765</span>
std       <span class="hljs-number">0.992920</span>     <span class="hljs-number">1.004214</span>     <span class="hljs-number">0.991414</span>     <span class="hljs-number">0.995761</span>
min      <span class="hljs-number">-3.000000</span>    <span class="hljs-number">-3.000000</span>    <span class="hljs-number">-3.000000</span>    <span class="hljs-number">-3.000000</span>
<span class="hljs-number">25</span>%      <span class="hljs-number">-0.599807</span>    <span class="hljs-number">-0.612162</span>    <span class="hljs-number">-0.687373</span>    <span class="hljs-number">-0.747478</span>
<span class="hljs-number">50</span>%       <span class="hljs-number">0.047101</span>    <span class="hljs-number">-0.013609</span>    <span class="hljs-number">-0.022158</span>    <span class="hljs-number">-0.088274</span>
<span class="hljs-number">75</span>%       <span class="hljs-number">0.756646</span>     <span class="hljs-number">0.695298</span>     <span class="hljs-number">0.699046</span>     <span class="hljs-number">0.623331</span>
max       <span class="hljs-number">2.653656</span>     <span class="hljs-number">3.000000</span>     <span class="hljs-number">2.735527</span>     <span class="hljs-number">3.000000</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="62" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="62" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>根据数据的值是正还是负，np.sign(data)可以生成1和-1：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">99</span>]: np.sign(data).head()
Out[<span class="hljs-number">99</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span>    <span class="hljs-number">3</span>
<span class="hljs-number">0</span> <span class="hljs-number">-1.0</span>  <span class="hljs-number">1.0</span> <span class="hljs-number">-1.0</span>  <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>  <span class="hljs-number">1.0</span> <span class="hljs-number">-1.0</span>  <span class="hljs-number">1.0</span> <span class="hljs-number">-1.0</span>
<span class="hljs-number">2</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">1.0</span> <span class="hljs-number">-1.0</span>
<span class="hljs-number">3</span> <span class="hljs-number">-1.0</span> <span class="hljs-number">-1.0</span>  <span class="hljs-number">1.0</span> <span class="hljs-number">-1.0</span>
<span class="hljs-number">4</span> <span class="hljs-number">-1.0</span>  <span class="hljs-number">1.0</span> <span class="hljs-number">-1.0</span> <span class="hljs-number">-1.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="63" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="63" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.7 排列和随机采样</h3>
<p>利用numpy.random.permutation函数可以轻松实现对Series或DataFrame的列的排列工作（permuting，随机重排序）。通过需要排列的轴的长度调用permutation，可产生一个表示新顺序的整数数组：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">100</span>]: df = pd.DataFrame(np.arange(<span class="hljs-number">5</span> * <span class="hljs-number">4</span>).reshape((<span class="hljs-number">5</span>, <span class="hljs-number">4</span>)))

In [<span class="hljs-number">101</span>]: sampler = np.random.permutation(<span class="hljs-number">5</span>)

In [<span class="hljs-number">102</span>]: sampler
Out[<span class="hljs-number">102</span>]: array([<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="64" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="64" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>然后就可以在基于iloc的索引操作或take函数中使用该数组了：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">103</span>]: df
Out[<span class="hljs-number">103</span>]: 
    <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">3</span>
<span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">3</span>
<span class="hljs-number">1</span>   <span class="hljs-number">4</span>   <span class="hljs-number">5</span>   <span class="hljs-number">6</span>   <span class="hljs-number">7</span>
<span class="hljs-number">2</span>   <span class="hljs-number">8</span>   <span class="hljs-number">9</span>  <span class="hljs-number">10</span>  <span class="hljs-number">11</span>
<span class="hljs-number">3</span>  <span class="hljs-number">12</span>  <span class="hljs-number">13</span>  <span class="hljs-number">14</span>  <span class="hljs-number">15</span>
<span class="hljs-number">4</span>  <span class="hljs-number">16</span>  <span class="hljs-number">17</span>  <span class="hljs-number">18</span>  <span class="hljs-number">19</span>

In [<span class="hljs-number">104</span>]: df.take(sampler)
Out[<span class="hljs-number">104</span>]: 
    <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">3</span>
<span class="hljs-number">3</span>  <span class="hljs-number">12</span>  <span class="hljs-number">13</span>  <span class="hljs-number">14</span>  <span class="hljs-number">15</span>
<span class="hljs-number">1</span>   <span class="hljs-number">4</span>   <span class="hljs-number">5</span>   <span class="hljs-number">6</span>   <span class="hljs-number">7</span>
<span class="hljs-number">4</span>  <span class="hljs-number">16</span>  <span class="hljs-number">17</span>  <span class="hljs-number">18</span>  <span class="hljs-number">19</span>
<span class="hljs-number">2</span>   <span class="hljs-number">8</span>   <span class="hljs-number">9</span>  <span class="hljs-number">10</span>  <span class="hljs-number">11</span>
<span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">3</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="65" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="65" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果不想用替换的方式选取随机子集，可以在Series和DataFrame上使用sample方法：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">105</span>]: df.sample(n=<span class="hljs-number">3</span>)
Out[<span class="hljs-number">105</span>]: 
    <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">3</span>
<span class="hljs-number">3</span>  <span class="hljs-number">12</span>  <span class="hljs-number">13</span>  <span class="hljs-number">14</span>  <span class="hljs-number">15</span>
<span class="hljs-number">4</span>  <span class="hljs-number">16</span>  <span class="hljs-number">17</span>  <span class="hljs-number">18</span>  <span class="hljs-number">19</span>
<span class="hljs-number">2</span>   <span class="hljs-number">8</span>   <span class="hljs-number">9</span>  <span class="hljs-number">10</span>  <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="66" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="66" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>要通过替换的方式产生样本（允许重复选择），可以传递replace=True到sample：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">106</span>]: choices = pd.Series([<span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>])

In [<span class="hljs-number">107</span>]: draws = choices.sample(n=<span class="hljs-number">10</span>, replace=<span class="hljs-literal">True</span>)

In [<span class="hljs-number">108</span>]: draws
Out[<span class="hljs-number">108</span>]: 
<span class="hljs-number">4</span>    <span class="hljs-number">4</span>
<span class="hljs-number">1</span>    <span class="hljs-number">7</span>
<span class="hljs-number">4</span>    <span class="hljs-number">4</span>
<span class="hljs-number">2</span>   <span class="hljs-number">-1</span>
<span class="hljs-number">0</span>    <span class="hljs-number">5</span>
<span class="hljs-number">3</span>    <span class="hljs-number">6</span>
<span class="hljs-number">1</span>    <span class="hljs-number">7</span>
<span class="hljs-number">4</span>    <span class="hljs-number">4</span>
<span class="hljs-number">0</span>    <span class="hljs-number">5</span>
<span class="hljs-number">4</span>    <span class="hljs-number">4</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="67" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="67" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.2.8 计算指标/虚拟变量</h3>
<p>另一种常用于统计建模或机器学习的转换方式是：将分类变量（categorical variable）转换为“虚拟变量”或“指标矩阵”。如果DataFrame的某一列中含有k个不同的值，则可以派生出一个k列矩阵或DataFrame（其值全为1和0）。pandas有一个get_dummies函数可以实现该功能（其实自己动手做一个也不难）。使用之前的一个DataFrame例子：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="68" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="68" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">109</span>]: df = pd.DataFrame({<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>],
   .....:                    <span class="hljs-string">&#x27;data1&#x27;</span>: range(<span class="hljs-number">6</span>)})

In [<span class="hljs-number">110</span>]: pd.get_dummies(df[<span class="hljs-string">&#x27;key&#x27;</span>])
Out[<span class="hljs-number">110</span>]: 
   a  b  c
<span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">0</span>
<span class="hljs-number">1</span>  <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">0</span>
<span class="hljs-number">2</span>  <span class="hljs-number">1</span>  <span class="hljs-number">0</span>  <span class="hljs-number">0</span>
<span class="hljs-number">3</span>  <span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">1</span>
<span class="hljs-number">4</span>  <span class="hljs-number">1</span>  <span class="hljs-number">0</span>  <span class="hljs-number">0</span>
<span class="hljs-number">5</span>  <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="69" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="69" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>有时候，你可能想给指标DataFrame的列加上一个前缀，以便能够跟其他数据进行合并。get_dummies的prefix参数可以实现该功能：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">111</span>]: dummies = pd.get_dummies(df[<span class="hljs-string">&#x27;key&#x27;</span>], prefix=<span class="hljs-string">&#x27;key&#x27;</span>)

In [<span class="hljs-number">112</span>]: df_with_dummy = df[[<span class="hljs-string">&#x27;data1&#x27;</span>]].join(dummies)

In [<span class="hljs-number">113</span>]: df_with_dummy
Out[<span class="hljs-number">113</span>]: 
   data1  key_a  key_b  key_c
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">0</span>
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>      <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">0</span>
<span class="hljs-number">2</span>      <span class="hljs-number">2</span>      <span class="hljs-number">1</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>
<span class="hljs-number">3</span>      <span class="hljs-number">3</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">1</span>
<span class="hljs-number">4</span>      <span class="hljs-number">4</span>      <span class="hljs-number">1</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>
<span class="hljs-number">5</span>      <span class="hljs-number">5</span>      <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="70" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="70" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果DataFrame中的某行同属于多个分类，则事情就会有点复杂。看一下MovieLens 1M数据集，14章会更深入地研究它：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">114</span>]: mnames = [<span class="hljs-string">&#x27;movie_id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;genres&#x27;</span>]
In [<span class="hljs-number">115</span>]: movies = pd.read_table(<span class="hljs-string">&#x27;datasets/movielens/movies.dat&#x27;</span>, sep=<span class="hljs-string">&#x27;::&#x27;</span>,
   .....:                        header=<span class="hljs-literal">None</span>, names=mnames)
In [<span class="hljs-number">116</span>]: movies[:<span class="hljs-number">10</span>]
Out[<span class="hljs-number">116</span>]: 
   movie_id                               title                        genres
<span class="hljs-number">0</span>         <span class="hljs-number">1</span>                    Toy Story (<span class="hljs-number">1995</span>)   Animation|Children<span class="hljs-string">&#x27;s|Comedy
1         2                      Jumanji (1995)  Adventure|Children&#x27;</span>s|Fantasy
<span class="hljs-number">2</span>         <span class="hljs-number">3</span>             Grumpier Old Men (<span class="hljs-number">1995</span>)                Comedy|Romance
<span class="hljs-number">3</span>         <span class="hljs-number">4</span>            Waiting to Exhale (<span class="hljs-number">1995</span>)                  Comedy|Drama
<span class="hljs-number">4</span>         <span class="hljs-number">5</span>  Father of the Bride Part II (<span class="hljs-number">1995</span>)                        Comedy
<span class="hljs-number">5</span>         <span class="hljs-number">6</span>                         Heat (<span class="hljs-number">1995</span>)         Action|Crime|Thriller
<span class="hljs-number">6</span>         <span class="hljs-number">7</span>                      Sabrina (<span class="hljs-number">1995</span>)                Comedy|Romance
<span class="hljs-number">7</span>         <span class="hljs-number">8</span>                 Tom <span class="hljs-keyword">and</span> Huck (<span class="hljs-number">1995</span>)          Adventure|Children<span class="hljs-string">&#x27;s
8         9                 Sudden Death (1995)     Action
9        10                    GoldenEye (1995)     Action|Adventure|Thriller
</span></span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="71" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="71" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>要为每个genre添加指标变量就需要做一些数据规整操作。首先，我们从数据集中抽取出不同的genre值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">117</span>]: all_genres = []

In [<span class="hljs-number">118</span>]: <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> movies.genres:
   .....:     all_genres.extend(x.split(<span class="hljs-string">&#x27;|&#x27;</span>))

In [<span class="hljs-number">119</span>]: genres = pd.unique(all_genres)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="72" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="72" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>现在有：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">120</span>]: genres
Out[<span class="hljs-number">120</span>]: 
array([<span class="hljs-string">&#x27;Animation&#x27;</span>, <span class="hljs-string">&quot;Children&#x27;s&quot;</span>, <span class="hljs-string">&#x27;Comedy&#x27;</span>, <span class="hljs-string">&#x27;Adventure&#x27;</span>, <span class="hljs-string">&#x27;Fantasy&#x27;</span>,
       <span class="hljs-string">&#x27;Romance&#x27;</span>, <span class="hljs-string">&#x27;Drama&#x27;</span>, <span class="hljs-string">&#x27;Action&#x27;</span>, <span class="hljs-string">&#x27;Crime&#x27;</span>, <span class="hljs-string">&#x27;Thriller&#x27;</span>,<span class="hljs-string">&#x27;Horror&#x27;</span>,
       <span class="hljs-string">&#x27;Sci-Fi&#x27;</span>, <span class="hljs-string">&#x27;Documentary&#x27;</span>, <span class="hljs-string">&#x27;War&#x27;</span>, <span class="hljs-string">&#x27;Musical&#x27;</span>, <span class="hljs-string">&#x27;Mystery&#x27;</span>, <span class="hljs-string">&#x27;Film-Noir&#x27;</span>,
       <span class="hljs-string">&#x27;Western&#x27;</span>], dtype=object)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="73" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="73" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>构建指标DataFrame的方法之一是从一个全零DataFrame开始：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">121</span>]: zero_matrix = np.zeros((len(movies), len(genres)))

In [<span class="hljs-number">122</span>]: dummies = pd.DataFrame(zero_matrix, columns=genres)
</span></span></foreignObject></svg></code></pre>
<p>现在，迭代每一部电影，并将dummies各行的条目设为1。要这么做，我们使用dummies.columns来计算每个类型的列索引：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">123</span>]: gen = movies.genres[<span class="hljs-number">0</span>]

In [<span class="hljs-number">124</span>]: gen.split(<span class="hljs-string">&#x27;|&#x27;</span>)
Out[<span class="hljs-number">124</span>]: [<span class="hljs-string">&#x27;Animation&#x27;</span>, <span class="hljs-string">&quot;Children&#x27;s&quot;</span>, <span class="hljs-string">&#x27;Comedy&#x27;</span>]

In [<span class="hljs-number">125</span>]: dummies.columns.get_indexer(gen.split(<span class="hljs-string">&#x27;|&#x27;</span>))
Out[<span class="hljs-number">125</span>]: array([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="74" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="74" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>然后，根据索引，使用.iloc设定值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">126</span>]: <span class="hljs-keyword">for</span> i, gen <span class="hljs-keyword">in</span> enumerate(movies.genres):
   .....:     indices = dummies.columns.get_indexer(gen.split(<span class="hljs-string">&#x27;|&#x27;</span>))
   .....:     dummies.iloc[i, indices] = <span class="hljs-number">1</span>
   .....:
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="75" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="75" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>然后，和以前一样，再将其与movies合并起来：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">127</span>]: movies_windic = movies.join(dummies.add_prefix(<span class="hljs-string">&#x27;Genre_&#x27;</span>))

In [<span class="hljs-number">128</span>]: movies_windic.iloc[<span class="hljs-number">0</span>]
Out[<span class="hljs-number">128</span>]: 
movie_id                                       <span class="hljs-number">1</span>
title                           Toy Story (<span class="hljs-number">1995</span>)
genres               Animation|Children<span class="hljs-string">&#x27;s|Comedy
Genre_Animation                                1
Genre_Children&#x27;</span>s                               <span class="hljs-number">1</span>
Genre_Comedy                                   <span class="hljs-number">1</span>
Genre_Adventure                                <span class="hljs-number">0</span>
Genre_Fantasy                                  <span class="hljs-number">0</span>
Genre_Romance                                  <span class="hljs-number">0</span>
Genre_Drama                                    <span class="hljs-number">0</span>
                                ...             
Genre_Crime                                    <span class="hljs-number">0</span>
Genre_Thriller                                 <span class="hljs-number">0</span>
Genre_Horror                                   <span class="hljs-number">0</span>
Genre_Sci-Fi                                   <span class="hljs-number">0</span>
Genre_Documentary                              <span class="hljs-number">0</span>
Genre_War                                      <span class="hljs-number">0</span>
Genre_Musical                                  <span class="hljs-number">0</span>
Genre_Mystery                                  <span class="hljs-number">0</span>
Genre_Film-Noir                                <span class="hljs-number">0</span>
Genre_Western                                  <span class="hljs-number">0</span>
Name: <span class="hljs-number">0</span>, Length: <span class="hljs-number">21</span>, dtype: object
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="76" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="76" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<blockquote>
<p>笔记：对于很大的数据，用这种方式构建多成员指标变量就会变得非常慢。最好使用更低级的函数，将其写入NumPy数组，然后结果包装在DataFrame中。</p>
</blockquote>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="77" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="77" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>一个对统计应用有用的秘诀是：结合get_dummies和诸如cut之类的离散化函数：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">129</span>]: np.random.seed(<span class="hljs-number">12345</span>)
In [<span class="hljs-number">130</span>]: values = np.random.rand(<span class="hljs-number">10</span>)
In [<span class="hljs-number">131</span>]: values
Out[<span class="hljs-number">131</span>]: 
array([ <span class="hljs-number">0.9296</span>,  <span class="hljs-number">0.3164</span>,  <span class="hljs-number">0.1839</span>,  <span class="hljs-number">0.2046</span>,  <span class="hljs-number">0.5677</span>,  <span class="hljs-number">0.5955</span>,  <span class="hljs-number">0.9645</span>,
        <span class="hljs-number">0.6532</span>,  <span class="hljs-number">0.7489</span>,  <span class="hljs-number">0.6536</span>])
In [<span class="hljs-number">132</span>]: bins = [<span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.4</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">1</span>]
In [<span class="hljs-number">133</span>]: pd.get_dummies(pd.cut(values, bins))
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="78" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="78" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>Out[<span class="hljs-number">133</span>]: 
   (<span class="hljs-number">0.0</span>, <span class="hljs-number">0.2</span>]  (<span class="hljs-number">0.2</span>, <span class="hljs-number">0.4</span>]  (<span class="hljs-number">0.4</span>, <span class="hljs-number">0.6</span>]  (<span class="hljs-number">0.6</span>, <span class="hljs-number">0.8</span>]  (<span class="hljs-number">0.8</span>, <span class="hljs-number">1.0</span>]
<span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>
<span class="hljs-number">1</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>
<span class="hljs-number">2</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>
<span class="hljs-number">3</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>
<span class="hljs-number">4</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>
<span class="hljs-number">5</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>
<span class="hljs-number">6</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>
<span class="hljs-number">7</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>
<span class="hljs-number">8</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>
<span class="hljs-number">9</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">0</span>           <span class="hljs-number">1</span>           <span class="hljs-number">0</span>
</span></span></foreignObject></svg></code></pre>
<p>我们用numpy.random.seed，使这个例子具有确定性。本书后面会介绍pandas.get_dummies。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="79" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="79" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>7.3 字符串操作</h2>
<p>Python能够成为流行的数据处理语言，部分原因是其简单易用的字符串和文本处理功能。大部分文本运算都直接做成了字符串对象的内置方法。对于更为复杂的模式匹配和文本操作，则可能需要用到正则表达式。pandas对此进行了加强，它使你能够对整组数据应用字符串表达式和正则表达式，而且能处理烦人的缺失数据。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="80" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="80" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.3.1 字符串对象方法</h3>
<p>对于许多字符串处理和脚本应用，内置的字符串方法已经能够满足要求了。例如，以逗号分隔的字符串可以用split拆分成数段：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">134</span>]: val = <span class="hljs-string">&#x27;a,b,  guido&#x27;</span>
In [<span class="hljs-number">135</span>]: val.split(<span class="hljs-string">&#x27;,&#x27;</span>)
Out[<span class="hljs-number">135</span>]: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;  guido&#x27;</span>]
</span></span></foreignObject></svg></code></pre>
<p>split常常与strip一起使用，以去除空白符（包括换行符）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">136</span>]: pieces = [x.strip() <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> val.split(<span class="hljs-string">&#x27;,&#x27;</span>)]

In [<span class="hljs-number">137</span>]: pieces
Out[<span class="hljs-number">137</span>]: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;guido&#x27;</span>]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="81" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="81" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>利用加法，可以将这些子字符串以双冒号分隔符的形式连接起来：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">138</span>]: first, second, third = pieces

In [<span class="hljs-number">139</span>]: first + <span class="hljs-string">&#x27;::&#x27;</span> + second + <span class="hljs-string">&#x27;::&#x27;</span> + third
Out[<span class="hljs-number">139</span>]: <span class="hljs-string">&#x27;a::b::guido&#x27;</span>
</span></span></foreignObject></svg></code></pre>
<p>但这种方式并不是很实用。一种更快更符合Python风格的方式是，向字符串&quot;::&quot;的join方法传入一个列表或元组：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">140</span>]: <span class="hljs-string">&#x27;::&#x27;</span>.join(pieces)
Out[<span class="hljs-number">140</span>]: <span class="hljs-string">&#x27;a::b::guido&#x27;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="82" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="82" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>其它方法关注的是子串定位。检测子串的最佳方式是利用Python的in关键字，还可以使用index和find：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">141</span>]: <span class="hljs-string">&#x27;guido&#x27;</span> <span class="hljs-keyword">in</span> val
Out[<span class="hljs-number">141</span>]: <span class="hljs-literal">True</span>

In [<span class="hljs-number">142</span>]: val.index(<span class="hljs-string">&#x27;,&#x27;</span>)
Out[<span class="hljs-number">142</span>]: <span class="hljs-number">1</span>

In [<span class="hljs-number">143</span>]: val.find(<span class="hljs-string">&#x27;:&#x27;</span>)
Out[<span class="hljs-number">143</span>]: <span class="hljs-number">-1</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="83" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="83" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>注意find和index的区别：如果找不到字符串，index将会引发一个异常（而不是返回－1）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">144</span>]: val.index(<span class="hljs-string">&#x27;:&#x27;</span>)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
&lt;ipython-input<span class="hljs-number">-144</span><span class="hljs-number">-280</span>f8b2856ce&gt; <span class="hljs-keyword">in</span> &lt;module&gt;()
----&gt; <span class="hljs-number">1</span> val.index(<span class="hljs-string">&#x27;:&#x27;</span>)
ValueError: substring <span class="hljs-keyword">not</span> found
</span></span></foreignObject></svg></code></pre>
<p>与此相关，count可以返回指定子串的出现次数：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">145</span>]: val.count(<span class="hljs-string">&#x27;,&#x27;</span>)
Out[<span class="hljs-number">145</span>]: <span class="hljs-number">2</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="84" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="84" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>replace用于将指定模式替换为另一个模式。通过传入空字符串，它也常常用于删除模式：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">146</span>]: val.replace(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;::&#x27;</span>)
Out[<span class="hljs-number">146</span>]: <span class="hljs-string">&#x27;a::b::  guido&#x27;</span>

In [<span class="hljs-number">147</span>]: val.replace(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)
Out[<span class="hljs-number">147</span>]: <span class="hljs-string">&#x27;ab  guido&#x27;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="85" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="85" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>表7-3列出了Python内置的字符串方法。这些运算大部分都能使用正则表达式实现（马上就会看到）。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-087fe67bf6db0701.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="w:400" style="width:400px;" /></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-d1f0d4ed3e895016.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="w:400" style="width:400px;" /></p>
<p>casefold      将字符转换为小写，并将任何特定区域的变量字符组合转换成一个通用的可比较形式。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="86" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="86" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.3.2 正则表达式</h3>
<p>正则表达式提供了一种灵活的在文本中搜索或匹配（通常比前者复杂）字符串模式的方式。正则表达式，常称作regex，是根据正则表达式语言编写的字符串。Python内置的re模块负责对字符串应用正则表达式。我将通过一些例子说明其使用方法。</p>
<blockquote>
<p>笔记：正则表达式的编写技巧可以自成一章，超出了本书的范围。从网上和其它书可以找到许多非常不错的教程和参考资料。</p>
</blockquote>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="87" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="87" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>re模块的函数可以分为三个大类：模式匹配、替换以及拆分。当然，它们之间是相辅相成的。一个regex描述了需要在文本中定位的一个模式，它可以用于许多目的。我们先来看一个简单的例子：假设我想要拆分一个字符串，分隔符为数量不定的一组空白符（制表符、空格、换行符等）。描述一个或多个空白符的regex是\s+：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="88" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="88" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">148</span>]: <span class="hljs-keyword">import</span> re

In [<span class="hljs-number">149</span>]: text = <span class="hljs-string">&quot;foo    bar\t baz  \tqux&quot;</span>

In [<span class="hljs-number">150</span>]: re.split(<span class="hljs-string">&#x27;\s+&#x27;</span>, text)
Out[<span class="hljs-number">150</span>]: [<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-string">&#x27;baz&#x27;</span>, <span class="hljs-string">&#x27;qux&#x27;</span>]
</span></span></foreignObject></svg></code></pre>
<p>调用re.split('\s+',text)时，正则表达式会先被编译，然后再在text上调用其split方法。你可以用re.compile自己编译regex以得到一个可重用的regex对象：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">151</span>]: regex = re.compile(<span class="hljs-string">&#x27;\s+&#x27;</span>)

In [<span class="hljs-number">152</span>]: regex.split(text)
Out[<span class="hljs-number">152</span>]: [<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-string">&#x27;baz&#x27;</span>, <span class="hljs-string">&#x27;qux&#x27;</span>]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="89" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="89" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果只希望得到匹配regex的所有模式，则可以使用findall方法：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">153</span>]: regex.findall(text)
Out[<span class="hljs-number">153</span>]: [<span class="hljs-string">&#x27;    &#x27;</span>, <span class="hljs-string">&#x27;\t &#x27;</span>, <span class="hljs-string">&#x27;  \t&#x27;</span>]
</span></span></foreignObject></svg></code></pre>
<blockquote>
<p>笔记：如果想避免正则表达式中不需要的转义（\），则可以使用原始字符串字面量如r'C:\x'（也可以编写其等价式'C:\x'）。</p>
</blockquote>
<p>如果打算对许多字符串应用同一条正则表达式，强烈建议通过re.compile创建regex对象。这样将可以节省大量的CPU时间。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="90" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="90" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>match和search跟findall功能类似。findall返回的是字符串中所有的匹配项，而search则只返回第一个匹配项。match更加严格，它只匹配字符串的首部。来看一个小例子，假设我们有一段文本以及一条能够识别大部分电子邮件地址的正则表达式：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>text = <span class="hljs-string">&quot;&quot;&quot;Dave dave@google.com
Steve steve@gmail.com
Rob rob@gmail.com
Ryan ryan@yahoo.com
&quot;&quot;&quot;</span>
pattern = <span class="hljs-string">r&#x27;[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}&#x27;</span>

<span class="hljs-comment"># re.IGNORECASE makes the regex case-insensitive</span>
regex = re.compile(pattern, flags=re.IGNORECASE)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="91" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="91" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对text使用findall将得到一组电子邮件地址：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">155</span>]: regex.findall(text)
Out[<span class="hljs-number">155</span>]: 
[<span class="hljs-string">&#x27;dave@google.com&#x27;</span>,
 <span class="hljs-string">&#x27;steve@gmail.com&#x27;</span>,
 <span class="hljs-string">&#x27;rob@gmail.com&#x27;</span>,
 <span class="hljs-string">&#x27;ryan@yahoo.com&#x27;</span>]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="92" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="92" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>search返回的是文本中第一个电子邮件地址（以特殊的匹配项对象形式返回）。对于上面那个regex，匹配项对象只能告诉我们模式在原字符串中的起始和结束位置：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">156</span>]: m = regex.search(text)

In [<span class="hljs-number">157</span>]: m
Out[<span class="hljs-number">157</span>]: &lt;_sre.SRE_Match object; span=(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>), match=<span class="hljs-string">&#x27;dave@google.com&#x27;</span>&gt;

In [<span class="hljs-number">158</span>]: text[m.start():m.end()]
Out[<span class="hljs-number">158</span>]: <span class="hljs-string">&#x27;dave@google.com&#x27;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="93" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="93" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>regex.match则将返回None，因为它只匹配出现在字符串开头的模式：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">159</span>]: print(regex.match(text))
<span class="hljs-literal">None</span>
</span></span></foreignObject></svg></code></pre>
<p>相关的，sub方法可以将匹配到的模式替换为指定字符串，并返回所得到的新字符串：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">160</span>]: print(regex.sub(<span class="hljs-string">&#x27;REDACTED&#x27;</span>, text))
Dave REDACTED
Steve REDACTED
Rob REDACTED
Ryan REDACTED
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="94" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="94" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>假设你不仅想要找出电子邮件地址，还想将各个地址分成3个部分：用户名、域名以及域后缀。要实现此功能，只需将待分段的模式的各部分用圆括号包起来即可：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">161</span>]: pattern = <span class="hljs-string">r&#x27;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})&#x27;</span>

In [<span class="hljs-number">162</span>]: regex = re.compile(pattern, flags=re.IGNORECASE)
</span></span></foreignObject></svg></code></pre>
<p>由这种修改过的正则表达式所产生的匹配项对象，可以通过其groups方法返回一个由模式各段组成的元组：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">163</span>]: m = regex.match(<span class="hljs-string">&#x27;wesm@bright.net&#x27;</span>)

In [<span class="hljs-number">164</span>]: m.groups()
Out[<span class="hljs-number">164</span>]: (<span class="hljs-string">&#x27;wesm&#x27;</span>, <span class="hljs-string">&#x27;bright&#x27;</span>, <span class="hljs-string">&#x27;net&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="95" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="95" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于带有分组功能的模式，findall会返回一个元组列表：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">165</span>]: regex.findall(text)
Out[<span class="hljs-number">165</span>]:
[(<span class="hljs-string">&#x27;dave&#x27;</span>, <span class="hljs-string">&#x27;google&#x27;</span>, <span class="hljs-string">&#x27;com&#x27;</span>),
 (<span class="hljs-string">&#x27;steve&#x27;</span>, <span class="hljs-string">&#x27;gmail&#x27;</span>, <span class="hljs-string">&#x27;com&#x27;</span>),
 (<span class="hljs-string">&#x27;rob&#x27;</span>, <span class="hljs-string">&#x27;gmail&#x27;</span>, <span class="hljs-string">&#x27;com&#x27;</span>),
 (<span class="hljs-string">&#x27;ryan&#x27;</span>, <span class="hljs-string">&#x27;yahoo&#x27;</span>, <span class="hljs-string">&#x27;com&#x27;</span>)]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="96" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="96" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>sub还能通过诸如\1、\2之类的特殊符号访问各匹配项中的分组。符号\1对应第一个匹配的组，\2对应第二个匹配的组，以此类推：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">166</span>]: print(regex.sub(<span class="hljs-string">r&#x27;Username: \1, Domain: \2, Suffix: \3&#x27;</span>, text))
Dave Username: dave, Domain: google, Suffix: com
Steve Username: steve, Domain: gmail, Suffix: com
Rob Username: rob, Domain: gmail, Suffix: com
Ryan Username: ryan, Domain: yahoo, Suffix: com
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="97" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="97" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>Python中还有许多的正则表达式，但大部分都超出了本书的范围。表7-4是一个简要概括。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-efbb80a793759fc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="w:800" style="width:800px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="98" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="98" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>7.3.3 pandas的矢量化字符串函数</h3>
<p>清理待分析的散乱数据时，常常需要做一些字符串规整化工作。更为复杂的情况是，含有字符串的列有时还含有缺失数据：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="99" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="99" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">167</span>]: data = {<span class="hljs-string">&#x27;Dave&#x27;</span>: <span class="hljs-string">&#x27;dave@google.com&#x27;</span>, <span class="hljs-string">&#x27;Steve&#x27;</span>: <span class="hljs-string">&#x27;steve@gmail.com&#x27;</span>,
   .....:         <span class="hljs-string">&#x27;Rob&#x27;</span>: <span class="hljs-string">&#x27;rob@gmail.com&#x27;</span>, <span class="hljs-string">&#x27;Wes&#x27;</span>: np.nan}

In [<span class="hljs-number">168</span>]: data = pd.Series(data)

In [<span class="hljs-number">169</span>]: data
Out[<span class="hljs-number">169</span>]: 
Dave     dave@google.com
Rob        rob@gmail.com
Steve    steve@gmail.com
Wes                  NaN
dtype: object

In [<span class="hljs-number">170</span>]: data.isnull()
Out[<span class="hljs-number">170</span>]: 
Dave     <span class="hljs-literal">False</span>
Rob      <span class="hljs-literal">False</span>
Steve    <span class="hljs-literal">False</span>
Wes       <span class="hljs-literal">True</span>
dtype: bool
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="100" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="100" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>通过data.map，所有字符串和正则表达式方法都能被应用于（传入lambda表达式或其他函数）各个值，但是如果存在NA（null）就会报错。为了解决这个问题，Series有一些能够跳过NA值的面向数组方法，进行字符串操作。通过Series的str属性即可访问这些方法。例如，我们可以通过str.contains检查各个电子邮件地址是否含有&quot;gmail&quot;：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">171</span>]: data.str.contains(<span class="hljs-string">&#x27;gmail&#x27;</span>)
Out[<span class="hljs-number">171</span>]: 
Dave     <span class="hljs-literal">False</span>
Rob       <span class="hljs-literal">True</span>
Steve     <span class="hljs-literal">True</span>
Wes        NaN
dtype: object
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="101" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="101" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>也可以使用正则表达式，还可以加上任意re选项（如IGNORECASE）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">172</span>]: pattern
Out[<span class="hljs-number">172</span>]: <span class="hljs-string">&#x27;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\\.([A-Z]{2,4})&#x27;</span>

In [<span class="hljs-number">173</span>]: data.str.findall(pattern, flags=re.IGNORECASE)
Out[<span class="hljs-number">173</span>]: 
Dave     [(dave, google, com)]
Rob        [(rob, gmail, com)]
Steve    [(steve, gmail, com)]
Wes                        NaN
dtype: object
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="102" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="102" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>有两个办法可以实现矢量化的元素获取操作：要么使用str.get，要么在str属性上使用索引：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">174</span>]: matches = data.str.match(pattern, flags=re.IGNORECASE)

In [<span class="hljs-number">175</span>]: matches
Out[<span class="hljs-number">175</span>]: 
Dave     <span class="hljs-literal">True</span>
Rob      <span class="hljs-literal">True</span>
Steve    <span class="hljs-literal">True</span>
Wes       NaN
dtype: object
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="103" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="103" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>要访问嵌入列表中的元素，我们可以传递索引到这两个函数中：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">176</span>]: matches.str.get(<span class="hljs-number">1</span>)
Out[<span class="hljs-number">176</span>]: 
Dave    NaN
Rob     NaN
Steve   NaN
Wes     NaN
dtype: float64

In [<span class="hljs-number">177</span>]: matches.str[<span class="hljs-number">0</span>]
Out[<span class="hljs-number">177</span>]: 
Dave    NaN
Rob     NaN
Steve   NaN
Wes     NaN
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="104" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="104" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>你可以利用这种方法对字符串进行截取：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">178</span>]: data.str[:<span class="hljs-number">5</span>]
Out[<span class="hljs-number">178</span>]: 
Dave     dave@
Rob      rob@g
Steve    steve
Wes        NaN
dtype: object
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="105" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="105" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>表7-5介绍了更多的pandas字符串方法。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-a634364ed6d5d5c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="表7-5 部分矢量化字符串方法 w:600" style="width:600px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="106" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="106" data-marpit-pagination-total="106" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>7.4 总结</h2>
<p>高效的数据准备可以让你将更多的时间用于数据分析，花较少的时间用于准备工作，这样就可以极大地提高生产力。我们在本章中学习了许多工具，但覆盖并不全面。下一章，我们会学习pandas的聚合与分组。</p>
</section>
<script>!function(){"use strict";const t="marpitSVGPolyfill:setZoomFactor,",e=Symbol();let o,r;function n(n){const i="object"==typeof n&&n.target||document,a="object"==typeof n?n.zoom:n;window[e]||(Object.defineProperty(window,e,{configurable:!0,value:!0}),window.addEventListener("message",({data:e,origin:o})=>{if(o===window.origin)try{if(e&&"string"==typeof e&&e.startsWith(t)){const[,t]=e.split(","),o=Number.parseFloat(t);Number.isNaN(o)||(r=o)}}catch(t){console.error(t)}}));let l=!1;Array.from(i.querySelectorAll("svg[data-marpit-svg]"),t=>{var e,n,i,s;t.style.transform||(t.style.transform="translateZ(0)");const c=a||r||t.currentScale||1;o!==c&&(o=c,l=c);const d=t.getBoundingClientRect(),{length:u}=t.children;for(let o=0;o<u;o+=1){const r=t.children[o],a=r.getScreenCTM();if(a){const t=null!==(n=null===(e=r.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==n?n:0,o=null!==(s=null===(i=r.y)||void 0===i?void 0:i.baseVal.value)&&void 0!==s?s:0,l=r.firstChild,{style:u}=l;u.transformOrigin||(u.transformOrigin=`${-t}px ${-o}px`),u.transform=`scale(${c}) matrix(${a.a}, ${a.b}, ${a.c}, ${a.d}, ${a.e-d.left}, ${a.f-d.top}) translateZ(0.0001px)`}}}),!1!==l&&Array.from(i.querySelectorAll("iframe"),({contentWindow:e})=>{null==e||e.postMessage(`${t}${l}`,"null"===window.origin?"*":window.origin)})}o=1,r=void 0;const i=(t,e,o)=>{if(t.getAttribute(e)!==o)return t.setAttribute(e,o),!0};function a(t={}){const e="boolean"==typeof t?(t=>{const e=!t;return console.warn(`[DEPRECATION WARNING] Usage of observer() with boolean option has been deprecated. Please replace with the usage of option object: observer({ once: ${e?"true":"false"} }).`),{once:e}})(t):t,{once:o=!1,target:r=document}=e,a="Apple Computer, Inc."===navigator.vendor?[n]:[];let l=!o;const s=()=>{for(const t of a)t({target:r});!function(t=document){Array.from(t.querySelectorAll('svg[data-marp-fitting="svg"]'),t=>{var e;const o=t.firstChild,r=o.firstChild,{scrollWidth:n,scrollHeight:a}=r;let l,s=1;if(t.hasAttribute("data-marp-fitting-code")&&(l=null===(e=t.parentElement)||void 0===e?void 0:e.parentElement),t.hasAttribute("data-marp-fitting-math")&&(l=t.parentElement),l){const t=getComputedStyle(l),e=Math.ceil(l.clientWidth-parseFloat(t.paddingLeft||"0")-parseFloat(t.paddingRight||"0"));e&&(s=e)}const c=Math.max(n,s),d=Math.max(a,1),u=`0 0 ${c} ${d}`;i(o,"width",""+c),i(o,"height",""+d),i(t,"preserveAspectRatio",getComputedStyle(t).getPropertyValue("--preserve-aspect-ratio")||"xMinYMin meet"),i(t,"viewBox",u)&&t.classList.toggle("__reflow__")})}(r),l&&window.requestAnimationFrame(s)};return s(),()=>{l=!1}}const l=Symbol(),s=document.currentScript;((t=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(t[l])return t[l];const e=a({target:t}),o=()=>{e(),delete t[l]};Object.defineProperty(t,l,{configurable:!0,value:o})})(s?s.getRootNode():document)}();
</script></foreignObject></svg></div><script>!function(){"use strict";var e=function(e,t){var n,r=1===(e.parent||e).nodeType?e.parent||e:document.querySelector(e.parent||e),a=[].filter.call("string"==typeof e.slides?r.querySelectorAll(e.slides):e.slides||r.children,(function(e){return"SCRIPT"!==e.nodeName})),s={},i=function(e,t){return(t=t||{}).index=a.indexOf(e),t.slide=e,t},o=function(e,t){s[e]=(s[e]||[]).filter((function(e){return e!==t}))},l=function(e,t){return(s[e]||[]).reduce((function(e,n){return e&&!1!==n(t)}),!0)},c=function(e,t){a[e]&&(n&&l("deactivate",i(n,t)),n=a[e],l("activate",i(n,t)))},d=function(e,t){var r=a.indexOf(n)+e;l(e>0?"next":"prev",i(n,t))&&c(r,t)},u={off:o,on:function(e,t){return(s[e]||(s[e]=[])).push(t),o.bind(null,e,t)},fire:l,slide:function(e,t){if(!arguments.length)return a.indexOf(n);l("slide",i(a[e],t))&&c(e,t)},next:d.bind(null,1),prev:d.bind(null,-1),parent:r,slides:a,destroy:function(e){l("destroy",i(n,e)),s={}}};return(t||[]).forEach((function(e){e(u)})),n||c(0),u};function t(e){e.parent.classList.add("bespoke-marp-parent"),e.slides.forEach(e=>e.classList.add("bespoke-marp-slide")),e.on("activate",t=>{const n=t.slide,r=!n.classList.contains("bespoke-marp-active");e.slides.forEach(e=>{e.classList.remove("bespoke-marp-active"),e.setAttribute("aria-hidden","true")}),n.classList.add("bespoke-marp-active"),n.removeAttribute("aria-hidden"),r&&(n.classList.add("bespoke-marp-active-ready"),document.body.clientHeight,n.classList.remove("bespoke-marp-active-ready"))})}function n(e){let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map(e=>[null,...e.querySelectorAll("[data-marpit-fragment]")])});const r=r=>void 0!==e.fragments[t][n+r],a=(r,a)=>{t=r,n=a,e.fragments.forEach((e,t)=>{e.forEach((e,n)=>{if(null==e)return;const s=t<r||t===r&&n<=a;e.setAttribute("data-bespoke-marp-fragment",s?"active":"inactive"),t===r&&n===a?e.setAttribute("data-bespoke-marp-current-fragment","current"):e.removeAttribute("data-bespoke-marp-current-fragment")})}),e.fragmentIndex=a;const s={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:a};e.fire("fragment",s)};e.on("next",({fragment:s=!0})=>{if(s){if(r(1))return a(t,n+1),!1;const s=t+1;e.fragments[s]&&a(s,0)}else{const r=e.fragments[t].length;if(n+1<r)return a(t,r-1),!1;const s=e.fragments[t+1];s&&a(t+1,s.length-1)}}),e.on("prev",({fragment:s=!0})=>{if(r(-1)&&s)return a(t,n-1),!1;const i=t-1;e.fragments[i]&&a(i,e.fragments[i].length-1)}),e.on("slide",({index:t,fragment:n})=>{let r=0;if(void 0!==n){const a=e.fragments[t];if(a){const{length:e}=a;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}a(t,r)}),a(0,0)}var r,a,s=(function(e){
/*!
* screenfull
* v5.0.2 - 2020-02-13
* (c) Sindre Sorhus; MIT License
*/
!function(){var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=e.exports,r=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,a=n.length,s={};r<a;r++)if((e=n[r])&&e[1]in t){for(r=0;r<e.length;r++)s[n[0][r]]=e[r];return s}return!1}(),a={change:r.fullscreenchange,error:r.fullscreenerror},s={request:function(e){return new Promise(function(n,a){var s=function(){this.off("change",s),n()}.bind(this);this.on("change",s);var i=(e=e||t.documentElement)[r.requestFullscreen]();i instanceof Promise&&i.then(s).catch(a)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var a=function(){this.off("change",a),e()}.bind(this);this.on("change",a);var s=t[r.exitFullscreen]();s instanceof Promise&&s.then(a).catch(n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=a[e];r&&t.addEventListener(r,n,!1)},off:function(e,n){var r=a[e];r&&t.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(s,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),n?e.exports=s:window.screenfull=s):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()}(a={path:r,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&a.path)}},a.exports),a.exports);function i(e){e.fullscreen=()=>{s.isEnabled&&s.toggle(document.body)},document.addEventListener("keydown",t=>{70!==t.which&&122!==t.which||t.altKey||t.ctrlKey||t.metaKey||!s.isEnabled||(e.fullscreen(),t.preventDefault())})}function o(e=2e3){return t=>{let n;function r(){n&&clearTimeout(n),n=setTimeout(()=>{t.parent.classList.add("bespoke-marp-inactive"),t.fire("marp-inactive")},e),t.parent.classList.contains("bespoke-marp-inactive")&&(t.parent.classList.remove("bespoke-marp-inactive"),t.fire("marp-active"))}document.addEventListener("mousedown",r),document.addEventListener("mousemove",r),document.addEventListener("touchend",r),setTimeout(r,0)}}const l=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"];function c(e){e.parent.addEventListener("keydown",e=>{if(!e.target)return;const t=e.target;(l.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()})}function d(e){window.addEventListener("load",()=>{for(const t of e.slides){const e=t.querySelector("[data-marp-fitting]")?"":"hideable";t.setAttribute("data-bespoke-marp-load",e)}})}var u;function f({interval:e=200}={}){return t=>{document.addEventListener("keydown",e=>{if(32===e.which&&e.shiftKey)t.prev();else if(33===e.which||37===e.which||38===e.which)t.prev({fragment:!e.shiftKey});else if(32!==e.which||e.shiftKey)if(34===e.which||39===e.which||40===e.which)t.next({fragment:!e.shiftKey});else if(35===e.which)t.slide(t.slides.length-1,{fragment:-1});else{if(36!==e.which)return;t.slide(0)}else t.next();e.preventDefault()});let n,r,a=0;t.parent.addEventListener("wheel",s=>{let i=!1;const o=(e,t)=>{e&&(i=i||function(e,t){return function(e,t){const n=t===u.X?"Width":"Height";return e["client"+n]<e["scroll"+n]}(e,t)&&function(e,t){const{overflow:n}=e,r=e["overflow"+t];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r}(getComputedStyle(e),t)}(e,t)),(null==e?void 0:e.parentElement)&&o(e.parentElement,t)};if(0!==s.deltaX&&o(s.target,u.X),0!==s.deltaY&&o(s.target,u.Y),i)return;s.preventDefault(),r&&clearTimeout(r),r=setTimeout(()=>{n=0},e);const l=Date.now()-a<e,c=Math.sqrt(Math.pow(s.deltaX,2)+Math.pow(s.deltaY,2)),d=c<=n;if(n=c,l||d)return;let f;(s.deltaX>0||s.deltaY>0)&&(f="next"),(s.deltaX<0||s.deltaY<0)&&(f="prev"),f&&(t[f](),a=Date.now())})}}!function(e){e.X="X",e.Y="Y"}(u||(u={}));const m=(...e)=>history.replaceState(...e),p="data-bespoke-view";var h;!function(e){e.Normal="",e.Presenter="presenter",e.Next="next"}(h||(h={}));const g=(e,{protocol:t,host:n,pathname:r,hash:a}=location)=>{const s=e.toString();return`${t}//${n}${r}${s?"?":""}${s}${a}`},v=()=>{switch(document.body.getAttribute(p)){case h.Normal:return h.Normal;case h.Presenter:return h.Presenter;case h.Next:return h.Next;default:throw new Error("View mode is not assigned.")}},b=e=>new URLSearchParams(location.search).get(e),w=(e,t={})=>{const n=Object.assign({location:location,setter:m},t),r=new URLSearchParams(n.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?r.set(t,n):r.delete(t)}try{n.setter(null,document.title,g(r,n.location))}catch(e){console.error(e)}},y={available:(()=>{try{return localStorage.setItem("bespoke-marp","bespoke-marp"),localStorage.removeItem("bespoke-marp"),!0}catch(e){return console.warn("Warning: Using localStorage is restricted in the current host so some features may not work."),!1}})(),get:e=>{try{return localStorage.getItem(e)}catch(e){return null}},set:(e,t)=>{try{return localStorage.setItem(e,t),!0}catch(e){return!1}},remove:e=>{try{return localStorage.removeItem(e),!0}catch(e){return!1}}};function x(e=".bespoke-marp-osc"){const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[data-bespoke-marp-osc=${JSON.stringify(e)}]`).forEach(n)};return s.isEnabled||n("fullscreen",e=>e.style.display="none"),y.available||n("presenter",e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."}),e=>{t.addEventListener("click",t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;switch(n&&t.target.blur(),n){case"next":e.next({fragment:!t.shiftKey});break;case"prev":e.prev({fragment:!t.shiftKey});break;case"fullscreen":"function"==typeof e.fullscreen&&s.isEnabled&&e.fullscreen();break;case"presenter":e.openPresenterView()}}}),e.parent.appendChild(t),e.on("activate",({index:t})=>{n("page",n=>n.textContent=`Page ${t+1} of ${e.slides.length}`)}),e.on("fragment",({index:t,fragments:r,fragmentIndex:a})=>{n("prev",e=>e.disabled=0===t&&0===a),n("next",n=>n.disabled=t===e.slides.length-1&&a===r.length-1)}),e.on("marp-active",()=>t.removeAttribute("aria-hidden")),e.on("marp-inactive",()=>t.setAttribute("aria-hidden","true")),s.isEnabled&&s.onchange(()=>n("fullscreen",e=>e.classList.toggle("exit",s.isEnabled&&s.isFullscreen)))}}function E(){const e=Math.max(Math.floor(.85*window.innerWidth),640),t=Math.max(Math.floor(.85*window.innerHeight),360);return window.open(this.presenterUrl,"bespoke-marp-presenter-"+this.syncKey,`width=${e},height=${t},menubar=no,toolbar=no`)}function k(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),g(e)}var L=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];let S=e=>String(e).replace(/[&<>"']/g,e=>`&${I[e]};`),I={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},P="dangerouslySetInnerHTML",M={className:"class",htmlFor:"for"},N={};function F(e,t){let n=[],r="";t=t||{};for(let e=arguments.length;e-- >2;)n.push(arguments[e]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(let e in t)!1!==t[e]&&null!=t[e]&&e!==P&&(r+=` ${M[e]?M[e]:S(e)}="${S(t[e])}"`);r+=">"}if(-1===L.indexOf(e)){if(t[P])r+=t[P].__html;else for(;n.length;){let e=n.pop();if(e)if(e.pop)for(let t=e.length;t--;)n.push(e[t]);else r+=!0===N[e]?e:S(e)}r+=e?`</${e}>`:""}return N[r]=!0,r}const O=({children:e})=>F(null,null,...e),q="bespoke-marp-presenter-container",C="bespoke-marp-presenter-next",T="bespoke-marp-presenter-next-container",A="bespoke-marp-presenter-note-container",K="bespoke-marp-presenter-info-container",$="bespoke-marp-presenter-info-page",j="bespoke-marp-presenter-info-page-text",D="bespoke-marp-presenter-info-page-prev",R="bespoke-marp-presenter-info-page-next",U="bespoke-marp-presenter-info-time",V="bespoke-marp-presenter-info-timer";function X(e){const{title:t}=document;document.title="[Presenter view]"+(t?" - "+t:"");const n={},r=e=>(n[e]=n[e]||document.querySelector("."+e),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=q,t.appendChild(e),t.insertAdjacentHTML("beforeend",F(O,null,F("div",{class:T},F("iframe",{class:C,src:"?view=next"})),F("div",{class:A}),F("div",{class:K},F("div",{class:$},F("button",{class:D,tabindex:"-1",title:"Previous"},"Previous"),F("span",{class:j}),F("button",{class:R,tabindex:"-1",title:"Next"},"Next")),F("time",{class:U,title:"Current time"}),F("div",{class:V})))),t})(e.parent)),(e=>{r(T).addEventListener("click",()=>e.next());const t=r(C),n=(a=t,(e,t)=>{var n;return null===(n=a.contentWindow)||void 0===n?void 0:n.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin)});var a;t.addEventListener("load",()=>{r(T).classList.add("active"),n(e.slide(),e.fragmentIndex),e.on("fragment",({index:e,fragmentIndex:t})=>n(e,t))});const s=document.querySelectorAll(".bespoke-marp-note");s.forEach(e=>{e.addEventListener("keydown",e=>e.stopPropagation()),r(A).appendChild(e)}),e.on("activate",()=>s.forEach(t=>t.classList.toggle("active",t.dataset.index==e.slide()))),e.on("activate",({index:t})=>{r(j).textContent=`${t+1} / ${e.slides.length}`});const i=r(D),o=r(R);i.addEventListener("click",t=>{i.blur(),e.prev({fragment:!t.shiftKey})}),o.addEventListener("click",t=>{o.blur(),e.next({fragment:!t.shiftKey})}),e.on("fragment",({index:t,fragments:n,fragmentIndex:r})=>{i.disabled=0===t&&0===r,o.disabled=t===e.slides.length-1&&r===n.length-1});const l=()=>r(U).textContent=(new Date).toLocaleTimeString();l(),setInterval(l,250)})(e)}function Y(e){const t=v();return t===h.Next&&e.appendChild(document.createElement("span")),e=>{t===h.Normal&&function(e){if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:E},presenterUrl:{enumerable:!0,get:k}}),y.available&&document.addEventListener("keydown",t=>{80!==t.which||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())})}(e),t===h.Presenter&&X(e),t===h.Next&&function(e){const t=t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let a=Number.parseInt(t,10),s=Number.parseInt(n,10)+1;s>=e.fragments[a].length&&(a+=1,s=0),e.slide(a,{fragment:s})}};window.addEventListener("message",t),e.on("destroy",()=>window.removeEventListener("message",t))}(e)}}function B(e){e.on("activate",t=>{document.querySelectorAll(".bespoke-progress-bar").forEach(n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"})})}const z=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t};function H(e={}){const t=Object.assign({history:!0},e);return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},a=(t={fragment:!0})=>{((t,n)=>{const{fragments:r,slides:a}=e,s=Math.max(0,Math.min(t,a.length-1)),i=Math.max(0,Math.min(n||0,r[s].length-1));s===e.slide()&&i===e.fragmentIndex||e.slide(s,{fragment:i})})((z(location.hash.slice(1))||1)-1,t.fragment?z(b("f")||""):null)};e.on("fragment",({index:e,fragmentIndex:r})=>{n||w({f:0===r||r.toString()},{location:Object.assign(Object.assign({},location),{hash:"#"+(e+1)}),setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})}),setTimeout(()=>{a(),window.addEventListener("hashchange",()=>r(()=>{a({fragment:!1}),w({f:void 0})})),window.addEventListener("popstate",()=>{n||r(()=>a())}),n=!1},0)}}function W(e={}){const t=e.key||((e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t})(),n="bespoke-marp-sync-"+t,r=()=>{const e=y.get(n);return e?JSON.parse(e):Object.create(null)},a=e=>{const t=r(),a=Object.assign(Object.assign({},t),e(t));return y.set(n,JSON.stringify(a)),a};return a(e=>({reference:(e.reference||0)+1})),e=>{Object.defineProperty(e,"syncKey",{value:t,enumerable:!0});let s=!0;setTimeout(()=>{e.on("fragment",e=>{s&&a(()=>({index:e.index,fragmentIndex:e.fragmentIndex}))})},0),window.addEventListener("storage",t=>{if(t.key===n&&t.oldValue&&t.newValue){const n=JSON.parse(t.oldValue),r=JSON.parse(t.newValue);if(n.index!==r.index||n.fragmentIndex!==r.fragmentIndex)try{s=!1,e.slide(r.index,{fragment:r.fragmentIndex})}finally{s=!0}}}),e.on("destroy",()=>{const{reference:e}=r();void 0===e||e<=1?y.remove(n):a(()=>({reference:e-1}))})}}function J({slope:e=Math.tan(-35*Math.PI/180),swipeThreshold:t=30}={}){return n=>{let r;const a=n.parent,s=e=>{const t=a.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};a.addEventListener("touchstart",e=>{r=1===e.touches.length?s(e.touches[0]):void 0},{passive:!0}),a.addEventListener("touchmove",e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=s(e.touches[0]),n=t.x-r.x,a=t.y-r.y;r.delta=Math.sqrt(Math.pow(Math.abs(n),2)+Math.pow(Math.abs(a),2)),r.radian=Math.atan2(n,a)}else r=void 0}),a.addEventListener("touchend",a=>{if(r){if(r.delta&&r.delta>=t&&r.radian){let t=r.radian-e;t=(t+Math.PI)%(2*Math.PI)-Math.PI,n[t<0?"next":"prev"](),a.stopPropagation()}r=void 0}},{passive:!0})}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function _(e,t,n,r){return new(n||(n=Promise))((function(a,s){function i(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}l((r=r.apply(e,t||[])).next())}))}let G=void 0;const Q=()=>(void 0===G&&(G="wakeLock"in navigator&&navigator.wakeLock),G),Z=()=>_(void 0,void 0,void 0,(function*(){const e=Q();if(e)try{const t=yield e.request("screen");return t.addEventListener("release",()=>{console.debug("[Marp CLI] Wake Lock was released")}),console.debug("[Marp CLI] Wake Lock is active"),t}catch(e){console.warn(e)}return null}));function ee(){return _(this,void 0,void 0,(function*(){if(!Q())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&Z()};return document.addEventListener("visibilitychange",t),document.addEventListener("fullscreenchange",t),e=yield Z(),e}))}const te=[h.Normal,h.Presenter,h.Next];!function(r=document.getElementById("p")){document.body.setAttribute(p,(()=>{switch(b("view")){case"next":return h.Next;case"presenter":return h.Presenter;default:return h.Normal}})());const a=(e=>{const t=b(e);return w({[e]:void 0}),t})("sync")||void 0,s=!1,l=!0,u=e(r,((...e)=>{const t=te.findIndex(e=>v()===e);if(t<0)throw new Error("Invalid view");return e.map(([e,n])=>e[t]&&n).filter(e=>e)})([[l,l,s],W({key:a})],[[l,l,l],Y(r)],[[l,l,s],c],[[l,l,l],t],[[l,s,s],o()],[[l,l,l],d],[[l,l,l],H({history:!1})],[[l,l,s],f()],[[l,l,s],i],[[l,s,s],B],[[l,l,s],J()],[[l,s,s],x()],[[l,l,l],n],[[l,l,s],ee]));window.addEventListener("beforeunload",()=>w({sync:u.syncKey})),window.addEventListener("unload",()=>u.destroy())}()}();</script><script>window.__marpCliWatchWS="ws://localhost:37717/363f219581a8b40bcbe142941262d6e611f5ddfe6f5185ab9ffdd4eefec90bba";!function(){"use strict";const e=(n,o=!1)=>{const t=new WebSocket(n);return t.addEventListener("open",()=>{console.info("[Marp CLI] Observing the change of file..."),o&&location.reload()}),t.addEventListener("close",()=>{console.warn("[Marp CLI] WebSocket for file watcher was disconnected. Try re-connecting in 5000ms..."),setTimeout(()=>e(n,!0),5e3)}),t.addEventListener("message",e=>{"reload"===e.data&&location.reload()}),t};!function(){const n=window.__marpCliWatchWS;if(n)e(n)}()}();</script></body></html>