<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTBMMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMzIgOTBsNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTQwIDcwSDIwVjUwbTIwIDBMMjAgNzBtNDAtNDBoMjB2MjBtLTIwIDBsMjAtMjAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwIDUwaDIwdjIwbS0yMCAwbDIwLTIwbTQwIDBINjBWMzBtMjAgMEw2MCA1MCIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS13aWR0aDo1cHh9PC9zdHlsZT48L2RlZnM+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yMCA2MGgtNWE1IDUgMCAwMS01LTVWMjBhNSA1IDAgMDE1LTVoNjBhNSA1IDAgMDE1IDV2NU0zMCA4NWg2MCIvPjxyZWN0IHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIi8+PHJlY3QgY2xhc3M9ImEiIHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNNDAgNTBoNDBNNDAgNjBoMzAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;z-index:-1;pointer-events:none;opacity:0}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;z-index:0;pointer-events:auto;opacity:1}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{-webkit-animation-name:__bespoke_marp__!important;animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{bottom:0;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{background:rgba(0,0,0,.65);border-radius:7px;bottom:50px;color:#fff;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;z-index:1;will-change:transform}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{flex:0 0 0;background:#0288d1;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:transparent}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{font-family:Helvetica,Arial,sans-serif;height:100%;left:0;position:absolute;top:0;width:100%;display:grid;grid-template-columns:2fr 1fr;grid-template-rows:minmax(140px,1fr) 2fr 3em;grid-template-areas:"current next" "current note" "info    note"}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;position:relative;overflow:hidden}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;top:20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:transparent;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;top:20px;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{margin:20px;width:calc(100% - 40px);height:calc(100% - 40px);box-sizing:border-box;font-size:1.1em;overflow:auto;padding-right:3px;white-space:pre-wrap;word-wrap:break-word;scrollbar-width:thin;scrollbar-color:hsla(0,0%,93.3%,.5) transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:hsla(0,0%,93.3%,.5);border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{display:block;box-sizing:border-box;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>@charset "UTF-8";@import url("https://fonts.googleapis.com/css?family=Lato:400,900|Roboto+Mono:400,700&display=swap");div#p>svg>foreignObject>section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center}div#p>svg>foreignObject>section:after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#p>svg>foreignObject>section:not([data-marpit-pagination]):after{display:none}/* Normalization */div#p>svg>foreignObject>section h1{font-size:2em;margin:0.67em 0}div#p>svg>foreignObject>section video::-webkit-media-controls{will-change:transform}@page{size:1280px 720px;margin:0}@media print{body,html{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#p>svg>foreignObject>section{page-break-before:always;break-before:page}div#p>svg>foreignObject>section,div#p>svg>foreignObject>section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;transition:none!important}div#p>svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{display:block;height:auto;width:100%}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{position:static}}div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{content:""}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{position:relative}}div#p>svg>foreignObject>section [data-marp-fitting-svg-content]{display:table;white-space:nowrap}div#p>svg>foreignObject>section [data-marp-fitting-svg-content-wrap]{white-space:pre}div#p>svg>foreignObject>section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}
/*!
 * Marp / Marpit Gaia theme.
 *
 * @theme gaia
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 4:3 960px 720px
 */div#p>svg>foreignObject>section .hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-comment,div#p>svg>foreignObject>section .hljs-quote{color:#aeaeae;font-style:italic}div#p>svg>foreignObject>section .hljs-keyword,div#p>svg>foreignObject>section .hljs-selector-tag,div#p>svg>foreignObject>section .hljs-type{color:#e28964}div#p>svg>foreignObject>section .hljs-string{color:#65b042}div#p>svg>foreignObject>section .hljs-subst{color:#daefa3}div#p>svg>foreignObject>section .hljs-link,div#p>svg>foreignObject>section .hljs-regexp{color:#e9c062}div#p>svg>foreignObject>section .hljs-name,div#p>svg>foreignObject>section .hljs-section,div#p>svg>foreignObject>section .hljs-tag,div#p>svg>foreignObject>section .hljs-title{color:#89bdff}div#p>svg>foreignObject>section .hljs-class .hljs-title,div#p>svg>foreignObject>section .hljs-doctag{text-decoration:underline}div#p>svg>foreignObject>section .hljs-bullet,div#p>svg>foreignObject>section .hljs-number,div#p>svg>foreignObject>section .hljs-symbol{color:#3387cc}div#p>svg>foreignObject>section .hljs-params,div#p>svg>foreignObject>section .hljs-template-variable,div#p>svg>foreignObject>section .hljs-variable{color:#3e87e3}div#p>svg>foreignObject>section .hljs-attribute{color:#cda869}div#p>svg>foreignObject>section .hljs-meta{color:#8996a8}div#p>svg>foreignObject>section .hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}div#p>svg>foreignObject>section .hljs-addition{background-color:#253b22;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-deletion{background-color:#420e09;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-selector-class{color:#9b703f}div#p>svg>foreignObject>section .hljs-selector-id{color:#8b98ab}div#p>svg>foreignObject>section .hljs-emphasis{font-style:italic}div#p>svg>foreignObject>section .hljs-strong{font-weight:700}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{max-height:580px}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2,div#p>svg>foreignObject>section h3,div#p>svg>foreignObject>section h4,div#p>svg>foreignObject>section h5,div#p>svg>foreignObject>section h6{margin:.5em 0 0}div#p>svg>foreignObject>section h1 strong,div#p>svg>foreignObject>section h2 strong,div#p>svg>foreignObject>section h3 strong,div#p>svg>foreignObject>section h4 strong,div#p>svg>foreignObject>section h5 strong,div#p>svg>foreignObject>section h6 strong{font-weight:inherit}div#p>svg>foreignObject>section h1{font-size:1.8em}div#p>svg>foreignObject>section h2{font-size:1.5em}div#p>svg>foreignObject>section h3{font-size:1.3em}div#p>svg>foreignObject>section h4{font-size:1.1em}div#p>svg>foreignObject>section h5{font-size:1em}div#p>svg>foreignObject>section h6{font-size:.9em}div#p>svg>foreignObject>section blockquote,div#p>svg>foreignObject>section p{margin:1em 0 0}div#p>svg>foreignObject>section ol>li,div#p>svg>foreignObject>section ul>li{margin:.3em 0 0}div#p>svg>foreignObject>section ol>li>p,div#p>svg>foreignObject>section ul>li>p{margin:.6em 0 0}div#p>svg>foreignObject>section code{display:inline-block;font-family:Roboto Mono,monospace;font-size:.8em;letter-spacing:0;margin:-.1em .15em;padding:.1em .2em;vertical-align:baseline}div#p>svg>foreignObject>section pre{display:block;margin:1em 0 0;min-height:1em;overflow:visible}div#p>svg>foreignObject>section pre code{box-sizing:border-box;margin:0;min-width:100%;padding:.5em;font-size:.7em}div#p>svg>foreignObject>section pre code svg[data-marp-fitting=svg]{max-height:calc(580px - 1em)}div#p>svg>foreignObject>section blockquote{margin:1em 0 0;padding:0 1em;position:relative}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before{content:"“";display:block;font-family:Times New Roman,serif;font-weight:700;position:absolute}div#p>svg>foreignObject>section blockquote:before{top:0;left:0}div#p>svg>foreignObject>section blockquote:after{right:0;bottom:0;transform:rotate(180deg)}div#p>svg>foreignObject>section blockquote>:first-child{margin-top:0}div#p>svg>foreignObject>section mark{background:transparent}div#p>svg>foreignObject>section table{border-spacing:0;border-collapse:collapse;margin:1em 0 0}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{padding:.2em .4em;border-width:1px;border-style:solid}div#p>svg>foreignObject>section{background-image:linear-gradient(135deg,hsla(0,0%,53.3%,0),hsla(0,0%,53.3%,.02) 50%,hsla(0,0%,100%,0) 0,hsla(0,0%,100%,.05));font-size:35px;font-family:Lato,Avenir Next,Avenir,Trebuchet MS,Segoe UI,sans-serif;height:720px;line-height:1.35;letter-spacing:1.25px;padding:70px;width:1280px;word-wrap:break-word;color:#455a64;background-color:#fff8e1}div#p>svg>foreignObject>section{--marpit-root-font-size:35px}div#p>svg>foreignObject>section>:first-child,div#p>svg>foreignObject>section>header:first-child+*{margin-top:0}div#p>svg>foreignObject>section a,div#p>svg>foreignObject>section mark{color:#0288d1}div#p>svg>foreignObject>section code{background:#6a7a7d;color:#fff8e1}div#p>svg>foreignObject>section h1 strong,div#p>svg>foreignObject>section h2 strong,div#p>svg>foreignObject>section h3 strong,div#p>svg>foreignObject>section h4 strong,div#p>svg>foreignObject>section h5 strong,div#p>svg>foreignObject>section h6 strong{color:#0288d1}div#p>svg>foreignObject>section pre>code{background:#455a64}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before,div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header,div#p>svg>foreignObject>section section:after{color:#6a7a7d}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{border-color:#455a64}div#p>svg>foreignObject>section table thead th{background:#455a64;color:#fff8e1}div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) th{background:rgba(69,90,100,.1)}div#p>svg>foreignObject>section.invert{color:#fff8e1;background-color:#455a64}div#p>svg>foreignObject>section.invert a,div#p>svg>foreignObject>section.invert mark{color:#81d4fa}div#p>svg>foreignObject>section.invert code{background:#dad8c8;color:#455a64}div#p>svg>foreignObject>section.invert h1 strong,div#p>svg>foreignObject>section.invert h2 strong,div#p>svg>foreignObject>section.invert h3 strong,div#p>svg>foreignObject>section.invert h4 strong,div#p>svg>foreignObject>section.invert h5 strong,div#p>svg>foreignObject>section.invert h6 strong{color:#81d4fa}div#p>svg>foreignObject>section.invert pre>code{background:#fff8e1}div#p>svg>foreignObject>section.invert blockquote:after,div#p>svg>foreignObject>section.invert blockquote:before,div#p>svg>foreignObject>section.invert footer,div#p>svg>foreignObject>section.invert header,div#p>svg>foreignObject>section.invert section:after{color:#dad8c8}div#p>svg>foreignObject>section.invert table td,div#p>svg>foreignObject>section.invert table th{border-color:#fff8e1}div#p>svg>foreignObject>section.invert table thead th{background:#fff8e1;color:#455a64}div#p>svg>foreignObject>section.invert table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section.invert table tbody>tr:nth-child(odd) th{background:rgba(255,248,225,.1)}div#p>svg>foreignObject>section.gaia{color:#fff8e1;background-color:#0288d1}div#p>svg>foreignObject>section.gaia a,div#p>svg>foreignObject>section.gaia mark{color:#81d4fa}div#p>svg>foreignObject>section.gaia code{background:#cce2de;color:#0288d1}div#p>svg>foreignObject>section.gaia h1 strong,div#p>svg>foreignObject>section.gaia h2 strong,div#p>svg>foreignObject>section.gaia h3 strong,div#p>svg>foreignObject>section.gaia h4 strong,div#p>svg>foreignObject>section.gaia h5 strong,div#p>svg>foreignObject>section.gaia h6 strong{color:#81d4fa}div#p>svg>foreignObject>section.gaia pre>code{background:#fff8e1}div#p>svg>foreignObject>section.gaia blockquote:after,div#p>svg>foreignObject>section.gaia blockquote:before,div#p>svg>foreignObject>section.gaia footer,div#p>svg>foreignObject>section.gaia header,div#p>svg>foreignObject>section.gaia section:after{color:#cce2de}div#p>svg>foreignObject>section.gaia table td,div#p>svg>foreignObject>section.gaia table th{border-color:#fff8e1}div#p>svg>foreignObject>section.gaia table thead th{background:#fff8e1;color:#0288d1}div#p>svg>foreignObject>section.gaia table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section.gaia table tbody>tr:nth-child(odd) th{background:rgba(255,248,225,.1)}div#p>svg>foreignObject>section.lead{display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:center}div#p>svg>foreignObject>section.lead h1,div#p>svg>foreignObject>section.lead h2,div#p>svg>foreignObject>section.lead h3,div#p>svg>foreignObject>section.lead h4,div#p>svg>foreignObject>section.lead h5,div#p>svg>foreignObject>section.lead h6{text-align:center}div#p>svg>foreignObject>section.lead h1 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h2 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h3 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h4 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h5 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h6 svg[data-marp-fitting=svg]{--preserve-aspect-ratio:xMidYMid meet}div#p>svg>foreignObject>section.lead p{text-align:center}div#p>svg>foreignObject>section.lead blockquote>h1,div#p>svg>foreignObject>section.lead blockquote>h2,div#p>svg>foreignObject>section.lead blockquote>h3,div#p>svg>foreignObject>section.lead blockquote>h4,div#p>svg>foreignObject>section.lead blockquote>h5,div#p>svg>foreignObject>section.lead blockquote>h6,div#p>svg>foreignObject>section.lead blockquote>p{text-align:left}div#p>svg>foreignObject>section.lead blockquote svg[data-marp-fitting=svg]:not([data-marp-fitting-math]){--preserve-aspect-ratio:xMinYMin meet}div#p>svg>foreignObject>section.lead ol>li>p,div#p>svg>foreignObject>section.lead ul>li>p{text-align:left}div#p>svg>foreignObject>section.lead table{margin-left:auto;margin-right:auto}div#p>svg>foreignObject>section:after,div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{box-sizing:border-box;font-size:66%;height:70px;line-height:50px;overflow:hidden;padding:10px 25px;position:absolute}div#p>svg>foreignObject>section:after{--marpit-root-font-size:66%}div#p>svg>foreignObject>section header{top:0}div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{left:0;right:0}div#p>svg>foreignObject>section footer{bottom:0}div#p>svg>foreignObject>section:after{right:0;bottom:0;font-size:80%}div#p>svg>foreignObject>section:after{--marpit-root-font-size:80%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]{display:block!important;padding:0!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:before,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:before{display:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction=vertical]{flex-direction:column}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split]>div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split,50%)}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split=right]>div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]>figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#p>svg>foreignObject>section[data-marpit-advanced-background=content],div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo]{background:transparent!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo],div#p>svg[data-marpit-svg]>foreignObject[data-marpit-advanced-background=pseudo]{pointer-events:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background-split]{width:100%;height:100%}</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id="p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-class="lead" data-theme="gaia" class="lead" data-marpit-pagination="1" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--class:lead;--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h1>第 8 章 数据规整：连接、联合与重塑</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="2" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。</p>
<p>首先，我会介绍pandas的层次化索引，它广泛用于以上操作。然后，我深入介绍了一些特殊的数据操作。在第14章，你可以看到这些工具的多种应用。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="3" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>8.1 层次化索引</h2>
<p>层次化索引（hierarchical indexing）是pandas的一项重要功能，它使你能在一个轴上拥有多个（两个以上）索引级别。抽象点说，它使你能以低维度形式处理高维度数据。我们先来看一个简单的例子：创建一个Series，并用一个由列表或数组组成的列表作为索引：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="4" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">9</span>]: data = pd.Series(np.random.randn(<span class="hljs-number">9</span>),
   ...:                  index=[[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>],
   ...:                         [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]])

In [<span class="hljs-number">10</span>]: data
Out[<span class="hljs-number">10</span>]: 
a  <span class="hljs-number">1</span>   <span class="hljs-number">-0.204708</span>
   <span class="hljs-number">2</span>    <span class="hljs-number">0.478943</span>
   <span class="hljs-number">3</span>   <span class="hljs-number">-0.519439</span>
b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span>
   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span>
c  <span class="hljs-number">1</span>    <span class="hljs-number">1.393406</span>
   <span class="hljs-number">2</span>    <span class="hljs-number">0.092908</span>
d  <span class="hljs-number">2</span>    <span class="hljs-number">0.281746</span>
   <span class="hljs-number">3</span>    <span class="hljs-number">0.769023</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="5" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>看到的结果是经过美化的带有MultiIndex索引的Series的格式。索引之间的“间隔”表示“直接使用上面的标签”：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">11</span>]: data.index
Out[<span class="hljs-number">11</span>]: 
MultiIndex(levels=[[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]],
           labels=[[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="6" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于一个层次化索引的对象，可以使用所谓的部分索引，使用它选取数据子集的操作更简单：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">12</span>]: data[<span class="hljs-string">&#x27;b&#x27;</span>]
Out[<span class="hljs-number">12</span>]: 
<span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span>
<span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span>
dtype: float64
In [<span class="hljs-number">13</span>]: data[<span class="hljs-string">&#x27;b&#x27;</span>:<span class="hljs-string">&#x27;c&#x27;</span>]
Out[<span class="hljs-number">13</span>]: 
b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span>
   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span>
c  <span class="hljs-number">1</span>    <span class="hljs-number">1.393406</span>
   <span class="hljs-number">2</span>    <span class="hljs-number">0.092908</span>
dtype: float64
In [<span class="hljs-number">14</span>]: data.loc[[<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>]]
Out[<span class="hljs-number">14</span>]: 
b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span>
   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span>
d  <span class="hljs-number">2</span>    <span class="hljs-number">0.281746</span>
   <span class="hljs-number">3</span>    <span class="hljs-number">0.769023</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="7" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>有时甚至还可以在“内层”中进行选取：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">15</span>]: data.loc[:, <span class="hljs-number">2</span>]
Out[<span class="hljs-number">15</span>]: 
a    <span class="hljs-number">0.478943</span>
c    <span class="hljs-number">0.092908</span>
d    <span class="hljs-number">0.281746</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="8" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>层次化索引在数据重塑和基于分组的操作（如透视表生成）中扮演着重要的角色。例如，可以通过unstack方法将这段数据重新安排到一个DataFrame中：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">16</span>]: data.unstack()
Out[<span class="hljs-number">16</span>]: 
          <span class="hljs-number">1</span>         <span class="hljs-number">2</span>         <span class="hljs-number">3</span>
a <span class="hljs-number">-0.204708</span>  <span class="hljs-number">0.478943</span> <span class="hljs-number">-0.519439</span>
b <span class="hljs-number">-0.555730</span>       NaN  <span class="hljs-number">1.965781</span>
c  <span class="hljs-number">1.393406</span>  <span class="hljs-number">0.092908</span>       NaN
d       NaN  <span class="hljs-number">0.281746</span>  <span class="hljs-number">0.769023</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="9" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>unstack的逆运算是stack：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">17</span>]: data.unstack().stack()
Out[<span class="hljs-number">17</span>]: 
a  <span class="hljs-number">1</span>   <span class="hljs-number">-0.204708</span>
   <span class="hljs-number">2</span>    <span class="hljs-number">0.478943</span>
   <span class="hljs-number">3</span>   <span class="hljs-number">-0.519439</span>
b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span>
   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span>
c  <span class="hljs-number">1</span>    <span class="hljs-number">1.393406</span>
   <span class="hljs-number">2</span>    <span class="hljs-number">0.092908</span>
d  <span class="hljs-number">2</span>    <span class="hljs-number">0.281746</span>
   <span class="hljs-number">3</span>    <span class="hljs-number">0.769023</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
<p>stack和unstack将在本章后面详细讲解。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="10" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于一个DataFrame，每条轴都可以有分层索引：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">18</span>]: frame = pd.DataFrame(np.arange(<span class="hljs-number">12</span>).reshape((<span class="hljs-number">4</span>, <span class="hljs-number">3</span>)),
   ....:                      index=[[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]],
   ....:                      columns=[[<span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Colorado&#x27;</span>],
   ....:                               [<span class="hljs-string">&#x27;Green&#x27;</span>, <span class="hljs-string">&#x27;Red&#x27;</span>, <span class="hljs-string">&#x27;Green&#x27;</span>]])

In [<span class="hljs-number">19</span>]: frame
Out[<span class="hljs-number">19</span>]: 
     Ohio     Colorado
    Green Red    Green
a <span class="hljs-number">1</span>     <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span>
  <span class="hljs-number">2</span>     <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span>
b <span class="hljs-number">1</span>     <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span>
  <span class="hljs-number">2</span>     <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="11" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>各层都可以有名字（可以是字符串，也可以是别的Python对象）。如果指定了名称，它们就会显示在控制台输出中：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">20</span>]: frame.index.names = [<span class="hljs-string">&#x27;key1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>]
In [<span class="hljs-number">21</span>]: frame.columns.names = [<span class="hljs-string">&#x27;state&#x27;</span>, <span class="hljs-string">&#x27;color&#x27;</span>]
In [<span class="hljs-number">22</span>]: frame
Out[<span class="hljs-number">22</span>]: 
state      Ohio     Colorado
color     Green Red    Green
key1 key2                   
a    <span class="hljs-number">1</span>        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span>
     <span class="hljs-number">2</span>        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span>
b    <span class="hljs-number">1</span>        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span>
     <span class="hljs-number">2</span>        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
<blockquote>
<p>注意：小心区分索引名state、color与行标签。</p>
</blockquote>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="12" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>有了部分列索引，因此可以轻松选取列分组：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">23</span>]: frame[<span class="hljs-string">&#x27;Ohio&#x27;</span>]
Out[<span class="hljs-number">23</span>]: 
color      Green  Red
key1 key2            
a    <span class="hljs-number">1</span>         <span class="hljs-number">0</span>    <span class="hljs-number">1</span>
     <span class="hljs-number">2</span>         <span class="hljs-number">3</span>    <span class="hljs-number">4</span>
b    <span class="hljs-number">1</span>         <span class="hljs-number">6</span>    <span class="hljs-number">7</span>
     <span class="hljs-number">2</span>         <span class="hljs-number">9</span>   <span class="hljs-number">10</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="13" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>可以单独创建MultiIndex然后复用。上面那个DataFrame中的（带有分级名称）列可以这样创建：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>MultiIndex.from_arrays([[<span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Colorado&#x27;</span>], [<span class="hljs-string">&#x27;Green&#x27;</span>, <span class="hljs-string">&#x27;Red&#x27;</span>, <span class="hljs-string">&#x27;Green&#x27;</span>]],
                       names=[<span class="hljs-string">&#x27;state&#x27;</span>, <span class="hljs-string">&#x27;color&#x27;</span>])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="14" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.1.1 重排与分级排序</h3>
<p>有时，你需要重新调整某条轴上各级别的顺序，或根据指定级别上的值对数据进行排序。swaplevel接受两个级别编号或名称，并返回一个互换了级别的新对象（但数据不会发生变化）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">24</span>]: frame.swaplevel(<span class="hljs-string">&#x27;key1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>)
Out[<span class="hljs-number">24</span>]: 
state      Ohio     Colorado
color     Green Red    Green
key2 key1                   
<span class="hljs-number">1</span>    a        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span>
<span class="hljs-number">2</span>    a        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span>
<span class="hljs-number">1</span>    b        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span>
<span class="hljs-number">2</span>    b        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="15" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>而sort_index则根据单个级别中的值对数据进行排序。交换级别时，常常也会用到sort_index，这样最终结果就是按照指定顺序进行字母排序了：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="16" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">25</span>]: frame.sort_index(level=<span class="hljs-number">1</span>)
Out[<span class="hljs-number">25</span>]: 
state      Ohio     Colorado
color     Green Red    Green
key1 key2                   
a    <span class="hljs-number">1</span>        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span>
b    <span class="hljs-number">1</span>        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span>
a    <span class="hljs-number">2</span>        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span>
b    <span class="hljs-number">2</span>        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span>

In [<span class="hljs-number">26</span>]: frame.swaplevel(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>).sort_index(level=<span class="hljs-number">0</span>)
Out[<span class="hljs-number">26</span>]: 
state      Ohio     Colorado
color     Green Red    Green
key2 key1                   
<span class="hljs-number">1</span>    a        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span>
     b        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span>
<span class="hljs-number">2</span>    a        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span>
     b        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="17" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.1.2 根据级别汇总统计</h3>
<p>许多对DataFrame和Series的描述和汇总统计都有一个level选项，它用于指定在某条轴上求和的级别。再以上面那个DataFrame为例，我们可以根据行或列上的级别来进行求和：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="18" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="18" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">27</span>]: frame.sum(level=<span class="hljs-string">&#x27;key2&#x27;</span>)
Out[<span class="hljs-number">27</span>]: 
state  Ohio     Colorado
color Green Red    Green
key2                    
<span class="hljs-number">1</span>         <span class="hljs-number">6</span>   <span class="hljs-number">8</span>       <span class="hljs-number">10</span>
<span class="hljs-number">2</span>        <span class="hljs-number">12</span>  <span class="hljs-number">14</span>       <span class="hljs-number">16</span>
In [<span class="hljs-number">28</span>]: frame.sum(level=<span class="hljs-string">&#x27;color&#x27;</span>, axis=<span class="hljs-number">1</span>)
Out[<span class="hljs-number">28</span>]: 
color      Green  Red
key1 key2            
a    <span class="hljs-number">1</span>         <span class="hljs-number">2</span>    <span class="hljs-number">1</span>
     <span class="hljs-number">2</span>         <span class="hljs-number">8</span>    <span class="hljs-number">4</span>
b    <span class="hljs-number">1</span>        <span class="hljs-number">14</span>    <span class="hljs-number">7</span>
     <span class="hljs-number">2</span>        <span class="hljs-number">20</span>   <span class="hljs-number">10</span>
</span></span></foreignObject></svg></code></pre>
<p>这其实是利用了pandas的groupby功能，本书稍后将对其进行详细讲解。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="19" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.1.3 使用DataFrame的列进行索引</h3>
<p>人们经常想要将DataFrame的一个或多个列当做行索引来用，或者可能希望将行索引变成DataFrame的列。以下面这个DataFrame为例：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="20" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">29</span>]: frame = pd.DataFrame({<span class="hljs-string">&#x27;a&#x27;</span>: range(<span class="hljs-number">7</span>), <span class="hljs-string">&#x27;b&#x27;</span>: range(<span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>),
   ....:                       <span class="hljs-string">&#x27;c&#x27;</span>: [<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>,
   ....:                             <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>],
   ....:                       <span class="hljs-string">&#x27;d&#x27;</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]})

In [<span class="hljs-number">30</span>]: frame
Out[<span class="hljs-number">30</span>]: 
   a  b    c  d
<span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span>  one  <span class="hljs-number">0</span>
<span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span>  one  <span class="hljs-number">1</span>
<span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  one  <span class="hljs-number">2</span>
<span class="hljs-number">3</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  two  <span class="hljs-number">0</span>
<span class="hljs-number">4</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span>  two  <span class="hljs-number">1</span>
<span class="hljs-number">5</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span>  two  <span class="hljs-number">2</span>
<span class="hljs-number">6</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span>  two  <span class="hljs-number">3</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="21" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>DataFrame的set_index函数会将其一个或多个列转换为行索引，并创建一个新的DataFrame：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">31</span>]: frame2 = frame.set_index([<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>])

In [<span class="hljs-number">32</span>]: frame2
Out[<span class="hljs-number">32</span>]: 
       a  b
c   d      
one <span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span>
    <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span>
    <span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>
two <span class="hljs-number">0</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>
    <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span>
    <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span>
    <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="22" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>默认情况下，那些列会从DataFrame中移除，但也可以将其保留下来：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">33</span>]: frame.set_index([<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>], drop=<span class="hljs-literal">False</span>)
Out[<span class="hljs-number">33</span>]: 
       a  b    c  d
c   d              
one <span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span>  one  <span class="hljs-number">0</span>
    <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span>  one  <span class="hljs-number">1</span>
    <span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  one  <span class="hljs-number">2</span>
two <span class="hljs-number">0</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  two  <span class="hljs-number">0</span>
    <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span>  two  <span class="hljs-number">1</span>
    <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span>  two  <span class="hljs-number">2</span>
    <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span>  two  <span class="hljs-number">3</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="23" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>reset_index的功能跟set_index刚好相反，层次化索引的级别会被转移到列里面：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">34</span>]: frame2.reset_index()
Out[<span class="hljs-number">34</span>]:
c  d  a  b
<span class="hljs-number">0</span>  one  <span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span>
<span class="hljs-number">1</span>  one  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span>
<span class="hljs-number">2</span>  one  <span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>
<span class="hljs-number">3</span>  two  <span class="hljs-number">0</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>
<span class="hljs-number">4</span>  two  <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span>
<span class="hljs-number">5</span>  two  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span>
<span class="hljs-number">6</span>  two  <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="24" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>8.2 合并数据集</h2>
<p>pandas对象中的数据可以通过一些方式进行合并：</p>
<ul>
<li>pandas.merge可根据一个或多个键将不同DataFrame中的行连接起来。SQL或其他关系型数据库的用户对此应该会比较熟悉，因为它实现的就是数据库的join操作。</li>
<li>pandas.concat可以沿着一条轴将多个对象堆叠到一起。</li>
<li>实例方法combine_first可以将重复数据拼接在一起，用一个对象中的值填充另一个对象中的缺失值。</li>
</ul>
<p>我将分别对它们进行讲解，并给出一些例子。本书剩余部分的示例中将经常用到它们。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="25" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>8.2.1 数据库风格的DataFrame合并</h2>
<p>数据集的合并（merge）或连接（join）运算是通过一个或多个键将行连接起来的。这些运算是关系型数据库（基于SQL）的核心。pandas的merge函数是对数据应用这些算法的主要切入点。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="26" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>以一个简单的例子开始：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">35</span>]: df1 = pd.DataFrame({<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>],
   ....:                     <span class="hljs-string">&#x27;data1&#x27;</span>: range(<span class="hljs-number">7</span>)})

In [<span class="hljs-number">36</span>]: df2 = pd.DataFrame({<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>],
   ....:                     <span class="hljs-string">&#x27;data2&#x27;</span>: range(<span class="hljs-number">3</span>)})

In [<span class="hljs-number">37</span>]: df1
Out[<span class="hljs-number">37</span>]: 
   data1 key
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b
<span class="hljs-number">2</span>      <span class="hljs-number">2</span>   a
<span class="hljs-number">3</span>      <span class="hljs-number">3</span>   c
<span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a
<span class="hljs-number">5</span>      <span class="hljs-number">5</span>   a
<span class="hljs-number">6</span>      <span class="hljs-number">6</span>   b

In [<span class="hljs-number">38</span>]: df2
Out[<span class="hljs-number">38</span>]: 
   data2 key
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>   a
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b
<span class="hljs-number">2</span>      <span class="hljs-number">2</span>   d
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="27" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>这是一种多对一的合并。df1中的数据有多个被标记为a和b的行，而df2中key列的每个值则仅对应一行。对这些对象调用merge即可得到：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">39</span>]: pd.merge(df1, df2)
Out[<span class="hljs-number">39</span>]: 
   data1 key  data2
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">2</span>      <span class="hljs-number">6</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">3</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">0</span>
<span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">0</span>
<span class="hljs-number">5</span>      <span class="hljs-number">5</span>   a      <span class="hljs-number">0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="28" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>注意，我并没有指明要用哪个列进行连接。如果没有指定，merge就会将重叠列的列名当做键。不过，最好明确指定一下：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">40</span>]: pd.merge(df1, df2, on=<span class="hljs-string">&#x27;key&#x27;</span>)
Out[<span class="hljs-number">40</span>]: 
   data1 key  data2
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">2</span>      <span class="hljs-number">6</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">3</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">0</span>
<span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">0</span>
<span class="hljs-number">5</span>      <span class="hljs-number">5</span>   a      <span class="hljs-number">0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="29" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果两个对象的列名不同，也可以分别进行指定：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">41</span>]: df3 = pd.DataFrame({<span class="hljs-string">&#x27;lkey&#x27;</span>: [<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>],
   ....:                     <span class="hljs-string">&#x27;data1&#x27;</span>: range(<span class="hljs-number">7</span>)})

In [<span class="hljs-number">42</span>]: df4 = pd.DataFrame({<span class="hljs-string">&#x27;rkey&#x27;</span>: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>],
   ....:                     <span class="hljs-string">&#x27;data2&#x27;</span>: range(<span class="hljs-number">3</span>)})

In [<span class="hljs-number">43</span>]: pd.merge(df3, df4, left_on=<span class="hljs-string">&#x27;lkey&#x27;</span>, right_on=<span class="hljs-string">&#x27;rkey&#x27;</span>)
Out[<span class="hljs-number">43</span>]: 
   data1 lkey  data2 rkey
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>    b      <span class="hljs-number">1</span>    b
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>    b      <span class="hljs-number">1</span>    b
<span class="hljs-number">2</span>      <span class="hljs-number">6</span>    b      <span class="hljs-number">1</span>    b
<span class="hljs-number">3</span>      <span class="hljs-number">2</span>    a      <span class="hljs-number">0</span>    a
<span class="hljs-number">4</span>      <span class="hljs-number">4</span>    a      <span class="hljs-number">0</span>    a
<span class="hljs-number">5</span>      <span class="hljs-number">5</span>    a      <span class="hljs-number">0</span>    a
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="30" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>可能你已经注意到了，结果里面c和d以及与之相关的数据消失了。默认情况下，merge做的是“内连接”；结果中的键是交集。其他方式还有&quot;left&quot;、&quot;right&quot;以及&quot;outer&quot;。外连接求取的是键的并集，组合了左连接和右连接的效果：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">44</span>]: pd.merge(df1, df2, how=<span class="hljs-string">&#x27;outer&#x27;</span>)
Out[<span class="hljs-number">44</span>]: 
   data1 key  data2
<span class="hljs-number">0</span>    <span class="hljs-number">0.0</span>   b    <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>    <span class="hljs-number">1.0</span>   b    <span class="hljs-number">1.0</span>
<span class="hljs-number">2</span>    <span class="hljs-number">6.0</span>   b    <span class="hljs-number">1.0</span>
<span class="hljs-number">3</span>    <span class="hljs-number">2.0</span>   a    <span class="hljs-number">0.0</span>
<span class="hljs-number">4</span>    <span class="hljs-number">4.0</span>   a    <span class="hljs-number">0.0</span>
<span class="hljs-number">5</span>    <span class="hljs-number">5.0</span>   a    <span class="hljs-number">0.0</span>
<span class="hljs-number">6</span>    <span class="hljs-number">3.0</span>   c    NaN
<span class="hljs-number">7</span>    NaN   d    <span class="hljs-number">2.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="31" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>表8-1对这些选项进行了总结。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-e49b3341f4a3c90e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="表8-1 不同的连接类型" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="32" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>多对多的合并有些不直观。看下面的例子：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">45</span>]: df1 = pd.DataFrame({<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>],
   ....:                     <span class="hljs-string">&#x27;data1&#x27;</span>: range(<span class="hljs-number">6</span>)})

In [<span class="hljs-number">46</span>]: df2 = pd.DataFrame({<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>],
   ....:                     <span class="hljs-string">&#x27;data2&#x27;</span>: range(<span class="hljs-number">5</span>)})

In [<span class="hljs-number">47</span>]: df1
Out[<span class="hljs-number">47</span>]: 
   data1 key
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b
<span class="hljs-number">2</span>      <span class="hljs-number">2</span>   a
<span class="hljs-number">3</span>      <span class="hljs-number">3</span>   c
<span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a
<span class="hljs-number">5</span>      <span class="hljs-number">5</span>   b

In [<span class="hljs-number">48</span>]: df2
Out[<span class="hljs-number">48</span>]: 
   data2 key
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>   a
<span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b
<span class="hljs-number">2</span>      <span class="hljs-number">2</span>   a
<span class="hljs-number">3</span>      <span class="hljs-number">3</span>   b
<span class="hljs-number">4</span>      <span class="hljs-number">4</span>   d

In [<span class="hljs-number">49</span>]: pd.merge(df1, df2, on=<span class="hljs-string">&#x27;key&#x27;</span>, how=<span class="hljs-string">&#x27;left&#x27;</span>)
Out[<span class="hljs-number">49</span>]: 
    data1 key  data2
<span class="hljs-number">0</span>       <span class="hljs-number">0</span>   b    <span class="hljs-number">1.0</span>
<span class="hljs-number">1</span>       <span class="hljs-number">0</span>   b    <span class="hljs-number">3.0</span>
<span class="hljs-number">2</span>       <span class="hljs-number">1</span>   b    <span class="hljs-number">1.0</span>
<span class="hljs-number">3</span>       <span class="hljs-number">1</span>   b    <span class="hljs-number">3.0</span>
<span class="hljs-number">4</span>       <span class="hljs-number">2</span>   a    <span class="hljs-number">0.0</span>
<span class="hljs-number">5</span>       <span class="hljs-number">2</span>   a    <span class="hljs-number">2.0</span>
<span class="hljs-number">6</span>       <span class="hljs-number">3</span>   c    NaN
<span class="hljs-number">7</span>       <span class="hljs-number">4</span>   a    <span class="hljs-number">0.0</span>
<span class="hljs-number">8</span>       <span class="hljs-number">4</span>   a    <span class="hljs-number">2.0</span>
<span class="hljs-number">9</span>       <span class="hljs-number">5</span>   b    <span class="hljs-number">1.0</span>
<span class="hljs-number">10</span>      <span class="hljs-number">5</span>   b    <span class="hljs-number">3.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="33" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="33" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>多对多连接产生的是行的笛卡尔积。由于左边的DataFrame有3个&quot;b&quot;行，右边的有2个，所以最终结果中就有6个&quot;b&quot;行。连接方式只影响出现在结果中的不同的键的值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">50</span>]: pd.merge(df1, df2, how=<span class="hljs-string">&#x27;inner&#x27;</span>)
Out[<span class="hljs-number">50</span>]: 
   data1 key  data2
<span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">1</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">3</span>
<span class="hljs-number">2</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">3</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">3</span>
<span class="hljs-number">4</span>      <span class="hljs-number">5</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">5</span>      <span class="hljs-number">5</span>   b      <span class="hljs-number">3</span>
<span class="hljs-number">6</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">0</span>
<span class="hljs-number">7</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>
<span class="hljs-number">8</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">0</span>
<span class="hljs-number">9</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">2</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="34" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="34" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>要根据多个键进行合并，传入一个由列名组成的列表即可：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">51</span>]: left = pd.DataFrame({<span class="hljs-string">&#x27;key1&#x27;</span>: [<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>],
   ....:                      <span class="hljs-string">&#x27;key2&#x27;</span>: [<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;one&#x27;</span>],
   ....:                      <span class="hljs-string">&#x27;lval&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]})

In [<span class="hljs-number">52</span>]: right = pd.DataFrame({<span class="hljs-string">&#x27;key1&#x27;</span>: [<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>],
   ....:                       <span class="hljs-string">&#x27;key2&#x27;</span>: [<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>],
   ....:                       <span class="hljs-string">&#x27;rval&#x27;</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]})

In [<span class="hljs-number">53</span>]: pd.merge(left, right, on=[<span class="hljs-string">&#x27;key1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>], how=<span class="hljs-string">&#x27;outer&#x27;</span>)
Out[<span class="hljs-number">53</span>]: 
  key1 key2  lval  rval
<span class="hljs-number">0</span>  foo  one   <span class="hljs-number">1.0</span>   <span class="hljs-number">4.0</span>
<span class="hljs-number">1</span>  foo  one   <span class="hljs-number">1.0</span>   <span class="hljs-number">5.0</span>
<span class="hljs-number">2</span>  foo  two   <span class="hljs-number">2.0</span>   NaN
<span class="hljs-number">3</span>  bar  one   <span class="hljs-number">3.0</span>   <span class="hljs-number">6.0</span>
<span class="hljs-number">4</span>  bar  two   NaN   <span class="hljs-number">7.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="35" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>结果中会出现哪些键组合取决于所选的合并方式，你可以这样来理解：多个键形成一系列元组，并将其当做单个连接键（当然，实际上并不是这么回事）。</p>
<blockquote>
<p>注意：在进行列－列连接时，DataFrame对象中的索引会被丢弃。</p>
</blockquote>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="36" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于合并运算需要考虑的最后一个问题是对重复列名的处理。虽然你可以手工处理列名重叠的问题（查看前面介绍的重命名轴标签），但merge有一个更实用的suffixes选项，用于指定附加到左右两个DataFrame对象的重叠列名上的字符串：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="37" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="37" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">54</span>]: pd.merge(left, right, on=<span class="hljs-string">&#x27;key1&#x27;</span>)
  key1 key2_x  lval key2_y  rval
<span class="hljs-number">0</span>  foo    one     <span class="hljs-number">1</span>    one     <span class="hljs-number">4</span>
<span class="hljs-number">1</span>  foo    one     <span class="hljs-number">1</span>    one     <span class="hljs-number">5</span>
<span class="hljs-number">2</span>  foo    two     <span class="hljs-number">2</span>    one     <span class="hljs-number">4</span>
<span class="hljs-number">3</span>  foo    two     <span class="hljs-number">2</span>    one     <span class="hljs-number">5</span>
<span class="hljs-number">4</span>  bar    one     <span class="hljs-number">3</span>    one     <span class="hljs-number">6</span>
<span class="hljs-number">5</span>  bar    one     <span class="hljs-number">3</span>    two     <span class="hljs-number">7</span>
In [<span class="hljs-number">55</span>]: pd.merge(left, right, on=<span class="hljs-string">&#x27;key1&#x27;</span>, suffixes=(<span class="hljs-string">&#x27;_left&#x27;</span>, <span class="hljs-string">&#x27;_right&#x27;</span>))
  key1 key2_left  lval key2_right  rval
<span class="hljs-number">0</span>  foo       one     <span class="hljs-number">1</span>        one     <span class="hljs-number">4</span>
<span class="hljs-number">1</span>  foo       one     <span class="hljs-number">1</span>        one     <span class="hljs-number">5</span>
<span class="hljs-number">2</span>  foo       two     <span class="hljs-number">2</span>        one     <span class="hljs-number">4</span>
<span class="hljs-number">3</span>  foo       two     <span class="hljs-number">2</span>        one     <span class="hljs-number">5</span>
<span class="hljs-number">4</span>  bar       one     <span class="hljs-number">3</span>        one     <span class="hljs-number">6</span>
<span class="hljs-number">5</span>  bar       one     <span class="hljs-number">3</span>        two     <span class="hljs-number">7</span>
</span></span></foreignObject></svg></code></pre>
<p>merge的参数请参见表8-2。使用DataFrame的行索引合并是下一节的主题。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="38" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="38" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>表8-2 merge函数的参数</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-35ca716a4f1b8475.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="w:400" style="width:400px;" /></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-c86672e733ceccd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="w:400" style="width:400px;" /></p>
<p>indicator 添加特殊的列_merge，它可以指明每个行的来源，它的值有left_only、right_only或both，根据每行的合并数据的来源。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="39" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="39" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.2.2 索引上的合并</h3>
<p>有时候，DataFrame中的连接键位于其索引中。在这种情况下，你可以传入left_index=True或right_index=True（或两个都传）以说明索引应该被用作连接键：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="40" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="40" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">56</span>]: left1 = pd.DataFrame({<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>],
   ....:                       <span class="hljs-string">&#x27;value&#x27;</span>: range(<span class="hljs-number">6</span>)})

In [<span class="hljs-number">57</span>]: right1 = pd.DataFrame({<span class="hljs-string">&#x27;group_val&#x27;</span>: [<span class="hljs-number">3.5</span>, <span class="hljs-number">7</span>]}, index=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>])

In [<span class="hljs-number">58</span>]: left1
Out[<span class="hljs-number">58</span>]:

  key  value
<span class="hljs-number">0</span>   a      <span class="hljs-number">0</span>
<span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>
<span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>
<span class="hljs-number">3</span>   a      <span class="hljs-number">3</span>
<span class="hljs-number">4</span>   b      <span class="hljs-number">4</span>
<span class="hljs-number">5</span>   c      <span class="hljs-number">5</span>

In [<span class="hljs-number">59</span>]: right1
Out[<span class="hljs-number">59</span>]: 
   group_val
a        <span class="hljs-number">3.5</span>
b        <span class="hljs-number">7.0</span>

In [<span class="hljs-number">60</span>]: pd.merge(left1, right1, left_on=<span class="hljs-string">&#x27;key&#x27;</span>, right_index=<span class="hljs-literal">True</span>)
Out[<span class="hljs-number">60</span>]: 
  key  value  group_val
<span class="hljs-number">0</span>   a      <span class="hljs-number">0</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">3</span>   a      <span class="hljs-number">3</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>        <span class="hljs-number">7.0</span>
<span class="hljs-number">4</span>   b      <span class="hljs-number">4</span>        <span class="hljs-number">7.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="41" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="41" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>由于默认的merge方法是求取连接键的交集，因此你可以通过外连接的方式得到它们的并集：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">61</span>]: pd.merge(left1, right1, left_on=<span class="hljs-string">&#x27;key&#x27;</span>, right_index=<span class="hljs-literal">True</span>, how=<span class="hljs-string">&#x27;outer&#x27;</span>)
Out[<span class="hljs-number">61</span>]: 
  key  value  group_val
<span class="hljs-number">0</span>   a      <span class="hljs-number">0</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">3</span>   a      <span class="hljs-number">3</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>        <span class="hljs-number">7.0</span>
<span class="hljs-number">4</span>   b      <span class="hljs-number">4</span>        <span class="hljs-number">7.0</span>
<span class="hljs-number">5</span>   c      <span class="hljs-number">5</span>        NaN
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="42" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="42" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于层次化索引的数据，事情就有点复杂了，因为索引的合并默认是多键合并：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">62</span>]: lefth = pd.DataFrame({<span class="hljs-string">&#x27;key1&#x27;</span>: [<span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Ohio&#x27;</span>,
   ....:                                <span class="hljs-string">&#x27;Nevada&#x27;</span>, <span class="hljs-string">&#x27;Nevada&#x27;</span>],
   ....:                       <span class="hljs-string">&#x27;key2&#x27;</span>: [<span class="hljs-number">2000</span>, <span class="hljs-number">2001</span>, <span class="hljs-number">2002</span>, <span class="hljs-number">2001</span>, <span class="hljs-number">2002</span>],
   ....:                       <span class="hljs-string">&#x27;data&#x27;</span>: np.arange(<span class="hljs-number">5.</span>)})
In [<span class="hljs-number">64</span>]: lefth
Out[<span class="hljs-number">64</span>]: 
   data    key1  key2
<span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>
<span class="hljs-number">1</span>   <span class="hljs-number">1.0</span>    Ohio  <span class="hljs-number">2001</span>
<span class="hljs-number">2</span>   <span class="hljs-number">2.0</span>    Ohio  <span class="hljs-number">2002</span>
<span class="hljs-number">3</span>   <span class="hljs-number">3.0</span>  Nevada  <span class="hljs-number">2001</span>
<span class="hljs-number">4</span>   <span class="hljs-number">4.0</span>  Nevada  <span class="hljs-number">2002</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="43" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="43" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">63</span>]: righth = pd.DataFrame(np.arange(<span class="hljs-number">12</span>).reshape((<span class="hljs-number">6</span>, <span class="hljs-number">2</span>)),
   ....:                       index=[[<span class="hljs-string">&#x27;Nevada&#x27;</span>, <span class="hljs-string">&#x27;Nevada&#x27;</span>, <span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Ohio&#x27;</span>,
   ....:                               <span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Ohio&#x27;</span>],
   ....:                              [<span class="hljs-number">2001</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2001</span>, <span class="hljs-number">2002</span>]],
   ....:                       columns=[<span class="hljs-string">&#x27;event1&#x27;</span>, <span class="hljs-string">&#x27;event2&#x27;</span>])

In [<span class="hljs-number">65</span>]: righth
Out[<span class="hljs-number">65</span>]: 
             event1  event2
Nevada <span class="hljs-number">2001</span>       <span class="hljs-number">0</span>       <span class="hljs-number">1</span>
       <span class="hljs-number">2000</span>       <span class="hljs-number">2</span>       <span class="hljs-number">3</span>
Ohio   <span class="hljs-number">2000</span>       <span class="hljs-number">4</span>       <span class="hljs-number">5</span>
       <span class="hljs-number">2000</span>       <span class="hljs-number">6</span>       <span class="hljs-number">7</span>
       <span class="hljs-number">2001</span>       <span class="hljs-number">8</span>       <span class="hljs-number">9</span>
       <span class="hljs-number">2002</span>      <span class="hljs-number">10</span>      <span class="hljs-number">11</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="44" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="44" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>这种情况下，你必须以列表的形式指明用作合并键的多个列（注意用how='outer'对重复索引值的处理）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">66</span>]: pd.merge(lefth, righth, left_on=[<span class="hljs-string">&#x27;key1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>], right_index=<span class="hljs-literal">True</span>)
Out[<span class="hljs-number">66</span>]: 
   data    key1  key2  event1  event2
<span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>       <span class="hljs-number">4</span>       <span class="hljs-number">5</span>
<span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>       <span class="hljs-number">6</span>       <span class="hljs-number">7</span>
<span class="hljs-number">1</span>   <span class="hljs-number">1.0</span>    Ohio  <span class="hljs-number">2001</span>       <span class="hljs-number">8</span>       <span class="hljs-number">9</span>
<span class="hljs-number">2</span>   <span class="hljs-number">2.0</span>    Ohio  <span class="hljs-number">2002</span>      <span class="hljs-number">10</span>      <span class="hljs-number">11</span>
<span class="hljs-number">3</span>   <span class="hljs-number">3.0</span>  Nevada  <span class="hljs-number">2001</span>       <span class="hljs-number">0</span>       <span class="hljs-number">1</span>

In [<span class="hljs-number">67</span>]: pd.merge(lefth, righth, left_on=[<span class="hljs-string">&#x27;key1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>],
   ....:          right_index=<span class="hljs-literal">True</span>, how=<span class="hljs-string">&#x27;outer&#x27;</span>)
Out[<span class="hljs-number">67</span>]: 
   data    key1  key2  event1  event2
<span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>     <span class="hljs-number">4.0</span>     <span class="hljs-number">5.0</span>
<span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>     <span class="hljs-number">6.0</span>     <span class="hljs-number">7.0</span>
<span class="hljs-number">1</span>   <span class="hljs-number">1.0</span>    Ohio  <span class="hljs-number">2001</span>     <span class="hljs-number">8.0</span>     <span class="hljs-number">9.0</span>
<span class="hljs-number">2</span>   <span class="hljs-number">2.0</span>    Ohio  <span class="hljs-number">2002</span>    <span class="hljs-number">10.0</span>    <span class="hljs-number">11.0</span>
<span class="hljs-number">3</span>   <span class="hljs-number">3.0</span>  Nevada  <span class="hljs-number">2001</span>     <span class="hljs-number">0.0</span>     <span class="hljs-number">1.0</span>
<span class="hljs-number">4</span>   <span class="hljs-number">4.0</span>  Nevada  <span class="hljs-number">2002</span>     NaN     NaN
<span class="hljs-number">4</span>   NaN  Nevada  <span class="hljs-number">2000</span>     <span class="hljs-number">2.0</span>     <span class="hljs-number">3.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="45" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="45" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>同时使用合并双方的索引也没问题：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">68</span>]: left2 = pd.DataFrame([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>], [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>], [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]],
   ....:                      index=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>],
   ....:                      columns=[<span class="hljs-string">&#x27;Ohio&#x27;</span>, <span class="hljs-string">&#x27;Nevada&#x27;</span>])

In [<span class="hljs-number">69</span>]: right2 = pd.DataFrame([[<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>], [<span class="hljs-number">9.</span>, <span class="hljs-number">10.</span>], [<span class="hljs-number">11.</span>, <span class="hljs-number">12.</span>], [<span class="hljs-number">13</span>, <span class="hljs-number">14</span>]],
   ....:                       index=[<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>],
   ....:                       columns=[<span class="hljs-string">&#x27;Missouri&#x27;</span>, <span class="hljs-string">&#x27;Alabama&#x27;</span>])

In [<span class="hljs-number">70</span>]: left2
Out[<span class="hljs-number">70</span>]: 
   Ohio  Nevada
a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>
c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>
e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>

In [<span class="hljs-number">71</span>]: right2
Out[<span class="hljs-number">71</span>]: 
   Missouri  Alabama
b       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span>
c       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span>
d      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span>
e      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="46" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="46" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">72</span>]: pd.merge(left2, right2, how=<span class="hljs-string">&#x27;outer&#x27;</span>, left_index=<span class="hljs-literal">True</span>, right_index=<span class="hljs-literal">True</span>)
Out[<span class="hljs-number">72</span>]: 
   Ohio  Nevada  Missouri  Alabama
a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN
b   NaN     NaN       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span>
c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span>
d   NaN     NaN      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span>
e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="47" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="47" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>DataFrame还有一个便捷的join实例方法，它能更为方便地实现按索引合并。它还可用于合并多个带有相同或相似索引的DataFrame对象，但要求没有重叠的列。在上面那个例子中，我们可以编写：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">73</span>]: left2.join(right2, how=<span class="hljs-string">&#x27;outer&#x27;</span>)
Out[<span class="hljs-number">73</span>]: 
   Ohio  Nevada  Missouri  Alabama
a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN
b   NaN     NaN       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span>
c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span>
d   NaN     NaN      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span>
e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="48" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="48" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>因为一些历史版本的遗留原因，DataFrame的join方法默认使用的是左连接，保留左边表的行索引。它还支持在调用的DataFrame的列上，连接传递的DataFrame索引：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">74</span>]: left1.join(right1, on=<span class="hljs-string">&#x27;key&#x27;</span>)
Out[<span class="hljs-number">74</span>]: 
  key  value  group_val
<span class="hljs-number">0</span>   a      <span class="hljs-number">0</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>        <span class="hljs-number">7.0</span>
<span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">3</span>   a      <span class="hljs-number">3</span>        <span class="hljs-number">3.5</span>
<span class="hljs-number">4</span>   b      <span class="hljs-number">4</span>        <span class="hljs-number">7.0</span>
<span class="hljs-number">5</span>   c      <span class="hljs-number">5</span>        NaN
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="49" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="49" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>最后，对于简单的索引合并，你还可以向join传入一组DataFrame，下一节会介绍更为通用的concat函数，也能实现此功能：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">75</span>]: another = pd.DataFrame([[<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>], [<span class="hljs-number">9.</span>, <span class="hljs-number">10.</span>], [<span class="hljs-number">11.</span>, <span class="hljs-number">12.</span>], [<span class="hljs-number">16.</span>, <span class="hljs-number">17.</span>]],
   ....:                        index=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>],
   ....:                        columns=[<span class="hljs-string">&#x27;New York&#x27;</span>,
<span class="hljs-string">&#x27;Oregon&#x27;</span>])
In [<span class="hljs-number">76</span>]: another
Out[<span class="hljs-number">76</span>]: 
   New York  Oregon
a       <span class="hljs-number">7.0</span>     <span class="hljs-number">8.0</span>
c       <span class="hljs-number">9.0</span>    <span class="hljs-number">10.0</span>
e      <span class="hljs-number">11.0</span>    <span class="hljs-number">12.0</span>
f      <span class="hljs-number">16.0</span>    <span class="hljs-number">17.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="50" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="50" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">77</span>]: left2.join([right2, another])
Out[<span class="hljs-number">77</span>]: 
   Ohio  Nevada  Missouri  Alabama  New York  Oregon
a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN       <span class="hljs-number">7.0</span>     <span class="hljs-number">8.0</span>
c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span>       <span class="hljs-number">9.0</span>    <span class="hljs-number">10.0</span>
e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span>      <span class="hljs-number">11.0</span>    <span class="hljs-number">12.0</span>

In [<span class="hljs-number">78</span>]: left2.join([right2, another], how=<span class="hljs-string">&#x27;outer&#x27;</span>)
Out[<span class="hljs-number">78</span>]: 
   Ohio  Nevada  Missouri  Alabama  New York  Oregon
a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN       <span class="hljs-number">7.0</span>     <span class="hljs-number">8.0</span>
b   NaN     NaN       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span>       NaN     NaN
c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span>       <span class="hljs-number">9.0</span>    <span class="hljs-number">10.0</span>
d   NaN     NaN      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span>       NaN     NaN
e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span>      <span class="hljs-number">11.0</span>    <span class="hljs-number">12.0</span>
f   NaN     NaN       NaN      NaN      <span class="hljs-number">16.0</span>    <span class="hljs-number">17.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="51" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="51" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.2.3 轴向连接</h3>
<p>另一种数据合并运算也被称作连接（concatenation）、绑定（binding）或堆叠（stacking）。NumPy的concatenation函数可以用NumPy数组来做：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="52" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="52" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">79</span>]: arr = np.arange(<span class="hljs-number">12</span>).reshape((<span class="hljs-number">3</span>, <span class="hljs-number">4</span>))

In [<span class="hljs-number">80</span>]: arr
Out[<span class="hljs-number">80</span>]: 
array([[ <span class="hljs-number">0</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>],
       [ <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">6</span>,  <span class="hljs-number">7</span>],
       [ <span class="hljs-number">8</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>]])

In [<span class="hljs-number">81</span>]: np.concatenate([arr, arr], axis=<span class="hljs-number">1</span>)
Out[<span class="hljs-number">81</span>]: 
array([[ <span class="hljs-number">0</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>],
       [ <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">6</span>,  <span class="hljs-number">7</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">6</span>,  <span class="hljs-number">7</span>],
       [ <span class="hljs-number">8</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>,  <span class="hljs-number">8</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>]])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="53" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="53" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于pandas对象（如Series和DataFrame），带有标签的轴使你能够进一步推广数组的连接运算。具体点说，你还需要考虑以下这些东西：</p>
<ul>
<li>如果对象在其它轴上的索引不同，我们应该合并这些轴的不同元素还是只使用交集？</li>
<li>连接的数据集是否需要在结果对象中可识别？</li>
<li>连接轴中保存的数据是否需要保留？许多情况下，DataFrame默认的整数标签最好在连接时删掉。</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="54" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="54" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>pandas的concat函数提供了一种能够解决这些问题的可靠方式。我将给出一些例子来讲解其使用方式。假设有三个没有重叠索引的Series：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">82</span>]: s1 = pd.Series([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], index=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>])

In [<span class="hljs-number">83</span>]: s2 = pd.Series([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>], index=[<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>])

In [<span class="hljs-number">84</span>]: s3 = pd.Series([<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], index=[<span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="55" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="55" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对这些对象调用concat可以将值和索引粘合在一起：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">85</span>]: pd.concat([s1, s2, s3])
Out[<span class="hljs-number">85</span>]: 
a    <span class="hljs-number">0</span>
b    <span class="hljs-number">1</span>
c    <span class="hljs-number">2</span>
d    <span class="hljs-number">3</span>
e    <span class="hljs-number">4</span>
f    <span class="hljs-number">5</span>
g    <span class="hljs-number">6</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="56" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="56" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>默认情况下，concat是在axis=0上工作的，最终产生一个新的Series。如果传入axis=1，则结果就会变成一个DataFrame（axis=1是列）：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">86</span>]: pd.concat([s1, s2, s3], axis=<span class="hljs-number">1</span>)
Out[<span class="hljs-number">86</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span>
a  <span class="hljs-number">0.0</span>  NaN  NaN
b  <span class="hljs-number">1.0</span>  NaN  NaN
c  NaN  <span class="hljs-number">2.0</span>  NaN
d  NaN  <span class="hljs-number">3.0</span>  NaN
e  NaN  <span class="hljs-number">4.0</span>  NaN
f  NaN  NaN  <span class="hljs-number">5.0</span>
g  NaN  NaN  <span class="hljs-number">6.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="57" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="57" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>这种情况下，另外的轴上没有重叠，从索引的有序并集（外连接）上就可以看出来。传入join='inner'即可得到它们的交集：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">87</span>]: s4 = pd.concat([s1, s3])

In [<span class="hljs-number">88</span>]: s4
Out[<span class="hljs-number">88</span>]: 
a    <span class="hljs-number">0</span>
b    <span class="hljs-number">1</span>
f    <span class="hljs-number">5</span>
g    <span class="hljs-number">6</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="58" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="58" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">89</span>]: pd.concat([s1, s4], axis=<span class="hljs-number">1</span>)
Out[<span class="hljs-number">89</span>]: 
     <span class="hljs-number">0</span>  <span class="hljs-number">1</span>
a  <span class="hljs-number">0.0</span>  <span class="hljs-number">0</span>
b  <span class="hljs-number">1.0</span>  <span class="hljs-number">1</span>
f  NaN  <span class="hljs-number">5</span>
g  NaN  <span class="hljs-number">6</span>

In [<span class="hljs-number">90</span>]: pd.concat([s1, s4], axis=<span class="hljs-number">1</span>, join=<span class="hljs-string">&#x27;inner&#x27;</span>)
Out[<span class="hljs-number">90</span>]: 
   <span class="hljs-number">0</span>  <span class="hljs-number">1</span>
a  <span class="hljs-number">0</span>  <span class="hljs-number">0</span>
b  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>
</span></span></foreignObject></svg></code></pre>
<p>在这个例子中，f和g标签消失了，是因为使用的是join='inner'选项。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="59" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="59" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>你可以通过join_axes指定要在其它轴上使用的索引：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">91</span>]: pd.concat([s1, s4], axis=<span class="hljs-number">1</span>, join_axes=[[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>]])
Out[<span class="hljs-number">91</span>]: 
     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>
a  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span>
c  NaN  NaN
b  <span class="hljs-number">1.0</span>  <span class="hljs-number">1.0</span>
e  NaN  NaN
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="60" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="60" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>不过有个问题，参与连接的片段在结果中区分不开。假设你想要在连接轴上创建一个层次化索引。使用keys参数即可达到这个目的：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">92</span>]: result = pd.concat([s1, s1, s3], keys=[<span class="hljs-string">&#x27;one&#x27;</span>,<span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>])

In [<span class="hljs-number">93</span>]: result
Out[<span class="hljs-number">93</span>]: 
one    a    <span class="hljs-number">0</span>
       b    <span class="hljs-number">1</span>
two    a    <span class="hljs-number">0</span>
       b    <span class="hljs-number">1</span>
three  f    <span class="hljs-number">5</span>
       g    <span class="hljs-number">6</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="61" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="61" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">94</span>]: result.unstack()
Out[<span class="hljs-number">94</span>]: 
         a    b    f    g
one    <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  NaN  NaN
two    <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  NaN  NaN
three  NaN  NaN  <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="62" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="62" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果沿着axis=1对Series进行合并，则keys就会成为DataFrame的列头：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">95</span>]: pd.concat([s1, s2, s3], axis=<span class="hljs-number">1</span>, keys=[<span class="hljs-string">&#x27;one&#x27;</span>,<span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>])
Out[<span class="hljs-number">95</span>]: 
   one  two  three
a  <span class="hljs-number">0.0</span>  NaN    NaN
b  <span class="hljs-number">1.0</span>  NaN    NaN
c  NaN  <span class="hljs-number">2.0</span>    NaN
d  NaN  <span class="hljs-number">3.0</span>    NaN
e  NaN  <span class="hljs-number">4.0</span>    NaN
f  NaN  NaN    <span class="hljs-number">5.0</span>
g  NaN  NaN    <span class="hljs-number">6.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="63" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="63" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>同样的逻辑也适用于DataFrame对象：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">96</span>]: df1 = pd.DataFrame(np.arange(<span class="hljs-number">6</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>), index=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>],
   ....:                    columns=[<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>])

In [<span class="hljs-number">97</span>]: df2 = pd.DataFrame(<span class="hljs-number">5</span> + np.arange(<span class="hljs-number">4</span>).reshape(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), index=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>],
   ....:                    columns=[<span class="hljs-string">&#x27;three&#x27;</span>, <span class="hljs-string">&#x27;four&#x27;</span>])

In [<span class="hljs-number">98</span>]: df1
Out[<span class="hljs-number">98</span>]: 
   one  two
a    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>
b    <span class="hljs-number">2</span>    <span class="hljs-number">3</span>
c    <span class="hljs-number">4</span>    <span class="hljs-number">5</span>

In [<span class="hljs-number">99</span>]: df2
Out[<span class="hljs-number">99</span>]: 
   three  four
a      <span class="hljs-number">5</span>     <span class="hljs-number">6</span>
c      <span class="hljs-number">7</span>     <span class="hljs-number">8</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="64" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="64" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">100</span>]: pd.concat([df1, df2], axis=<span class="hljs-number">1</span>, keys=[<span class="hljs-string">&#x27;level1&#x27;</span>, <span class="hljs-string">&#x27;level2&#x27;</span>])
Out[<span class="hljs-number">100</span>]: 
  level1     level2     
     one two  three four
a      <span class="hljs-number">0</span>   <span class="hljs-number">1</span>    <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span>
b      <span class="hljs-number">2</span>   <span class="hljs-number">3</span>    NaN  NaN
c      <span class="hljs-number">4</span>   <span class="hljs-number">5</span>    <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="65" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="65" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果传入的不是列表而是一个字典，则字典的键就会被当做keys选项的值：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">101</span>]: pd.concat({<span class="hljs-string">&#x27;level1&#x27;</span>: df1, <span class="hljs-string">&#x27;level2&#x27;</span>: df2}, axis=<span class="hljs-number">1</span>)

Out[<span class="hljs-number">101</span>]: 
  level1     level2     
     one two  three four
a      <span class="hljs-number">0</span>   <span class="hljs-number">1</span>    <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span>
b      <span class="hljs-number">2</span>   <span class="hljs-number">3</span>    NaN  NaN
c      <span class="hljs-number">4</span>   <span class="hljs-number">5</span>    <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="66" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="66" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>此外还有两个用于管理层次化索引创建方式的参数（参见表8-3）。举个例子，我们可以用names参数命名创建的轴级别：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">102</span>]: pd.concat([df1, df2], axis=<span class="hljs-number">1</span>, keys=[<span class="hljs-string">&#x27;level1&#x27;</span>, <span class="hljs-string">&#x27;level2&#x27;</span>],
   .....:           names=[<span class="hljs-string">&#x27;upper&#x27;</span>, <span class="hljs-string">&#x27;lower&#x27;</span>])
Out[<span class="hljs-number">102</span>]: 
upper level1     level2     
lower    one two  three four
a          <span class="hljs-number">0</span>   <span class="hljs-number">1</span>    <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span>
b          <span class="hljs-number">2</span>   <span class="hljs-number">3</span>    NaN  NaN
c          <span class="hljs-number">4</span>   <span class="hljs-number">5</span>    <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="67" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="67" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>最后一个关于DataFrame的问题是，DataFrame的行索引不包含任何相关数据：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">103</span>]: df1 = pd.DataFrame(np.random.randn(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>), columns=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>])

In [<span class="hljs-number">104</span>]: df2 = pd.DataFrame(np.random.randn(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), columns=[<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>])

In [<span class="hljs-number">105</span>]: df1
Out[<span class="hljs-number">105</span>]: 
          a         b         c         d
<span class="hljs-number">0</span>  <span class="hljs-number">1.246435</span>  <span class="hljs-number">1.007189</span> <span class="hljs-number">-1.296221</span>  <span class="hljs-number">0.274992</span>
<span class="hljs-number">1</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span>
<span class="hljs-number">2</span> <span class="hljs-number">-0.371843</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>

In [<span class="hljs-number">106</span>]: df2
Out[<span class="hljs-number">106</span>]: 
          b         d         a
<span class="hljs-number">0</span>  <span class="hljs-number">0.476985</span>  <span class="hljs-number">3.248944</span> <span class="hljs-number">-1.021228</span>
<span class="hljs-number">1</span> <span class="hljs-number">-0.577087</span>  <span class="hljs-number">0.124121</span>  <span class="hljs-number">0.302614</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="68" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="68" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>在这种情况下，传入ignore_index=True即可：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">107</span>]: pd.concat([df1, df2], ignore_index=<span class="hljs-literal">True</span>)
Out[<span class="hljs-number">107</span>]: 
          a         b         c         d
<span class="hljs-number">0</span>  <span class="hljs-number">1.246435</span>  <span class="hljs-number">1.007189</span> <span class="hljs-number">-1.296221</span>  <span class="hljs-number">0.274992</span>
<span class="hljs-number">1</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span>
<span class="hljs-number">2</span> <span class="hljs-number">-0.371843</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span>
<span class="hljs-number">3</span> <span class="hljs-number">-1.021228</span>  <span class="hljs-number">0.476985</span>       NaN  <span class="hljs-number">3.248944</span>
<span class="hljs-number">4</span>  <span class="hljs-number">0.302614</span> <span class="hljs-number">-0.577087</span>       NaN  <span class="hljs-number">0.124121</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="69" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="69" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p><img src="http://upload-images.jianshu.io/upload_images/7178691-339436563b519415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="表8-3 concat函数的参数 w:800" style="width:800px;" /></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="70" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="70" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.2.4 合并重叠数据</h3>
<p>还有一种数据组合问题不能用简单的合并（merge）或连接（concatenation）运算来处理。比如说，你可能有索引全部或部分重叠的两个数据集。举个有启发性的例子，我们使用NumPy的where函数，它表示一种等价于面向数组的if-else：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="71" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="71" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">108</span>]: a = pd.Series([np.nan, <span class="hljs-number">2.5</span>, np.nan, <span class="hljs-number">3.5</span>, <span class="hljs-number">4.5</span>, np.nan],
   .....:               index=[<span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>])

In [<span class="hljs-number">109</span>]: b = pd.Series(np.arange(len(a), dtype=np.float64),
   .....:               index=[<span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>])

In [<span class="hljs-number">110</span>]: b[<span class="hljs-number">-1</span>] = np.nan

In [<span class="hljs-number">111</span>]: a
Out[<span class="hljs-number">111</span>]: 
f    NaN
e    <span class="hljs-number">2.5</span>
d    NaN
c    <span class="hljs-number">3.5</span>
b    <span class="hljs-number">4.5</span>
a    NaN
dtype: float64

In [<span class="hljs-number">112</span>]: b
Out[<span class="hljs-number">112</span>]: 
f    <span class="hljs-number">0.0</span>
e    <span class="hljs-number">1.0</span>
d    <span class="hljs-number">2.0</span>
c    <span class="hljs-number">3.0</span>
b    <span class="hljs-number">4.0</span>
a    NaN
dtype: float64

In [<span class="hljs-number">113</span>]: np.where(pd.isnull(a), b, a)
Out[<span class="hljs-number">113</span>]: array([ <span class="hljs-number">0.</span> ,  <span class="hljs-number">2.5</span>,  <span class="hljs-number">2.</span> ,  <span class="hljs-number">3.5</span>,  <span class="hljs-number">4.5</span>,  nan])
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="72" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="72" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>Series有一个combine_first方法，实现的也是一样的功能，还带有pandas的数据对齐：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">114</span>]: b[:<span class="hljs-number">-2</span>].combine_first(a[<span class="hljs-number">2</span>:])
Out[<span class="hljs-number">114</span>]: 
a    NaN
b    <span class="hljs-number">4.5</span>
c    <span class="hljs-number">3.0</span>
d    <span class="hljs-number">2.0</span>
e    <span class="hljs-number">1.0</span>
f    <span class="hljs-number">0.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="73" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="73" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于DataFrame，combine_first自然也会在列上做同样的事情，因此你可以将其看做：用传递对象中的数据为调用对象的缺失数据“打补丁”：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">115</span>]: df1 = pd.DataFrame({<span class="hljs-string">&#x27;a&#x27;</span>: [<span class="hljs-number">1.</span>, np.nan, <span class="hljs-number">5.</span>, np.nan],
   .....:                     <span class="hljs-string">&#x27;b&#x27;</span>: [np.nan, <span class="hljs-number">2.</span>, np.nan, <span class="hljs-number">6.</span>],
   .....:                     <span class="hljs-string">&#x27;c&#x27;</span>: range(<span class="hljs-number">2</span>, <span class="hljs-number">18</span>, <span class="hljs-number">4</span>)})
In [<span class="hljs-number">116</span>]: df2 = pd.DataFrame({<span class="hljs-string">&#x27;a&#x27;</span>: [<span class="hljs-number">5.</span>, <span class="hljs-number">4.</span>, np.nan, <span class="hljs-number">3.</span>, <span class="hljs-number">7.</span>],
   .....:                     <span class="hljs-string">&#x27;b&#x27;</span>: [np.nan, <span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>, <span class="hljs-number">6.</span>, <span class="hljs-number">8.</span>]})
In [<span class="hljs-number">117</span>]: df1
     a    b   c
<span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  NaN   <span class="hljs-number">2</span>
<span class="hljs-number">1</span>  NaN  <span class="hljs-number">2.0</span>   <span class="hljs-number">6</span>
<span class="hljs-number">2</span>  <span class="hljs-number">5.0</span>  NaN  <span class="hljs-number">10</span>
<span class="hljs-number">3</span>  NaN  <span class="hljs-number">6.0</span>  <span class="hljs-number">14</span>
In [<span class="hljs-number">118</span>]: df2
     a    b
<span class="hljs-number">0</span>  <span class="hljs-number">5.0</span>  NaN
<span class="hljs-number">1</span>  <span class="hljs-number">4.0</span>  <span class="hljs-number">3.0</span>
<span class="hljs-number">2</span>  NaN  <span class="hljs-number">4.0</span>
<span class="hljs-number">3</span>  <span class="hljs-number">3.0</span>  <span class="hljs-number">6.0</span>
<span class="hljs-number">4</span>  <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="74" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="74" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">119</span>]: df1.combine_first(df2)
Out[<span class="hljs-number">119</span>]: 
     a    b     c
<span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  NaN   <span class="hljs-number">2.0</span>
<span class="hljs-number">1</span>  <span class="hljs-number">4.0</span>  <span class="hljs-number">2.0</span>   <span class="hljs-number">6.0</span>
<span class="hljs-number">2</span>  <span class="hljs-number">5.0</span>  <span class="hljs-number">4.0</span>  <span class="hljs-number">10.0</span>
<span class="hljs-number">3</span>  <span class="hljs-number">3.0</span>  <span class="hljs-number">6.0</span>  <span class="hljs-number">14.0</span>
<span class="hljs-number">4</span>  <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span>   NaN
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="75" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="75" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>8.3 重塑和轴向旋转</h2>
<p>有许多用于重新排列表格型数据的基础运算。这些函数也称作重塑（reshape）或轴向旋转（pivot）运算。</p>
<h3>8.3.1 重塑层次化索引</h3>
<p>层次化索引为DataFrame数据的重排任务提供了一种具有良好一致性的方式。主要功能有二：</p>
<ul>
<li>stack：将数据的列“旋转”为行。</li>
<li>unstack：将数据的行“旋转”为列。</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="76" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="76" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>我将通过一系列的范例来讲解这些操作。接下来看一个简单的DataFrame，其中的行列索引均为字符串数组：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">120</span>]: data = pd.DataFrame(np.arange(<span class="hljs-number">6</span>).reshape((<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)),
   .....:                     index=pd.Index([<span class="hljs-string">&#x27;Ohio&#x27;</span>,<span class="hljs-string">&#x27;Colorado&#x27;</span>], name=<span class="hljs-string">&#x27;state&#x27;</span>),
   .....:                     columns=pd.Index([<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>],
   .....:                     name=<span class="hljs-string">&#x27;number&#x27;</span>))

In [<span class="hljs-number">121</span>]: data
Out[<span class="hljs-number">121</span>]: 
number    one  two  three
state                    
Ohio        <span class="hljs-number">0</span>    <span class="hljs-number">1</span>      <span class="hljs-number">2</span>
Colorado    <span class="hljs-number">3</span>    <span class="hljs-number">4</span>      <span class="hljs-number">5</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="77" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="77" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对该数据使用stack方法即可将列转换为行，得到一个Series：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">122</span>]: result = data.stack()

In [<span class="hljs-number">123</span>]: result
Out[<span class="hljs-number">123</span>]: 
state     number
Ohio      one       <span class="hljs-number">0</span>
          two       <span class="hljs-number">1</span>
          three     <span class="hljs-number">2</span>
Colorado  one       <span class="hljs-number">3</span>
          two       <span class="hljs-number">4</span>
          three     <span class="hljs-number">5</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="78" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="78" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>对于一个层次化索引的Series，你可以用unstack将其重排为一个DataFrame：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">124</span>]: result.unstack()
Out[<span class="hljs-number">124</span>]: 
number    one  two  three
state                    
Ohio        <span class="hljs-number">0</span>    <span class="hljs-number">1</span>      <span class="hljs-number">2</span>
Colorado    <span class="hljs-number">3</span>    <span class="hljs-number">4</span>      <span class="hljs-number">5</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="79" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="79" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>默认情况下，unstack操作的是最内层（stack也是如此）。传入分层级别的编号或名称即可对其它级别进行unstack操作：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">125</span>]: result.unstack(<span class="hljs-number">0</span>)
Out[<span class="hljs-number">125</span>]: 
state   Ohio  Colorado
number                
one        <span class="hljs-number">0</span>         <span class="hljs-number">3</span>
two        <span class="hljs-number">1</span>         <span class="hljs-number">4</span>
three      <span class="hljs-number">2</span>         <span class="hljs-number">5</span>

In [<span class="hljs-number">126</span>]: result.unstack(<span class="hljs-string">&#x27;state&#x27;</span>)
Out[<span class="hljs-number">126</span>]: 
state   Ohio  Colorado
number                
one        <span class="hljs-number">0</span>         <span class="hljs-number">3</span>
two        <span class="hljs-number">1</span>         <span class="hljs-number">4</span>
three      <span class="hljs-number">2</span>         <span class="hljs-number">5</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="80" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="80" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果不是所有的级别值都能在各分组中找到的话，则unstack操作可能会引入缺失数据：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">127</span>]: s1 = pd.Series([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], index=[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>])
In [<span class="hljs-number">128</span>]: s2 = pd.Series([<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>], index=[<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>])
In [<span class="hljs-number">129</span>]: data2 = pd.concat([s1, s2], keys=[<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>])
In [<span class="hljs-number">130</span>]: data2
Out[<span class="hljs-number">130</span>]: 
one  a    <span class="hljs-number">0</span>
     b    <span class="hljs-number">1</span>
     c    <span class="hljs-number">2</span>
     d    <span class="hljs-number">3</span>
two  c    <span class="hljs-number">4</span>
     d    <span class="hljs-number">5</span>
     e    <span class="hljs-number">6</span>
dtype: int64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="81" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="81" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">131</span>]: data2.unstack()
Out[<span class="hljs-number">131</span>]: 
       a    b    c    d    e
one  <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">2.0</span>  <span class="hljs-number">3.0</span>  NaN
two  NaN  NaN  <span class="hljs-number">4.0</span>  <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="82" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="82" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>stack默认会滤除缺失数据，因此该运算是可逆的：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">132</span>]: data2.unstack()
Out[<span class="hljs-number">132</span>]: 
       a    b    c    d    e
one  <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">2.0</span>  <span class="hljs-number">3.0</span>  NaN
two  NaN  NaN  <span class="hljs-number">4.0</span>  <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span>

In [<span class="hljs-number">133</span>]: data2.unstack().stack()
Out[<span class="hljs-number">133</span>]: 
one  a    <span class="hljs-number">0.0</span>
     b    <span class="hljs-number">1.0</span>
     c    <span class="hljs-number">2.0</span>
     d    <span class="hljs-number">3.0</span>
two  c    <span class="hljs-number">4.0</span>
     d    <span class="hljs-number">5.0</span>
     e    <span class="hljs-number">6.0</span>
dtype: float64

In [<span class="hljs-number">134</span>]: data2.unstack().stack(dropna=<span class="hljs-literal">False</span>)
Out[<span class="hljs-number">134</span>]: 
one  a    <span class="hljs-number">0.0</span>
     b    <span class="hljs-number">1.0</span>
     c    <span class="hljs-number">2.0</span>
     d    <span class="hljs-number">3.0</span>
     e    NaN
two  a    NaN
     b    NaN
     c    <span class="hljs-number">4.0</span>
     d    <span class="hljs-number">5.0</span>
     e    <span class="hljs-number">6.0</span>
dtype: float64
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="83" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="83" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>在对DataFrame进行unstack操作时，作为旋转轴的级别将会成为结果中的最低级别：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">135</span>]: df = pd.DataFrame({<span class="hljs-string">&#x27;left&#x27;</span>: result, <span class="hljs-string">&#x27;right&#x27;</span>: result + <span class="hljs-number">5</span>},
   .....:                   columns=pd.Index([<span class="hljs-string">&#x27;left&#x27;</span>, <span class="hljs-string">&#x27;right&#x27;</span>], name=<span class="hljs-string">&#x27;side&#x27;</span>))

In [<span class="hljs-number">136</span>]: df
Out[<span class="hljs-number">136</span>]: 
side             left  right
state    number             
Ohio     one        <span class="hljs-number">0</span>      <span class="hljs-number">5</span>
         two        <span class="hljs-number">1</span>      <span class="hljs-number">6</span>
         three      <span class="hljs-number">2</span>      <span class="hljs-number">7</span>
Colorado one        <span class="hljs-number">3</span>      <span class="hljs-number">8</span>
         two        <span class="hljs-number">4</span>      <span class="hljs-number">9</span>
         three      <span class="hljs-number">5</span>     <span class="hljs-number">10</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="84" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="84" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">137</span>]: df.unstack(<span class="hljs-string">&#x27;state&#x27;</span>)
Out[<span class="hljs-number">137</span>]: 
side   left          right
state  Ohio Colorado  Ohio Colorado
number                             
one       <span class="hljs-number">0</span>        <span class="hljs-number">3</span>     <span class="hljs-number">5</span>        <span class="hljs-number">8</span>
two       <span class="hljs-number">1</span>        <span class="hljs-number">4</span>     <span class="hljs-number">6</span>        <span class="hljs-number">9</span>
three     <span class="hljs-number">2</span>        <span class="hljs-number">5</span>     <span class="hljs-number">7</span>       <span class="hljs-number">10</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="85" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="85" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>当调用stack，我们可以指明轴的名字：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">138</span>]: df.unstack(<span class="hljs-string">&#x27;state&#x27;</span>).stack(<span class="hljs-string">&#x27;side&#x27;</span>)
Out[<span class="hljs-number">138</span>]: 
state         Colorado  Ohio
number side                 
one    left          <span class="hljs-number">3</span>     <span class="hljs-number">0</span>
       right         <span class="hljs-number">8</span>     <span class="hljs-number">5</span>
two    left          <span class="hljs-number">4</span>     <span class="hljs-number">1</span>
       right         <span class="hljs-number">9</span>     <span class="hljs-number">6</span>
three  left          <span class="hljs-number">5</span>     <span class="hljs-number">2</span>
       right        <span class="hljs-number">10</span>     <span class="hljs-number">7</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="86" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="86" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.3.2 将“长格式”旋转为“宽格式”</h3>
<p>多个时间序列数据通常是以所谓的“长格式”（long）或“堆叠格式”（stacked）存储在数据库和CSV中的。我们先加载一些示例数据，做一些时间序列规整和数据清洗：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="87" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="87" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">139</span>]: data = pd.read_csv(<span class="hljs-string">&#x27;examples/macrodata.csv&#x27;</span>)

In [<span class="hljs-number">140</span>]: data.head()
Out[<span class="hljs-number">140</span>]: 
     year  quarter   realgdp  realcons  realinv  realgovt  realdpi    cpi  \
<span class="hljs-number">0</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">1.0</span>  <span class="hljs-number">2710.349</span>    <span class="hljs-number">1707.4</span>  <span class="hljs-number">286.898</span>   <span class="hljs-number">470.045</span>   <span class="hljs-number">1886.9</span>  <span class="hljs-number">28.98</span>   
<span class="hljs-number">1</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">2.0</span>  <span class="hljs-number">2778.801</span>    <span class="hljs-number">1733.7</span>  <span class="hljs-number">310.859</span>   <span class="hljs-number">481.301</span>   <span class="hljs-number">1919.7</span>  <span class="hljs-number">29.15</span>   
<span class="hljs-number">2</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">3.0</span>  <span class="hljs-number">2775.488</span>    <span class="hljs-number">1751.8</span>  <span class="hljs-number">289.226</span>   <span class="hljs-number">491.260</span>   <span class="hljs-number">1916.4</span>  <span class="hljs-number">29.35</span>   
<span class="hljs-number">3</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">4.0</span>  <span class="hljs-number">2785.204</span>    <span class="hljs-number">1753.7</span>  <span class="hljs-number">299.356</span>   <span class="hljs-number">484.052</span>   <span class="hljs-number">1931.3</span>  <span class="hljs-number">29.37</span>   
<span class="hljs-number">4</span>  <span class="hljs-number">1960.0</span>      <span class="hljs-number">1.0</span>  <span class="hljs-number">2847.699</span>    <span class="hljs-number">1770.5</span>  <span class="hljs-number">331.722</span>   <span class="hljs-number">462.199</span>   <span class="hljs-number">1955.5</span>  <span class="hljs-number">29.54</span>   
      m1  tbilrate  unemp      pop  infl  realint  
<span class="hljs-number">0</span>  <span class="hljs-number">139.7</span>      <span class="hljs-number">2.82</span>    <span class="hljs-number">5.8</span>  <span class="hljs-number">177.146</span>  <span class="hljs-number">0.00</span>     <span class="hljs-number">0.00</span>
<span class="hljs-number">1</span>  <span class="hljs-number">141.7</span>      <span class="hljs-number">3.08</span>    <span class="hljs-number">5.1</span>  <span class="hljs-number">177.830</span>  <span class="hljs-number">2.34</span>     <span class="hljs-number">0.74</span>  
<span class="hljs-number">2</span>  <span class="hljs-number">140.5</span>      <span class="hljs-number">3.82</span>    <span class="hljs-number">5.3</span>  <span class="hljs-number">178.657</span>  <span class="hljs-number">2.74</span>     <span class="hljs-number">1.09</span>  
<span class="hljs-number">3</span>  <span class="hljs-number">140.0</span>      <span class="hljs-number">4.33</span>    <span class="hljs-number">5.6</span>  <span class="hljs-number">179.386</span>  <span class="hljs-number">0.27</span>     <span class="hljs-number">4.06</span>  
<span class="hljs-number">4</span>  <span class="hljs-number">139.6</span>      <span class="hljs-number">3.50</span>    <span class="hljs-number">5.2</span>  <span class="hljs-number">180.007</span>  <span class="hljs-number">2.31</span>     <span class="hljs-number">1.19</span>  

In [<span class="hljs-number">141</span>]: periods = pd.PeriodIndex(year=data.year, quarter=data.quarter,
   .....:                          name=<span class="hljs-string">&#x27;date&#x27;</span>)

In [<span class="hljs-number">142</span>]: columns = pd.Index([<span class="hljs-string">&#x27;realgdp&#x27;</span>, <span class="hljs-string">&#x27;infl&#x27;</span>, <span class="hljs-string">&#x27;unemp&#x27;</span>], name=<span class="hljs-string">&#x27;item&#x27;</span>)

In [<span class="hljs-number">143</span>]: data = data.reindex(columns=columns)

In [<span class="hljs-number">144</span>]: data.index = periods.to_timestamp(<span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;end&#x27;</span>)

In [<span class="hljs-number">145</span>]: ldata = data.stack().reset_index().rename(columns={<span class="hljs-number">0</span>: <span class="hljs-string">&#x27;value&#x27;</span>})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="88" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="88" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>这就是多个时间序列（或者其它带有两个或多个键的可观察数据，这里，我们的键是date和item）的长格式。表中的每行代表一次观察。</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="89" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="89" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>关系型数据库（如MySQL）中的数据经常都是这样存储的，因为固定架构（即列名和数据类型）有一个好处：随着表中数据的添加，item列中的值的种类能够增加。在前面的例子中，date和item通常就是主键（用关系型数据库的说法），不仅提供了关系完整性，而且提供了更为简单的查询支持。有的情况下，使用这样的数据会很麻烦，你可能会更喜欢DataFrame，不同的item值分别形成一列，date列中的时间戳则用作索引。DataFrame的pivot方法完全可以实现这个转换：</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="90" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="90" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">147</span>]: pivoted = ldata.pivot(<span class="hljs-string">&#x27;date&#x27;</span>, <span class="hljs-string">&#x27;item&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>)

In [<span class="hljs-number">148</span>]: pivoted
Out[<span class="hljs-number">148</span>]: 
item        infl    realgdp  unemp
date                              
<span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>   <span class="hljs-number">2710.349</span>    <span class="hljs-number">5.8</span>
<span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>   <span class="hljs-number">2778.801</span>    <span class="hljs-number">5.1</span>
<span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>   <span class="hljs-number">2775.488</span>    <span class="hljs-number">5.3</span>
<span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>   <span class="hljs-number">2785.204</span>    <span class="hljs-number">5.6</span>
<span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>   <span class="hljs-number">2847.699</span>    <span class="hljs-number">5.2</span>
<span class="hljs-number">1960</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">0.14</span>   <span class="hljs-number">2834.390</span>    <span class="hljs-number">5.2</span>
<span class="hljs-number">1960</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.70</span>   <span class="hljs-number">2839.022</span>    <span class="hljs-number">5.6</span>
<span class="hljs-number">1960</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">1.21</span>   <span class="hljs-number">2802.616</span>    <span class="hljs-number">6.3</span>
<span class="hljs-number">1961</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span> <span class="hljs-number">-0.40</span>   <span class="hljs-number">2819.264</span>    <span class="hljs-number">6.8</span>
<span class="hljs-number">1961</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">1.47</span>   <span class="hljs-number">2872.005</span>    <span class="hljs-number">7.0</span>
<span class="hljs-meta">... </span>         ...        ...    ...
<span class="hljs-number">2007</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.75</span>  <span class="hljs-number">13203.977</span>    <span class="hljs-number">4.5</span>
<span class="hljs-number">2007</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">3.45</span>  <span class="hljs-number">13321.109</span>    <span class="hljs-number">4.7</span>
<span class="hljs-number">2007</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">6.38</span>  <span class="hljs-number">13391.249</span>    <span class="hljs-number">4.8</span>
<span class="hljs-number">2008</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.82</span>  <span class="hljs-number">13366.865</span>    <span class="hljs-number">4.9</span>
<span class="hljs-number">2008</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">8.53</span>  <span class="hljs-number">13415.266</span>    <span class="hljs-number">5.4</span>
<span class="hljs-number">2008</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span> <span class="hljs-number">-3.16</span>  <span class="hljs-number">13324.600</span>    <span class="hljs-number">6.0</span>
<span class="hljs-number">2008</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span> <span class="hljs-number">-8.79</span>  <span class="hljs-number">13141.920</span>    <span class="hljs-number">6.9</span>
<span class="hljs-number">2009</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.94</span>  <span class="hljs-number">12925.410</span>    <span class="hljs-number">8.1</span>
<span class="hljs-number">2009</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">3.37</span>  <span class="hljs-number">12901.504</span>    <span class="hljs-number">9.2</span>
<span class="hljs-number">2009</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">3.56</span>  <span class="hljs-number">12990.341</span>    <span class="hljs-number">9.6</span>
[<span class="hljs-number">203</span> rows x <span class="hljs-number">3</span> columns]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="91" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="91" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>前两个传递的值分别用作行和列索引，最后一个可选值则是用于填充DataFrame的数据列。假设有两个需要同时重塑的数据列：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">149</span>]: ldata[<span class="hljs-string">&#x27;value2&#x27;</span>] = np.random.randn(len(ldata))

In [<span class="hljs-number">150</span>]: ldata[:<span class="hljs-number">10</span>]
Out[<span class="hljs-number">150</span>]: 
        date     item     value    value2
<span class="hljs-number">0</span> <span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  realgdp  <span class="hljs-number">2710.349</span>  <span class="hljs-number">0.523772</span>
<span class="hljs-number">1</span> <span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>     infl     <span class="hljs-number">0.000</span>  <span class="hljs-number">0.000940</span>
<span class="hljs-number">2</span> <span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>    unemp     <span class="hljs-number">5.800</span>  <span class="hljs-number">1.343810</span>
<span class="hljs-number">3</span> <span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  realgdp  <span class="hljs-number">2778.801</span> <span class="hljs-number">-0.713544</span>
<span class="hljs-number">4</span> <span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>     infl     <span class="hljs-number">2.340</span> <span class="hljs-number">-0.831154</span>
<span class="hljs-number">5</span> <span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>    unemp     <span class="hljs-number">5.100</span> <span class="hljs-number">-2.370232</span>
<span class="hljs-number">6</span> <span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  realgdp  <span class="hljs-number">2775.488</span> <span class="hljs-number">-1.860761</span>
<span class="hljs-number">7</span> <span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>     infl     <span class="hljs-number">2.740</span> <span class="hljs-number">-0.860757</span>
<span class="hljs-number">8</span> <span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>    unemp     <span class="hljs-number">5.300</span>  <span class="hljs-number">0.560145</span>
<span class="hljs-number">9</span> <span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  realgdp  <span class="hljs-number">2785.204</span> <span class="hljs-number">-1.265934</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="92" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="92" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>如果忽略最后一个参数，得到的DataFrame就会带有层次化的列：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">151</span>]: pivoted = ldata.pivot(<span class="hljs-string">&#x27;date&#x27;</span>, <span class="hljs-string">&#x27;item&#x27;</span>)

In [<span class="hljs-number">152</span>]: pivoted[:<span class="hljs-number">5</span>]
Out[<span class="hljs-number">152</span>]: 
           value                    value2                    
item        infl   realgdp unemp      infl   realgdp     unemp
date                                                          
<span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>  <span class="hljs-number">2710.349</span>   <span class="hljs-number">5.8</span>  <span class="hljs-number">0.000940</span>  <span class="hljs-number">0.523772</span>  <span class="hljs-number">1.343810</span>
<span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>  <span class="hljs-number">2778.801</span>   <span class="hljs-number">5.1</span> <span class="hljs-number">-0.831154</span> <span class="hljs-number">-0.713544</span> <span class="hljs-number">-2.370232</span>
<span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>  <span class="hljs-number">2775.488</span>   <span class="hljs-number">5.3</span> <span class="hljs-number">-0.860757</span> <span class="hljs-number">-1.860761</span>  <span class="hljs-number">0.560145</span>
<span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>  <span class="hljs-number">2785.204</span>   <span class="hljs-number">5.6</span>  <span class="hljs-number">0.119827</span> <span class="hljs-number">-1.265934</span> <span class="hljs-number">-1.063512</span>
<span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>  <span class="hljs-number">2847.699</span>   <span class="hljs-number">5.2</span> <span class="hljs-number">-2.359419</span>  <span class="hljs-number">0.332883</span> <span class="hljs-number">-0.199543</span>

In [<span class="hljs-number">153</span>]: pivoted[<span class="hljs-string">&#x27;value&#x27;</span>][:<span class="hljs-number">5</span>]
Out[<span class="hljs-number">153</span>]: 
item        infl   realgdp  unemp
date                             
<span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>  <span class="hljs-number">2710.349</span>    <span class="hljs-number">5.8</span>
<span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>  <span class="hljs-number">2778.801</span>    <span class="hljs-number">5.1</span>
<span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>  <span class="hljs-number">2775.488</span>    <span class="hljs-number">5.3</span>
<span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>  <span class="hljs-number">2785.204</span>    <span class="hljs-number">5.6</span>
<span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>  <span class="hljs-number">2847.699</span>    <span class="hljs-number">5.2</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="93" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="93" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>注意，pivot其实就是用set_index创建层次化索引，再用unstack重塑：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">154</span>]: unstacked = ldata.set_index([<span class="hljs-string">&#x27;date&#x27;</span>, <span class="hljs-string">&#x27;item&#x27;</span>]).unstack(<span class="hljs-string">&#x27;item&#x27;</span>)

In [<span class="hljs-number">155</span>]: unstacked[:<span class="hljs-number">7</span>]
Out[<span class="hljs-number">155</span>]: 
           value                    value2                    
item        infl   realgdp unemp      infl   realgdp     unemp
date                                                          
<span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>  <span class="hljs-number">2710.349</span>   <span class="hljs-number">5.8</span>  <span class="hljs-number">0.000940</span>  <span class="hljs-number">0.523772</span>  <span class="hljs-number">1.343810</span>
<span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>  <span class="hljs-number">2778.801</span>   <span class="hljs-number">5.1</span> <span class="hljs-number">-0.831154</span> <span class="hljs-number">-0.713544</span> <span class="hljs-number">-2.370232</span>
<span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>  <span class="hljs-number">2775.488</span>   <span class="hljs-number">5.3</span> <span class="hljs-number">-0.860757</span> <span class="hljs-number">-1.860761</span>  <span class="hljs-number">0.560145</span>
<span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>  <span class="hljs-number">2785.204</span>   <span class="hljs-number">5.6</span>  <span class="hljs-number">0.119827</span> <span class="hljs-number">-1.265934</span> <span class="hljs-number">-1.063512</span>
<span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>  <span class="hljs-number">2847.699</span>   <span class="hljs-number">5.2</span> <span class="hljs-number">-2.359419</span>  <span class="hljs-number">0.332883</span> <span class="hljs-number">-0.199543</span>
<span class="hljs-number">1960</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">0.14</span>  <span class="hljs-number">2834.390</span>   <span class="hljs-number">5.2</span> <span class="hljs-number">-0.970736</span> <span class="hljs-number">-1.541996</span> <span class="hljs-number">-1.307030</span>
<span class="hljs-number">1960</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.70</span>  <span class="hljs-number">2839.022</span>   <span class="hljs-number">5.6</span>  <span class="hljs-number">0.377984</span>  <span class="hljs-number">0.286350</span> <span class="hljs-number">-0.753887</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="94" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="94" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h3>8.3.3 将“宽格式”旋转为“长格式”</h3>
<p>旋转DataFrame的逆运算是pandas.melt。它不是将一列转换到多个新的DataFrame，而是合并多个列成为一个，产生一个比输入长的DataFrame。看一个例子：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">157</span>]: df = pd.DataFrame({<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-string">&#x27;baz&#x27;</span>],
   .....:                    <span class="hljs-string">&#x27;A&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
   .....:                    <span class="hljs-string">&#x27;B&#x27;</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>],
   .....:                    <span class="hljs-string">&#x27;C&#x27;</span>: [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]})

In [<span class="hljs-number">158</span>]: df
Out[<span class="hljs-number">158</span>]: 
   A  B  C  key
<span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">7</span>  foo
<span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">8</span>  bar
<span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">9</span>  baz
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="95" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="95" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>key列可能是分组指标，其它的列是数据值。当使用pandas.melt，我们必须指明哪些列是分组指标。下面使用key作为唯一的分组指标：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">159</span>]: melted = pd.melt(df, [<span class="hljs-string">&#x27;key&#x27;</span>])

In [<span class="hljs-number">160</span>]: melted
Out[<span class="hljs-number">160</span>]: 
   key variable  value
<span class="hljs-number">0</span>  foo        A      <span class="hljs-number">1</span>
<span class="hljs-number">1</span>  bar        A      <span class="hljs-number">2</span>
<span class="hljs-number">2</span>  baz        A      <span class="hljs-number">3</span>
<span class="hljs-number">3</span>  foo        B      <span class="hljs-number">4</span>
<span class="hljs-number">4</span>  bar        B      <span class="hljs-number">5</span>
<span class="hljs-number">5</span>  baz        B      <span class="hljs-number">6</span>
<span class="hljs-number">6</span>  foo        C      <span class="hljs-number">7</span>
<span class="hljs-number">7</span>  bar        C      <span class="hljs-number">8</span>
<span class="hljs-number">8</span>  baz        C      <span class="hljs-number">9</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="96" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="96" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>使用pivot，可以重塑回原来的样子：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">161</span>]: reshaped = melted.pivot(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;variable&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>)

In [<span class="hljs-number">162</span>]: reshaped
Out[<span class="hljs-number">162</span>]: 
variable  A  B  C
key              
bar       <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">8</span>
baz       <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">9</span>
foo       <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">7</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="97" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="97" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>因为pivot的结果从列创建了一个索引，用作行标签，我们可以使用reset_index将数据移回列：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">163</span>]: reshaped.reset_index()
Out[<span class="hljs-number">163</span>]: 
variable  key  A  B  C
<span class="hljs-number">0</span>         bar  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">8</span>
<span class="hljs-number">1</span>         baz  <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">9</span>
<span class="hljs-number">2</span>         foo  <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">7</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="98" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="98" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>你还可以指定列的子集，作为值的列：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">164</span>]: pd.melt(df, id_vars=[<span class="hljs-string">&#x27;key&#x27;</span>], value_vars=[<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>])
Out[<span class="hljs-number">164</span>]: 
   key variable  value
<span class="hljs-number">0</span>  foo        A      <span class="hljs-number">1</span>
<span class="hljs-number">1</span>  bar        A      <span class="hljs-number">2</span>
<span class="hljs-number">2</span>  baz        A      <span class="hljs-number">3</span>
<span class="hljs-number">3</span>  foo        B      <span class="hljs-number">4</span>
<span class="hljs-number">4</span>  bar        B      <span class="hljs-number">5</span>
<span class="hljs-number">5</span>  baz        B      <span class="hljs-number">6</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="99" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="99" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<p>pandas.melt也可以不用分组指标：</p>
<pre><code class="language-python"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>In [<span class="hljs-number">165</span>]: pd.melt(df, value_vars=[<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>])
Out[<span class="hljs-number">165</span>]: 
  variable  value
<span class="hljs-number">0</span>        A      <span class="hljs-number">1</span>
<span class="hljs-number">1</span>        A      <span class="hljs-number">2</span>
<span class="hljs-number">2</span>        A      <span class="hljs-number">3</span>
<span class="hljs-number">3</span>        B      <span class="hljs-number">4</span>
<span class="hljs-number">4</span>        B      <span class="hljs-number">5</span>
<span class="hljs-number">5</span>        B      <span class="hljs-number">6</span>
<span class="hljs-number">6</span>        C      <span class="hljs-number">7</span>
<span class="hljs-number">7</span>        C      <span class="hljs-number">8</span>
<span class="hljs-number">8</span>        C      <span class="hljs-number">9</span>

In [<span class="hljs-number">166</span>]: pd.melt(df, value_vars=[<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>])
Out[<span class="hljs-number">166</span>]: 
  variable value
<span class="hljs-number">0</span>      key   foo
<span class="hljs-number">1</span>      key   bar
<span class="hljs-number">2</span>      key   baz
<span class="hljs-number">3</span>        A     <span class="hljs-number">1</span>
<span class="hljs-number">4</span>        A     <span class="hljs-number">2</span>
<span class="hljs-number">5</span>        A     <span class="hljs-number">3</span>
<span class="hljs-number">6</span>        B     <span class="hljs-number">4</span>
<span class="hljs-number">7</span>        B     <span class="hljs-number">5</span>
<span class="hljs-number">8</span>        B     <span class="hljs-number">6</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="100" data-paginate="true" data-background-color="#fff" data-background-image="url('https://marp.app/assets/hero-background.jpg')" data-theme="gaia" data-marpit-pagination="100" data-marpit-pagination-total="100" style="--paginate:true;--background-color:#fff;--background-image:url('https://marp.app/assets/hero-background.jpg');--theme:gaia;background-color:#fff;background-image:url('https://marp.app/assets/hero-background.jpg');background-position:center;background-repeat:no-repeat;background-size:cover;">
<h2>8.4 总结</h2>
<p>现在你已经掌握了pandas数据导入、清洗、重塑，我们可以进一步学习matplotlib数据可视化。我们在稍后会回到pandas，学习更高级的分析。</p>
</section>
<script>!function(){"use strict";const t="marpitSVGPolyfill:setZoomFactor,",e=Symbol();let o,r;function n(n){const i="object"==typeof n&&n.target||document,a="object"==typeof n?n.zoom:n;window[e]||(Object.defineProperty(window,e,{configurable:!0,value:!0}),window.addEventListener("message",({data:e,origin:o})=>{if(o===window.origin)try{if(e&&"string"==typeof e&&e.startsWith(t)){const[,t]=e.split(","),o=Number.parseFloat(t);Number.isNaN(o)||(r=o)}}catch(t){console.error(t)}}));let l=!1;Array.from(i.querySelectorAll("svg[data-marpit-svg]"),t=>{var e,n,i,s;t.style.transform||(t.style.transform="translateZ(0)");const c=a||r||t.currentScale||1;o!==c&&(o=c,l=c);const d=t.getBoundingClientRect(),{length:u}=t.children;for(let o=0;o<u;o+=1){const r=t.children[o],a=r.getScreenCTM();if(a){const t=null!==(n=null===(e=r.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==n?n:0,o=null!==(s=null===(i=r.y)||void 0===i?void 0:i.baseVal.value)&&void 0!==s?s:0,l=r.firstChild,{style:u}=l;u.transformOrigin||(u.transformOrigin=`${-t}px ${-o}px`),u.transform=`scale(${c}) matrix(${a.a}, ${a.b}, ${a.c}, ${a.d}, ${a.e-d.left}, ${a.f-d.top}) translateZ(0.0001px)`}}}),!1!==l&&Array.from(i.querySelectorAll("iframe"),({contentWindow:e})=>{null==e||e.postMessage(`${t}${l}`,"null"===window.origin?"*":window.origin)})}o=1,r=void 0;const i=(t,e,o)=>{if(t.getAttribute(e)!==o)return t.setAttribute(e,o),!0};function a(t={}){const e="boolean"==typeof t?(t=>{const e=!t;return console.warn(`[DEPRECATION WARNING] Usage of observer() with boolean option has been deprecated. Please replace with the usage of option object: observer({ once: ${e?"true":"false"} }).`),{once:e}})(t):t,{once:o=!1,target:r=document}=e,a="Apple Computer, Inc."===navigator.vendor?[n]:[];let l=!o;const s=()=>{for(const t of a)t({target:r});!function(t=document){Array.from(t.querySelectorAll('svg[data-marp-fitting="svg"]'),t=>{var e;const o=t.firstChild,r=o.firstChild,{scrollWidth:n,scrollHeight:a}=r;let l,s=1;if(t.hasAttribute("data-marp-fitting-code")&&(l=null===(e=t.parentElement)||void 0===e?void 0:e.parentElement),t.hasAttribute("data-marp-fitting-math")&&(l=t.parentElement),l){const t=getComputedStyle(l),e=Math.ceil(l.clientWidth-parseFloat(t.paddingLeft||"0")-parseFloat(t.paddingRight||"0"));e&&(s=e)}const c=Math.max(n,s),d=Math.max(a,1),u=`0 0 ${c} ${d}`;i(o,"width",""+c),i(o,"height",""+d),i(t,"preserveAspectRatio",getComputedStyle(t).getPropertyValue("--preserve-aspect-ratio")||"xMinYMin meet"),i(t,"viewBox",u)&&t.classList.toggle("__reflow__")})}(r),l&&window.requestAnimationFrame(s)};return s(),()=>{l=!1}}const l=Symbol(),s=document.currentScript;((t=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(t[l])return t[l];const e=a({target:t}),o=()=>{e(),delete t[l]};Object.defineProperty(t,l,{configurable:!0,value:o})})(s?s.getRootNode():document)}();
</script></foreignObject></svg></div><script>!function(){"use strict";var e=function(e,t){var n,r=1===(e.parent||e).nodeType?e.parent||e:document.querySelector(e.parent||e),a=[].filter.call("string"==typeof e.slides?r.querySelectorAll(e.slides):e.slides||r.children,(function(e){return"SCRIPT"!==e.nodeName})),s={},i=function(e,t){return(t=t||{}).index=a.indexOf(e),t.slide=e,t},o=function(e,t){s[e]=(s[e]||[]).filter((function(e){return e!==t}))},l=function(e,t){return(s[e]||[]).reduce((function(e,n){return e&&!1!==n(t)}),!0)},c=function(e,t){a[e]&&(n&&l("deactivate",i(n,t)),n=a[e],l("activate",i(n,t)))},d=function(e,t){var r=a.indexOf(n)+e;l(e>0?"next":"prev",i(n,t))&&c(r,t)},u={off:o,on:function(e,t){return(s[e]||(s[e]=[])).push(t),o.bind(null,e,t)},fire:l,slide:function(e,t){if(!arguments.length)return a.indexOf(n);l("slide",i(a[e],t))&&c(e,t)},next:d.bind(null,1),prev:d.bind(null,-1),parent:r,slides:a,destroy:function(e){l("destroy",i(n,e)),s={}}};return(t||[]).forEach((function(e){e(u)})),n||c(0),u};function t(e){e.parent.classList.add("bespoke-marp-parent"),e.slides.forEach(e=>e.classList.add("bespoke-marp-slide")),e.on("activate",t=>{const n=t.slide,r=!n.classList.contains("bespoke-marp-active");e.slides.forEach(e=>{e.classList.remove("bespoke-marp-active"),e.setAttribute("aria-hidden","true")}),n.classList.add("bespoke-marp-active"),n.removeAttribute("aria-hidden"),r&&(n.classList.add("bespoke-marp-active-ready"),document.body.clientHeight,n.classList.remove("bespoke-marp-active-ready"))})}function n(e){let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map(e=>[null,...e.querySelectorAll("[data-marpit-fragment]")])});const r=r=>void 0!==e.fragments[t][n+r],a=(r,a)=>{t=r,n=a,e.fragments.forEach((e,t)=>{e.forEach((e,n)=>{if(null==e)return;const s=t<r||t===r&&n<=a;e.setAttribute("data-bespoke-marp-fragment",s?"active":"inactive"),t===r&&n===a?e.setAttribute("data-bespoke-marp-current-fragment","current"):e.removeAttribute("data-bespoke-marp-current-fragment")})}),e.fragmentIndex=a;const s={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:a};e.fire("fragment",s)};e.on("next",({fragment:s=!0})=>{if(s){if(r(1))return a(t,n+1),!1;const s=t+1;e.fragments[s]&&a(s,0)}else{const r=e.fragments[t].length;if(n+1<r)return a(t,r-1),!1;const s=e.fragments[t+1];s&&a(t+1,s.length-1)}}),e.on("prev",({fragment:s=!0})=>{if(r(-1)&&s)return a(t,n-1),!1;const i=t-1;e.fragments[i]&&a(i,e.fragments[i].length-1)}),e.on("slide",({index:t,fragment:n})=>{let r=0;if(void 0!==n){const a=e.fragments[t];if(a){const{length:e}=a;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}a(t,r)}),a(0,0)}var r,a,s=(function(e){
/*!
* screenfull
* v5.0.2 - 2020-02-13
* (c) Sindre Sorhus; MIT License
*/
!function(){var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=e.exports,r=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,a=n.length,s={};r<a;r++)if((e=n[r])&&e[1]in t){for(r=0;r<e.length;r++)s[n[0][r]]=e[r];return s}return!1}(),a={change:r.fullscreenchange,error:r.fullscreenerror},s={request:function(e){return new Promise(function(n,a){var s=function(){this.off("change",s),n()}.bind(this);this.on("change",s);var i=(e=e||t.documentElement)[r.requestFullscreen]();i instanceof Promise&&i.then(s).catch(a)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var a=function(){this.off("change",a),e()}.bind(this);this.on("change",a);var s=t[r.exitFullscreen]();s instanceof Promise&&s.then(a).catch(n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=a[e];r&&t.addEventListener(r,n,!1)},off:function(e,n){var r=a[e];r&&t.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(s,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),n?e.exports=s:window.screenfull=s):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()}(a={path:r,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&a.path)}},a.exports),a.exports);function i(e){e.fullscreen=()=>{s.isEnabled&&s.toggle(document.body)},document.addEventListener("keydown",t=>{70!==t.which&&122!==t.which||t.altKey||t.ctrlKey||t.metaKey||!s.isEnabled||(e.fullscreen(),t.preventDefault())})}function o(e=2e3){return t=>{let n;function r(){n&&clearTimeout(n),n=setTimeout(()=>{t.parent.classList.add("bespoke-marp-inactive"),t.fire("marp-inactive")},e),t.parent.classList.contains("bespoke-marp-inactive")&&(t.parent.classList.remove("bespoke-marp-inactive"),t.fire("marp-active"))}document.addEventListener("mousedown",r),document.addEventListener("mousemove",r),document.addEventListener("touchend",r),setTimeout(r,0)}}const l=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"];function c(e){e.parent.addEventListener("keydown",e=>{if(!e.target)return;const t=e.target;(l.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()})}function d(e){window.addEventListener("load",()=>{for(const t of e.slides){const e=t.querySelector("[data-marp-fitting]")?"":"hideable";t.setAttribute("data-bespoke-marp-load",e)}})}var u;function f({interval:e=200}={}){return t=>{document.addEventListener("keydown",e=>{if(32===e.which&&e.shiftKey)t.prev();else if(33===e.which||37===e.which||38===e.which)t.prev({fragment:!e.shiftKey});else if(32!==e.which||e.shiftKey)if(34===e.which||39===e.which||40===e.which)t.next({fragment:!e.shiftKey});else if(35===e.which)t.slide(t.slides.length-1,{fragment:-1});else{if(36!==e.which)return;t.slide(0)}else t.next();e.preventDefault()});let n,r,a=0;t.parent.addEventListener("wheel",s=>{let i=!1;const o=(e,t)=>{e&&(i=i||function(e,t){return function(e,t){const n=t===u.X?"Width":"Height";return e["client"+n]<e["scroll"+n]}(e,t)&&function(e,t){const{overflow:n}=e,r=e["overflow"+t];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r}(getComputedStyle(e),t)}(e,t)),(null==e?void 0:e.parentElement)&&o(e.parentElement,t)};if(0!==s.deltaX&&o(s.target,u.X),0!==s.deltaY&&o(s.target,u.Y),i)return;s.preventDefault(),r&&clearTimeout(r),r=setTimeout(()=>{n=0},e);const l=Date.now()-a<e,c=Math.sqrt(Math.pow(s.deltaX,2)+Math.pow(s.deltaY,2)),d=c<=n;if(n=c,l||d)return;let f;(s.deltaX>0||s.deltaY>0)&&(f="next"),(s.deltaX<0||s.deltaY<0)&&(f="prev"),f&&(t[f](),a=Date.now())})}}!function(e){e.X="X",e.Y="Y"}(u||(u={}));const m=(...e)=>history.replaceState(...e),p="data-bespoke-view";var h;!function(e){e.Normal="",e.Presenter="presenter",e.Next="next"}(h||(h={}));const g=(e,{protocol:t,host:n,pathname:r,hash:a}=location)=>{const s=e.toString();return`${t}//${n}${r}${s?"?":""}${s}${a}`},v=()=>{switch(document.body.getAttribute(p)){case h.Normal:return h.Normal;case h.Presenter:return h.Presenter;case h.Next:return h.Next;default:throw new Error("View mode is not assigned.")}},b=e=>new URLSearchParams(location.search).get(e),w=(e,t={})=>{const n=Object.assign({location:location,setter:m},t),r=new URLSearchParams(n.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?r.set(t,n):r.delete(t)}try{n.setter(null,document.title,g(r,n.location))}catch(e){console.error(e)}},y={available:(()=>{try{return localStorage.setItem("bespoke-marp","bespoke-marp"),localStorage.removeItem("bespoke-marp"),!0}catch(e){return console.warn("Warning: Using localStorage is restricted in the current host so some features may not work."),!1}})(),get:e=>{try{return localStorage.getItem(e)}catch(e){return null}},set:(e,t)=>{try{return localStorage.setItem(e,t),!0}catch(e){return!1}},remove:e=>{try{return localStorage.removeItem(e),!0}catch(e){return!1}}};function x(e=".bespoke-marp-osc"){const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[data-bespoke-marp-osc=${JSON.stringify(e)}]`).forEach(n)};return s.isEnabled||n("fullscreen",e=>e.style.display="none"),y.available||n("presenter",e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."}),e=>{t.addEventListener("click",t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;switch(n&&t.target.blur(),n){case"next":e.next({fragment:!t.shiftKey});break;case"prev":e.prev({fragment:!t.shiftKey});break;case"fullscreen":"function"==typeof e.fullscreen&&s.isEnabled&&e.fullscreen();break;case"presenter":e.openPresenterView()}}}),e.parent.appendChild(t),e.on("activate",({index:t})=>{n("page",n=>n.textContent=`Page ${t+1} of ${e.slides.length}`)}),e.on("fragment",({index:t,fragments:r,fragmentIndex:a})=>{n("prev",e=>e.disabled=0===t&&0===a),n("next",n=>n.disabled=t===e.slides.length-1&&a===r.length-1)}),e.on("marp-active",()=>t.removeAttribute("aria-hidden")),e.on("marp-inactive",()=>t.setAttribute("aria-hidden","true")),s.isEnabled&&s.onchange(()=>n("fullscreen",e=>e.classList.toggle("exit",s.isEnabled&&s.isFullscreen)))}}function E(){const e=Math.max(Math.floor(.85*window.innerWidth),640),t=Math.max(Math.floor(.85*window.innerHeight),360);return window.open(this.presenterUrl,"bespoke-marp-presenter-"+this.syncKey,`width=${e},height=${t},menubar=no,toolbar=no`)}function k(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),g(e)}var L=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];let S=e=>String(e).replace(/[&<>"']/g,e=>`&${I[e]};`),I={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},P="dangerouslySetInnerHTML",M={className:"class",htmlFor:"for"},N={};function F(e,t){let n=[],r="";t=t||{};for(let e=arguments.length;e-- >2;)n.push(arguments[e]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(let e in t)!1!==t[e]&&null!=t[e]&&e!==P&&(r+=` ${M[e]?M[e]:S(e)}="${S(t[e])}"`);r+=">"}if(-1===L.indexOf(e)){if(t[P])r+=t[P].__html;else for(;n.length;){let e=n.pop();if(e)if(e.pop)for(let t=e.length;t--;)n.push(e[t]);else r+=!0===N[e]?e:S(e)}r+=e?`</${e}>`:""}return N[r]=!0,r}const O=({children:e})=>F(null,null,...e),q="bespoke-marp-presenter-container",C="bespoke-marp-presenter-next",T="bespoke-marp-presenter-next-container",A="bespoke-marp-presenter-note-container",K="bespoke-marp-presenter-info-container",$="bespoke-marp-presenter-info-page",j="bespoke-marp-presenter-info-page-text",D="bespoke-marp-presenter-info-page-prev",R="bespoke-marp-presenter-info-page-next",U="bespoke-marp-presenter-info-time",V="bespoke-marp-presenter-info-timer";function X(e){const{title:t}=document;document.title="[Presenter view]"+(t?" - "+t:"");const n={},r=e=>(n[e]=n[e]||document.querySelector("."+e),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=q,t.appendChild(e),t.insertAdjacentHTML("beforeend",F(O,null,F("div",{class:T},F("iframe",{class:C,src:"?view=next"})),F("div",{class:A}),F("div",{class:K},F("div",{class:$},F("button",{class:D,tabindex:"-1",title:"Previous"},"Previous"),F("span",{class:j}),F("button",{class:R,tabindex:"-1",title:"Next"},"Next")),F("time",{class:U,title:"Current time"}),F("div",{class:V})))),t})(e.parent)),(e=>{r(T).addEventListener("click",()=>e.next());const t=r(C),n=(a=t,(e,t)=>{var n;return null===(n=a.contentWindow)||void 0===n?void 0:n.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin)});var a;t.addEventListener("load",()=>{r(T).classList.add("active"),n(e.slide(),e.fragmentIndex),e.on("fragment",({index:e,fragmentIndex:t})=>n(e,t))});const s=document.querySelectorAll(".bespoke-marp-note");s.forEach(e=>{e.addEventListener("keydown",e=>e.stopPropagation()),r(A).appendChild(e)}),e.on("activate",()=>s.forEach(t=>t.classList.toggle("active",t.dataset.index==e.slide()))),e.on("activate",({index:t})=>{r(j).textContent=`${t+1} / ${e.slides.length}`});const i=r(D),o=r(R);i.addEventListener("click",t=>{i.blur(),e.prev({fragment:!t.shiftKey})}),o.addEventListener("click",t=>{o.blur(),e.next({fragment:!t.shiftKey})}),e.on("fragment",({index:t,fragments:n,fragmentIndex:r})=>{i.disabled=0===t&&0===r,o.disabled=t===e.slides.length-1&&r===n.length-1});const l=()=>r(U).textContent=(new Date).toLocaleTimeString();l(),setInterval(l,250)})(e)}function Y(e){const t=v();return t===h.Next&&e.appendChild(document.createElement("span")),e=>{t===h.Normal&&function(e){if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:E},presenterUrl:{enumerable:!0,get:k}}),y.available&&document.addEventListener("keydown",t=>{80!==t.which||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())})}(e),t===h.Presenter&&X(e),t===h.Next&&function(e){const t=t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let a=Number.parseInt(t,10),s=Number.parseInt(n,10)+1;s>=e.fragments[a].length&&(a+=1,s=0),e.slide(a,{fragment:s})}};window.addEventListener("message",t),e.on("destroy",()=>window.removeEventListener("message",t))}(e)}}function B(e){e.on("activate",t=>{document.querySelectorAll(".bespoke-progress-bar").forEach(n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"})})}const z=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t};function H(e={}){const t=Object.assign({history:!0},e);return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},a=(t={fragment:!0})=>{((t,n)=>{const{fragments:r,slides:a}=e,s=Math.max(0,Math.min(t,a.length-1)),i=Math.max(0,Math.min(n||0,r[s].length-1));s===e.slide()&&i===e.fragmentIndex||e.slide(s,{fragment:i})})((z(location.hash.slice(1))||1)-1,t.fragment?z(b("f")||""):null)};e.on("fragment",({index:e,fragmentIndex:r})=>{n||w({f:0===r||r.toString()},{location:Object.assign(Object.assign({},location),{hash:"#"+(e+1)}),setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})}),setTimeout(()=>{a(),window.addEventListener("hashchange",()=>r(()=>{a({fragment:!1}),w({f:void 0})})),window.addEventListener("popstate",()=>{n||r(()=>a())}),n=!1},0)}}function W(e={}){const t=e.key||((e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t})(),n="bespoke-marp-sync-"+t,r=()=>{const e=y.get(n);return e?JSON.parse(e):Object.create(null)},a=e=>{const t=r(),a=Object.assign(Object.assign({},t),e(t));return y.set(n,JSON.stringify(a)),a};return a(e=>({reference:(e.reference||0)+1})),e=>{Object.defineProperty(e,"syncKey",{value:t,enumerable:!0});let s=!0;setTimeout(()=>{e.on("fragment",e=>{s&&a(()=>({index:e.index,fragmentIndex:e.fragmentIndex}))})},0),window.addEventListener("storage",t=>{if(t.key===n&&t.oldValue&&t.newValue){const n=JSON.parse(t.oldValue),r=JSON.parse(t.newValue);if(n.index!==r.index||n.fragmentIndex!==r.fragmentIndex)try{s=!1,e.slide(r.index,{fragment:r.fragmentIndex})}finally{s=!0}}}),e.on("destroy",()=>{const{reference:e}=r();void 0===e||e<=1?y.remove(n):a(()=>({reference:e-1}))})}}function J({slope:e=Math.tan(-35*Math.PI/180),swipeThreshold:t=30}={}){return n=>{let r;const a=n.parent,s=e=>{const t=a.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};a.addEventListener("touchstart",e=>{r=1===e.touches.length?s(e.touches[0]):void 0},{passive:!0}),a.addEventListener("touchmove",e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=s(e.touches[0]),n=t.x-r.x,a=t.y-r.y;r.delta=Math.sqrt(Math.pow(Math.abs(n),2)+Math.pow(Math.abs(a),2)),r.radian=Math.atan2(n,a)}else r=void 0}),a.addEventListener("touchend",a=>{if(r){if(r.delta&&r.delta>=t&&r.radian){let t=r.radian-e;t=(t+Math.PI)%(2*Math.PI)-Math.PI,n[t<0?"next":"prev"](),a.stopPropagation()}r=void 0}},{passive:!0})}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function _(e,t,n,r){return new(n||(n=Promise))((function(a,s){function i(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}l((r=r.apply(e,t||[])).next())}))}let G=void 0;const Q=()=>(void 0===G&&(G="wakeLock"in navigator&&navigator.wakeLock),G),Z=()=>_(void 0,void 0,void 0,(function*(){const e=Q();if(e)try{const t=yield e.request("screen");return t.addEventListener("release",()=>{console.debug("[Marp CLI] Wake Lock was released")}),console.debug("[Marp CLI] Wake Lock is active"),t}catch(e){console.warn(e)}return null}));function ee(){return _(this,void 0,void 0,(function*(){if(!Q())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&Z()};return document.addEventListener("visibilitychange",t),document.addEventListener("fullscreenchange",t),e=yield Z(),e}))}const te=[h.Normal,h.Presenter,h.Next];!function(r=document.getElementById("p")){document.body.setAttribute(p,(()=>{switch(b("view")){case"next":return h.Next;case"presenter":return h.Presenter;default:return h.Normal}})());const a=(e=>{const t=b(e);return w({[e]:void 0}),t})("sync")||void 0,s=!1,l=!0,u=e(r,((...e)=>{const t=te.findIndex(e=>v()===e);if(t<0)throw new Error("Invalid view");return e.map(([e,n])=>e[t]&&n).filter(e=>e)})([[l,l,s],W({key:a})],[[l,l,l],Y(r)],[[l,l,s],c],[[l,l,l],t],[[l,s,s],o()],[[l,l,l],d],[[l,l,l],H({history:!1})],[[l,l,s],f()],[[l,l,s],i],[[l,s,s],B],[[l,l,s],J()],[[l,s,s],x()],[[l,l,l],n],[[l,l,s],ee]));window.addEventListener("beforeunload",()=>w({sync:u.syncKey})),window.addEventListener("unload",()=>u.destroy())}()}();</script><script>window.__marpCliWatchWS="ws://localhost:37717/39284e3e58551912ec2e4b4976ad8f4c77cf32590fbb7d31b3e8f28b16a53e6c";!function(){"use strict";const e=(n,o=!1)=>{const t=new WebSocket(n);return t.addEventListener("open",()=>{console.info("[Marp CLI] Observing the change of file..."),o&&location.reload()}),t.addEventListener("close",()=>{console.warn("[Marp CLI] WebSocket for file watcher was disconnected. Try re-connecting in 5000ms..."),setTimeout(()=>e(n,!0),5e3)}),t.addEventListener("message",e=>{"reload"===e.data&&location.reload()}),t};!function(){const n=window.__marpCliWatchWS;if(n)e(n)}()}();</script></body></html>